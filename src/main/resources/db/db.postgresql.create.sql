-- ##bc平台的 postgresql 建表脚本##

-- 创建Identity用的序列，开始于1000
CREATE sequence CORE_SEQUENCE
    minvalue 1
    start with 1000
    increment by 1
    cache 20;

-- 创建序列，开始于1千万，方便历史数据的转换
CREATE sequence HIBERNATE_SEQUENCE
    minvalue 1
    start with 10000000
    increment by 1
    cache 20;

-- 测试用的表
CREATE TABLE BC_EXAMPLE (
    ID INTEGER NOT NULL,
    NAME varchar(255) NOT NULL,
    CODE varchar(255),
    PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_EXAMPLE IS '测试用的表';
COMMENT ON COLUMN BC_EXAMPLE.NAME IS '名称';

-- 系统标识相关模块
-- 系统资源
CREATE TABLE BC_IDENTITY_RESOURCE (
    ID INTEGER NOT NULL,
    UID_ varchar(36),
    TYPE_ int  DEFAULT 0 NOT NULL,
    STATUS_ int  DEFAULT 0 NOT NULL,
    INNER_ boolean NOT NULL default false,
    BELONG integer,
    ORDER_ varchar(100),
    NAME varchar(255) NOT NULL,
    URL varchar(255),
    ICONCLASS varchar(255),
    OPTION_ varchar(4000),
    PNAME varchar(4000),
    CONSTRAINT BCPK_RESOURCE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_RESOURCE IS '系统资源';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.TYPE_ IS '类型：1-文件夹,2-内部链接,3-外部链接,4-html';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.INNER_ IS '是否为内置对象:0-否,1-是';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.BELONG IS '所隶属的资源';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.NAME IS '名称';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.URL IS '地址';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.ICONCLASS IS '图标样式';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.OPTION_ IS '扩展参数';
COMMENT ON COLUMN BC_IDENTITY_RESOURCE.PNAME IS '所隶属模块的全名:如系统维护/组织架构/单位配置';
CREATE INDEX BCIDX_RESOURCE_BELONG ON BC_IDENTITY_RESOURCE (BELONG);
CREATE INDEX BCIDX_RESOURCE_BELONG_NULL ON BC_IDENTITY_RESOURCE (COALESCE(BELONG,0));

-- 角色
CREATE TABLE BC_IDENTITY_ROLE (
    ID INTEGER NOT NULL,
    CODE varchar(100) NOT NULL,
    ORDER_ varchar(100),
    NAME varchar(255) NOT NULL,
    UID_ varchar(36),
    TYPE_ int  NOT NULL,
    STATUS_ int  NOT NULL,
    INNER_ boolean NOT NULL default false,
    CONSTRAINT BCPK_ROLE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_ROLE IS '角色';
COMMENT ON COLUMN BC_IDENTITY_ROLE.CODE IS '编码';
COMMENT ON COLUMN BC_IDENTITY_ROLE.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_IDENTITY_ROLE.NAME IS '名称';
COMMENT ON COLUMN BC_IDENTITY_ROLE.TYPE_ IS '类型';
COMMENT ON COLUMN BC_IDENTITY_ROLE.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_IDENTITY_ROLE.INNER_ IS '是否为内置对象:0-否,1-是';

-- 角色与资源的关联
CREATE TABLE BC_IDENTITY_ROLE_RESOURCE (
    RID integer NOT NULL,
    SID integer NOT NULL,
    CONSTRAINT BCPK_ROLE_RESOURCE PRIMARY KEY (RID,SID)
);
COMMENT ON TABLE BC_IDENTITY_ROLE_RESOURCE IS '角色与资源的关联：角色可以访问哪些资源';
COMMENT ON COLUMN BC_IDENTITY_ROLE_RESOURCE.RID IS '角色ID';
COMMENT ON COLUMN BC_IDENTITY_ROLE_RESOURCE.SID IS '资源ID';
ALTER TABLE BC_IDENTITY_ROLE_RESOURCE ADD CONSTRAINT BCFK_RS_ROLE FOREIGN KEY (RID) REFERENCES BC_IDENTITY_ROLE (ID);
ALTER TABLE BC_IDENTITY_ROLE_RESOURCE ADD CONSTRAINT BCFK_RS_RESOURCE FOREIGN KEY (SID) REFERENCES BC_IDENTITY_RESOURCE (ID);

-- 职务
CREATE TABLE BC_IDENTITY_DUTY (
    ID INTEGER NOT NULL,
    CODE varchar(100) NOT NULL,
    NAME varchar(255) NOT NULL,
    CONSTRAINT BCPK_DUTY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_DUTY IS '职务';
COMMENT ON COLUMN BC_IDENTITY_DUTY.CODE IS '编码';
COMMENT ON COLUMN BC_IDENTITY_DUTY.NAME IS '名称';

-- 参与者的扩展属性
CREATE TABLE BC_IDENTITY_ACTOR_DETAIL (
    ID INTEGER NOT NULL,
    CREATE_DATE timestamp,
    WORK_DATE timestamp,
    ISO boolean NOT NULL default false,
    SEX int  default 0,
    CARD varchar(20),
    DUTY_ID integer,
    COMMENT_ varchar(4000),
    CONSTRAINT BCPK_ACTOR_DETAIL PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_ACTOR_DETAIL IS '参与者的扩展属性';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_DETAIL.CREATE_DATE IS '创建时间';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_DETAIL.WORK_DATE IS 'user-入职时间';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_DETAIL.SEX IS 'user-性别：0-未设置,1-男,2-女';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_DETAIL.DUTY_ID IS 'user-职务ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_DETAIL.COMMENT_ IS '备注';
ALTER TABLE BC_IDENTITY_ACTOR_DETAIL ADD CONSTRAINT BCFK_ACTORDETAIL_DUTY FOREIGN KEY (DUTY_ID) REFERENCES BC_IDENTITY_DUTY (ID);

-- 参与者
CREATE TABLE BC_IDENTITY_ACTOR (
    ID INTEGER NOT NULL,
    UID_ varchar(36) NOT NULL,
    TYPE_ int  DEFAULT 0 NOT NULL,
    STATUS_ int  DEFAULT 0 NOT NULL,
    INNER_ boolean NOT NULL default false,
    CODE varchar(100) NOT NULL,
    NAME varchar(255) NOT NULL,
    PY varchar(255),
    ORDER_ varchar(100),
    EMAIL varchar(255),
    PHONE varchar(255),
    DETAIL_ID integer,
    PCODE varchar(4000),
    PNAME varchar(4000),
    CONSTRAINT BCPK_ACTOR PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_ACTOR IS '参与者(代表一个人或组织，组织也可以是单位、部门、岗位、团队等)';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.UID_ IS '全局标识';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.TYPE_ IS '类型：0-未定义,1-单位,2-部门,3-岗位,4-用户';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.INNER_ IS '是否为内置对象:0-否,1-是';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.CODE IS '编码';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.NAME IS '名称';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.PY IS '名称的拼音';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.ORDER_ IS '同类参与者之间的排序号';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.EMAIL IS '邮箱';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.PHONE IS '联系电话';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.DETAIL_ID IS '扩展表的ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.PCODE IS '隶属机构的全编码';
COMMENT ON COLUMN BC_IDENTITY_ACTOR.PNAME IS '隶属机构的全名';
ALTER TABLE BC_IDENTITY_ACTOR ADD CONSTRAINT BCFK_ACTOR_ACTORDETAIL FOREIGN KEY (DETAIL_ID) 
	REFERENCES BC_IDENTITY_ACTOR_DETAIL (ID) ON DELETE CASCADE;
CREATE INDEX BCIDX_ACTOR_CODE ON BC_IDENTITY_ACTOR (CODE ASC);
CREATE INDEX BCIDX_ACTOR_NAME ON BC_IDENTITY_ACTOR (NAME ASC);
CREATE INDEX BCIDX_ACTOR_STATUSTYPE ON BC_IDENTITY_ACTOR (STATUS_ ASC,TYPE_ ASC);
CREATE INDEX BCIDX_ACTOR_TYPE ON BC_IDENTITY_ACTOR (TYPE_ ASC);
CREATE INDEX BCIDX_ACTOR_DETAIL ON BC_IDENTITY_ACTOR (DETAIL_ID ASC);

-- 参与者之间的关联关系
CREATE TABLE BC_IDENTITY_ACTOR_RELATION (
    TYPE_ integer NOT NULL,
    MASTER_ID integer NOT NULL,
    FOLLOWER_ID integer NOT NULL,
    ORDER_ varchar(100),
    CONSTRAINT BCPK_ACTOR_RELATION PRIMARY KEY (MASTER_ID,FOLLOWER_ID,TYPE_)
);
COMMENT ON TABLE BC_IDENTITY_ACTOR_RELATION IS '参与者之间的关联关系';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_RELATION.TYPE_ IS '关联类型';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_RELATION.MASTER_ID IS '主控方ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_RELATION.FOLLOWER_ID IS '从属方ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_RELATION.ORDER_ IS '从属方之间的排序号';
ALTER TABLE BC_IDENTITY_ACTOR_RELATION ADD CONSTRAINT BCFK_AR_MASTER FOREIGN KEY (MASTER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BC_IDENTITY_ACTOR_RELATION ADD CONSTRAINT BCFK_AR_FOLLOWER FOREIGN KEY (FOLLOWER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
CREATE INDEX BCIDX_AR_TM ON BC_IDENTITY_ACTOR_RELATION (TYPE_, MASTER_ID);
CREATE INDEX BCIDX_AR_TF ON BC_IDENTITY_ACTOR_RELATION (TYPE_, FOLLOWER_ID);

-- ACTOR隶属信息的变动历史
CREATE TABLE BC_IDENTITY_ACTOR_HISTORY (
   ID                   INTEGER           NOT NULL,
   PID                  integer,
   CURRENT              boolean NOT NULL default true,
   RANK              	integer NOT NULL DEFAULT 0,
   CREATE_DATE          timestamp                 NOT NULL,
   START_DATE           timestamp,
   END_DATE             timestamp,
   ACTOR_TYPE           int            NOT NULL,
   ACTOR_ID             integer           NOT NULL,
   ACTOR_NAME           varchar(100)        NOT NULL,
   UPPER_ID             integer,
   UPPER_NAME           varchar(255),
   UNIT_ID              integer,
   UNIT_NAME            varchar(255),
   PCODE varchar(4000),
   PNAME varchar(4000),
   CONSTRAINT BCPK_ACTOR_HISTORY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_ACTOR_HISTORY IS 'ACTOR隶属信息的变动历史';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.PID IS '对应旧记录的id';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.CURRENT IS '是否为当前配置';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.RANK IS '多个当前配置间的首选次序，数值越小级别越高，值从0开始递增，只适用于隶属多个组织的情况';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.CREATE_DATE IS '创建时间';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.START_DATE IS '起始时段';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.END_DATE IS '结束时段';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.ACTOR_TYPE IS 'ACTOR类型';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.ACTOR_ID IS 'ACTORID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.ACTOR_NAME IS 'ACTOR名称';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.UPPER_ID IS '直属上级ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.UPPER_NAME IS '直属上级名称';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.UNIT_ID IS '所在单位ID';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.UNIT_NAME IS '所在单位名称';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.PCODE IS '隶属机构的全编码';
COMMENT ON COLUMN BC_IDENTITY_ACTOR_HISTORY.PNAME IS '隶属机构的全名';
ALTER TABLE BC_IDENTITY_ACTOR_HISTORY ADD CONSTRAINT BCFK_ACTORHISTORY_PID FOREIGN KEY (PID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_IDENTITY_ACTOR_HISTORY ADD CONSTRAINT BCFK_ACTORHISTORY_ACTOR FOREIGN KEY (ACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
CREATE INDEX BCIDX_ACTORHISTORY_ACTORID ON BC_IDENTITY_ACTOR_HISTORY (ACTOR_ID ASC);
CREATE INDEX BCIDX_ACTORHISTORY_ACTORNAME ON BC_IDENTITY_ACTOR_HISTORY (ACTOR_NAME ASC);
CREATE INDEX BCIDX_ACTORHISTORY_UPPER ON BC_IDENTITY_ACTOR_HISTORY (UPPER_ID ASC);
CREATE INDEX BCIDX_ACTORHISTORY_UNIT ON BC_IDENTITY_ACTOR_HISTORY (UNIT_ID ASC);

-- 认证信息
CREATE TABLE BC_IDENTITY_AUTH (
    ID integer NOT NULL,
    PASSWORD varchar(32) NOT NULL,
    CONSTRAINT BCPK_AUTH PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IDENTITY_AUTH IS '认证信息';
COMMENT ON COLUMN BC_IDENTITY_AUTH.ID IS '与Actor表的id对应';
COMMENT ON COLUMN BC_IDENTITY_AUTH.PASSWORD IS '经MD5加密的密码';
ALTER TABLE BC_IDENTITY_AUTH ADD CONSTRAINT BCFK_AUTH_ACTOR FOREIGN KEY (ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);

-- 标识生成器
CREATE TABLE BC_IDENTITY_IDGENERATOR (
  TYPE_ varchar(45) NOT NULL,
  VALUE_ integer NOT NULL,
  FORMAT varchar(45) ,
  CONSTRAINT BCPK_IDGENERATOR PRIMARY KEY (TYPE_)
);
COMMENT ON TABLE BC_IDENTITY_IDGENERATOR IS '标识生成器,用于生成主键或唯一编码用';
COMMENT ON COLUMN BC_IDENTITY_IDGENERATOR.TYPE_ IS '分类';
COMMENT ON COLUMN BC_IDENTITY_IDGENERATOR.VALUE_ IS '当前值';
COMMENT ON COLUMN BC_IDENTITY_IDGENERATOR.FORMAT IS '格式模板,如“case-${V}”、“${T}-${V}”,V代表value的值，T代表type_的值';

-- 参与者与角色的关联
CREATE TABLE BC_IDENTITY_ROLE_ACTOR (
    AID integer NOT NULL,
    RID integer NOT NULL,
    CONSTRAINT BCPK_ROLE_ACTOR PRIMARY KEY (AID,RID)
);
ALTER TABLE BC_IDENTITY_ROLE_ACTOR ADD CONSTRAINT BCFK_RA_ACTOR FOREIGN KEY (AID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BC_IDENTITY_ROLE_ACTOR ADD CONSTRAINT BCFK_RA_ROLE FOREIGN KEY (RID) 
	REFERENCES BC_IDENTITY_ROLE (ID);
COMMENT ON TABLE BC_IDENTITY_ROLE_ACTOR IS '参与者与角色的关联：参与者拥有哪些角色';
COMMENT ON COLUMN BC_IDENTITY_ROLE_ACTOR.AID IS '参与者ID';
COMMENT ON COLUMN BC_IDENTITY_ROLE_ACTOR.RID IS '角色ID';
	
-- ##系统桌面相关模块##
-- 桌面快捷方式
create table BC_DESKTOP_SHORTCUT (
    ID INTEGER NOT NULL,
    UID_ varchar(36),
    STATUS_ int NOT NULL,
    INNER_ boolean NOT NULL default false,
    ORDER_ varchar(100) NOT NULL,
    STANDALONE boolean NOT NULL default false,
    NAME varchar(255),
    URL varchar(255),
    ICONCLASS varchar(255),
    SID integer default 0 NOT NULL,
    AID integer default 0 NOT NULL,
    CONSTRAINT BCPK_DESKTOP_SHORTCUT primary key (ID)
);
COMMENT ON TABLE BC_DESKTOP_SHORTCUT IS '桌面快捷方式';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.UID_ IS '全局标识';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.INNER_ IS '是否为内置对象:0-否,1-是';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.STANDALONE IS '是否在独立的浏览器窗口中打开';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.NAME IS '名称,为空则使用模块的名称';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.URL IS '地址,为空则使用模块的地址';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.ICONCLASS IS '图标样式';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.SID IS '对应的资源ID';
COMMENT ON COLUMN BC_DESKTOP_SHORTCUT.AID IS '所属的参与者(如果为上级参与者,如单位部门,则其下的所有参与者都拥有该快捷方式)';
CREATE INDEX BCIDX_SHORTCUT ON BC_DESKTOP_SHORTCUT (AID,SID);

-- 个人设置
CREATE TABLE BC_DESKTOP_PERSONAL (
    ID INTEGER NOT NULL,
    UID_ varchar(36),
    STATUS_ int  NOT NULL,
    FONT varchar(2) NOT NULL,
    THEME varchar(255) NOT NULL,
    AID integer default 0 NOT NULL,
    INNER_ boolean NOT NULL default false,
    CONSTRAINT BCPK_DESKTOP_PERSONAL PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_DESKTOP_PERSONAL IS '个人设置';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.UID_ IS '全局标识';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.FONT IS '字体大小，如12、14、16';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.THEME IS '主题名称,如base';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.AID IS '所属的参与者';
COMMENT ON COLUMN BC_DESKTOP_PERSONAL.INNER_ IS '是否为内置对象:0-否,1-是';
ALTER TABLE BC_DESKTOP_PERSONAL ADD CONSTRAINT BCUK_PERSONAL_AID UNIQUE (AID);

-- 消息模块
CREATE TABLE BC_MESSAGE (
    ID INTEGER NOT NULL,
    UID_ varchar(36),
    STATUS_ int default 0 NOT NULL,
    TYPE_ int default 0 NOT NULL,
    SENDER_ID integer NOT NULL,
    SEND_DATE timestamp NOT NULL,
    RECEIVER_ID integer NOT NULL,
    READ_ int default 0 NOT NULL,
    FROM_ID integer,
    FROM_TYPE integer,
    SUBJECT varchar(255) NOT NULL,
    CONTENT varchar(4000),
    CONSTRAINT BCPK_MESSAGE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_MESSAGE IS '消息模块';
COMMENT ON COLUMN BC_MESSAGE.STATUS_ IS '状态：0-发送中,1-已发送,2-已删除,3-发送失败';
COMMENT ON COLUMN BC_MESSAGE.TYPE_ IS '消息类型';
COMMENT ON COLUMN BC_MESSAGE.SENDER_ID IS '发送者';
COMMENT ON COLUMN BC_MESSAGE.SEND_DATE IS '发送时间';
COMMENT ON COLUMN BC_MESSAGE.RECEIVER_ID IS '接收者';
COMMENT ON COLUMN BC_MESSAGE.FROM_ID IS '来源标识';
COMMENT ON COLUMN BC_MESSAGE.FROM_TYPE IS '来源类型';
COMMENT ON COLUMN BC_MESSAGE.READ_ IS '已阅标记';
COMMENT ON COLUMN BC_MESSAGE.SUBJECT IS '标题';
COMMENT ON COLUMN BC_MESSAGE.CONTENT IS '内容';
ALTER TABLE BC_MESSAGE ADD CONSTRAINT BCFK_MESSAGE_SENDER FOREIGN KEY (SENDER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_MESSAGE ADD CONSTRAINT BCFK_MESSAGE_REVEIVER FOREIGN KEY (RECEIVER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BCIDX_MESSAGE_FROMID ON BC_MESSAGE (FROM_TYPE,FROM_ID);
CREATE INDEX BCIDX_MESSAGE_TYPE ON BC_MESSAGE (TYPE_);

-- 工作事项
CREATE TABLE BC_WORK (
    ID INTEGER NOT NULL,
    CLASSIFIER varchar(500) NOT NULL,
    SUBJECT varchar(255) NOT NULL,
    FROM_ID integer,
    FROM_TYPE integer,
    FROM_INFO varchar(255),
    OPEN_URL varchar(255),
    CONTENT varchar(4000),
    CONSTRAINT BCPK_WORK PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_WORK IS '工作事项';
COMMENT ON COLUMN BC_WORK.CLASSIFIER IS '分类词,可多级分类,级间使用/连接,如“发文类/正式发文”';
COMMENT ON COLUMN BC_WORK.SUBJECT IS '标题';
COMMENT ON COLUMN BC_WORK.FROM_ID IS '来源标识';
COMMENT ON COLUMN BC_WORK.FROM_TYPE IS '来源类型';
COMMENT ON COLUMN BC_WORK.FROM_INFO IS '来源描述';
COMMENT ON COLUMN BC_WORK.OPEN_URL IS '打开的Url模板';
COMMENT ON COLUMN BC_WORK.CONTENT IS '内容';
CREATE INDEX BCIDX_WORK_FROM ON BC_WORK (FROM_TYPE,FROM_ID);

-- 待办事项
CREATE TABLE BC_WORK_TODO (
    ID INTEGER NOT NULL,
    WORK_ID integer NOT NULL,
    SENDER_ID integer NOT NULL,
    SEND_DATE timestamp NOT NULL,
    WORKER_ID integer NOT NULL,
    INFO varchar(255),
    CONSTRAINT BCPK_WORK_TODO PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_WORK_TODO IS '待办事项';
COMMENT ON COLUMN BC_WORK_TODO.WORK_ID IS '工作事项ID';
COMMENT ON COLUMN BC_WORK_TODO.SENDER_ID IS '发送者';
COMMENT ON COLUMN BC_WORK_TODO.SEND_DATE IS '发送时间';
COMMENT ON COLUMN BC_WORK_TODO.WORKER_ID IS '发送者';
COMMENT ON COLUMN BC_WORK_TODO.INFO IS '附加说明';
ALTER TABLE BC_WORK_TODO ADD CONSTRAINT BCFK_TODOWORK_WORK FOREIGN KEY (WORK_ID) 
	REFERENCES BC_WORK (ID);
ALTER TABLE BC_WORK_TODO ADD CONSTRAINT BCFK_TODOWORK_SENDER FOREIGN KEY (SENDER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BC_WORK_TODO ADD CONSTRAINT BCFK_TODOWORK_WORKER FOREIGN KEY (WORKER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);

-- 已办事项
CREATE TABLE BC_WORK_DONE (
    ID INTEGER NOT NULL,
    FINISH_DATE timestamp NOT NULL,
    FINISH_YEAR integer  NOT NULL,
    FINISH_MONTH integer  NOT NULL,
    FINISH_DAY integer  NOT NULL,
    WORK_ID integer NOT NULL,
    SENDER_ID integer NOT NULL,
    SEND_DATE timestamp NOT NULL,
    WORKER_ID integer NOT NULL,
    INFO varchar(255),
    CONSTRAINT BCPK_WORK_DONE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_WORK_DONE IS '已办事项';
COMMENT ON COLUMN BC_WORK_DONE.FINISH_DATE IS '完成时间';
COMMENT ON COLUMN BC_WORK_DONE.FINISH_YEAR IS '完成时间的年度';
COMMENT ON COLUMN BC_WORK_DONE.FINISH_MONTH IS '完成时间的月份(1-12)';
COMMENT ON COLUMN BC_WORK_DONE.FINISH_DAY IS '完成时间的日(1-31)';
COMMENT ON COLUMN BC_WORK_DONE.WORK_ID IS '工作事项ID';
COMMENT ON COLUMN BC_WORK_DONE.SENDER_ID IS '发送者';
COMMENT ON COLUMN BC_WORK_DONE.SEND_DATE IS '发送时间';
COMMENT ON COLUMN BC_WORK_DONE.WORKER_ID IS '发送者';
COMMENT ON COLUMN BC_WORK_DONE.INFO IS '附加说明';
ALTER TABLE BC_WORK_DONE ADD CONSTRAINT BCFK_DONEWORK_WORK FOREIGN KEY (WORK_ID) 
	REFERENCES BC_WORK (ID);
ALTER TABLE BC_WORK_DONE ADD CONSTRAINT BCFK_DONEWORK_SENDER FOREIGN KEY (SENDER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BC_WORK_DONE ADD CONSTRAINT BCFK_DONEWORK_WORKER FOREIGN KEY (WORKER_ID) 
	REFERENCES BC_IDENTITY_ACTOR (ID);
CREATE INDEX BCIDX_DONEWORK_FINISHtimestamp ON BC_WORK_DONE (FINISH_YEAR,FINISH_MONTH,FINISH_DAY);


-- 系统日志
CREATE TABLE BC_LOG_SYSTEM (
    ID INTEGER NOT NULL,
    SID varchar(500),
    TYPE_ int  NOT NULL,
    SUBJECT varchar(500) NOT NULL,
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    C_IP varchar(100),
    C_NAME varchar(100),
    C_MAC varchar(1000),
    C_INFO varchar(1000),
    S_IP varchar(100),
    S_NAME varchar(100),
    S_INFO varchar(1000),
    CONTENT varchar(4000),
    CONSTRAINT BCPK_LOG_SYSTEM PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_LOG_SYSTEM IS '系统日志';
COMMENT ON COLUMN BC_LOG_SYSTEM.SID IS '登录用户的session id';
COMMENT ON COLUMN BC_LOG_SYSTEM.TYPE_ IS '类别：0-登录,1-注销,2-超时';
COMMENT ON COLUMN BC_LOG_SYSTEM.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_LOG_SYSTEM.SUBJECT IS '标题';
COMMENT ON COLUMN BC_LOG_SYSTEM.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_LOG_SYSTEM.C_IP IS '用户机器IP';
COMMENT ON COLUMN BC_LOG_SYSTEM.C_NAME IS '用户机器名称';
COMMENT ON COLUMN BC_LOG_SYSTEM.C_MAC IS '用户mac地址';
COMMENT ON COLUMN BC_LOG_SYSTEM.C_INFO IS '用户浏览器信息：User-Agent';
COMMENT ON COLUMN BC_LOG_SYSTEM.S_IP IS '服务器IP';
COMMENT ON COLUMN BC_LOG_SYSTEM.S_NAME IS '服务器名称';
COMMENT ON COLUMN BC_LOG_SYSTEM.S_INFO IS '服务器信息';
COMMENT ON COLUMN BC_LOG_SYSTEM.CONTENT IS '详细内容';
ALTER TABLE BC_LOG_SYSTEM ADD CONSTRAINT BCFK_SYSLOG_USER FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BCIDX_SYSLOG_CLIENT ON BC_LOG_SYSTEM (C_IP);
CREATE INDEX BCIDX_SYSLOG_SERVER ON BC_LOG_SYSTEM (S_IP);

-- 操作日志
CREATE TABLE BC_LOG_OPERATE (
    ID INTEGER NOT NULL,
    TYPE_ int  NOT NULL,
    WAY int  NOT NULL,
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    UID_ varchar(255),
    PTYPE varchar(255),
    PID varchar(255),
    OPERATE varchar(255),
    SUBJECT varchar(500) NOT NULL,
    CONTENT varchar(4000),
    CONSTRAINT BCPK_LOG_OPERATE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_LOG_OPERATE IS '操作日志:包括工作日志和审计日志';
COMMENT ON COLUMN BC_LOG_OPERATE.TYPE_ IS '类别：0-工作日志,1-审计日志';
COMMENT ON COLUMN BC_LOG_OPERATE.WAY IS '创建方式：0-用户创建,1-自动生成';
COMMENT ON COLUMN BC_LOG_OPERATE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_LOG_OPERATE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_LOG_OPERATE.UID_ IS 'uid';
COMMENT ON COLUMN BC_LOG_OPERATE.PID IS '文档标识，通常使用文档的id、uid或批号';
COMMENT ON COLUMN BC_LOG_OPERATE.PTYPE IS '所属模块:如User、Role，一般为类名';
COMMENT ON COLUMN BC_LOG_OPERATE.OPERATE IS '操作分类:如create、update、delete等';
COMMENT ON COLUMN BC_LOG_OPERATE.SUBJECT IS '标题';
COMMENT ON COLUMN BC_LOG_OPERATE.CONTENT IS '详细内容';
ALTER TABLE BC_LOG_OPERATE ADD CONSTRAINT BCFK_OPERATELOG_USER FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BCIDX_OPERATELOG_PARENT ON BC_LOG_OPERATE (PTYPE,PID);
CREATE INDEX BCIDX_OPERATELOG_SUBJECT ON BC_LOG_OPERATE (SUBJECT);

-- 审计日志对应的审计条目
CREATE TABLE BC_LOG_AUDIT_ITEM (
    ID INTEGER NOT NULL,
    PID INTEGER NOT NULL,
    KEY_ varchar(255),
    LABLE varchar(255),
    OLD_VALUE varchar(4000),
    NEW_VALUE varchar(4000) NOT NULL,
    ORDER_ varchar(10),
    CONSTRAINT BCPK_LOG_AUDIT_ITEM PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_LOG_AUDIT_ITEM IS '审计日志对应的审计条目';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.PID IS '所隶属日志的id';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.KEY_ IS '审计条目:如字段名、属性名';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.LABLE IS '审计条目的描述:如字段名、属性名的中文描述';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.OLD_VALUE IS '原值';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.NEW_VALUE IS '新值';
COMMENT ON COLUMN BC_LOG_AUDIT_ITEM.ORDER_ IS '同一PID内的排序号';
ALTER TABLE BC_LOG_AUDIT_ITEM ADD CONSTRAINT BCFK_AUDITITEM_PID FOREIGN KEY (PID) 
	REFERENCES BC_LOG_OPERATE (ID);
CREATE INDEX BCIDX_AUDITITEM_PID ON BC_LOG_OPERATE (PID);


-- 公告模块
CREATE TABLE BC_BULLETIN (
    ID INTEGER NOT NULL,
    UID_ varchar(36) NOT NULL,
    UNIT_ID integer,
    SCOPE int  NOT NULL,
    STATUS_ int  NOT NULL,
    OVERDUE_DATE timestamp,
    ISSUE_DATE timestamp,
    ISSUER_ID integer,
    SUBJECT varchar(500) NOT NULL,
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    MODIFIER_ID integer,
    MODIFIED_DATE timestamp,
    CONTENT varchar(4000) NOT NULL,
    CONSTRAINT BCPK_BULLETIN PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_BULLETIN IS '公告模块';
COMMENT ON COLUMN BC_BULLETIN.UID_ IS '关联附件的标识号';
COMMENT ON COLUMN BC_BULLETIN.UNIT_ID IS '公告所属单位ID';
COMMENT ON COLUMN BC_BULLETIN.SCOPE IS '公告发布范围：0-本单位,1-全系统';
COMMENT ON COLUMN BC_BULLETIN.STATUS_ IS '状态:0-草稿,1-已发布,2-已过期';
COMMENT ON COLUMN BC_BULLETIN.OVERDUE_DATE IS '过期日期：为空代表永不过期';
COMMENT ON COLUMN BC_BULLETIN.ISSUE_DATE IS '发布时间';
COMMENT ON COLUMN BC_BULLETIN.ISSUER_ID IS '发布人ID';
COMMENT ON COLUMN BC_BULLETIN.SUBJECT IS '标题';
COMMENT ON COLUMN BC_BULLETIN.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_BULLETIN.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_BULLETIN.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_BULLETIN.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BC_BULLETIN.CONTENT IS '详细内容';
ALTER TABLE BC_BULLETIN ADD CONSTRAINT BCFK_BULLETIN_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_BULLETIN ADD CONSTRAINT BCFK_BULLETIN_ISSUER FOREIGN KEY (ISSUER_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BC_BULLETIN ADD CONSTRAINT BCFK_BULLETIN_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_BULLETIN ADD CONSTRAINT BCFK_BULLETIN_UNIT FOREIGN KEY (UNIT_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
CREATE INDEX BCIDX_BULLETIN_SEARCH ON BC_BULLETIN (SCOPE,UNIT_ID,STATUS_);

-- 文档附件
CREATE TABLE BC_DOCS_ATTACH (
    ID INTEGER NOT NULL,
    STATUS_ int  NOT NULL,
    PTYPE varchar(36) NOT NULL,
    PUID varchar(36) NOT NULL,
    SIZE_ integer NOT NULL,
    COUNT_ integer default 0 NOT NULL,
    format varchar(10),
    APPPATH boolean NOT NULL default false,
    SUBJECT varchar(500) NOT NULL,
    ICON varchar(255),
    PATH varchar(500) NOT NULL,
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    MODIFIER_ID integer,
    MODIFIED_DATE timestamp,
    CONSTRAINT BCPK_ATTACH PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_DOCS_ATTACH IS '文档附件,记录文档与其相关附件之间的关系';
COMMENT ON COLUMN BC_DOCS_ATTACH.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_DOCS_ATTACH.PTYPE IS '所关联文档的类型';
COMMENT ON COLUMN BC_DOCS_ATTACH.PUID IS '所关联文档的UID';
COMMENT ON COLUMN BC_DOCS_ATTACH.SIZE_ IS '文件的大小(单位为字节)';
COMMENT ON COLUMN BC_DOCS_ATTACH.COUNT_ IS '文件的下载次数';
COMMENT ON COLUMN BC_DOCS_ATTACH.format IS '附件类型:如pdf、doc、mp3等';
COMMENT ON COLUMN BC_DOCS_ATTACH.APPPATH IS '指定path的值是相对于应用部署目录下路径还是相对于全局配置的app.data目录下的路径';
COMMENT ON COLUMN BC_DOCS_ATTACH.ICON IS '扩展字段';
COMMENT ON COLUMN BC_DOCS_ATTACH.SUBJECT IS '文件名称(不带路径的部分)';
COMMENT ON COLUMN BC_DOCS_ATTACH.PATH IS '物理文件保存的相对路径(相对于全局配置的附件根目录下的子路径，如"2011/bulletin/xxxx.doc")';

COMMENT ON COLUMN BC_DOCS_ATTACH.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_DOCS_ATTACH.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_DOCS_ATTACH.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_DOCS_ATTACH.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_DOCS_ATTACH ADD CONSTRAINT BCFK_ATTACH_AUTHOR FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_DOCS_ATTACH ADD CONSTRAINT BCFK_ATTACH_MODIFIER FOREIGN KEY (MODIFIER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BCIDX_ATTACH_PUID ON BC_DOCS_ATTACH (PUID);
CREATE INDEX BCIDX_ATTACH_PTYPE ON BC_DOCS_ATTACH (PTYPE);

-- 附件处理痕迹
CREATE TABLE BC_DOCS_ATTACH_HISTORY (
    ID INTEGER NOT NULL,
    TYPE_ integer NOT NULL,
    SUBJECT varchar(500) NOT NULL,
    FORMAT varchar(10),
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    ptype varchar(36) NOT NULL,
    puid varchar(36) NOT NULL,
    path varchar(500) NOT NULL,
    apppath boolean default false NOT NULL,
    C_IP varchar(100),
    C_INFO varchar(1000),
    MEMO varchar(2000),
    CONSTRAINT BCPK_ATTACH_HISTORY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_DOCS_ATTACH_HISTORY IS '附件处理痕迹';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.TYPE_ IS '处理类型：0-下载,1-在线查看,2-格式转换';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.SUBJECT IS '简单说明';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.FORMAT IS '下载的文件格式或转换后的文件格式：如pdf、doc、mp3等';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.C_IP IS '客户端IP';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.C_INFO IS '浏览器信息：User-Agent';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.MEMO IS '备注';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.FILE_DATE IS '处理时间';
COMMENT ON COLUMN BC_DOCS_ATTACH_HISTORY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN bc_docs_attach_history.path IS '物理文件保存的相对路径(相对于全局配置的附件根目录下的子路径，如"2011/bulletin/xxxx.doc")';
COMMENT ON COLUMN bc_docs_attach_history.apppath IS '指定path的值是相对于应用部署目录下路径还是相对于全局配置的app.data目录下的路径';
COMMENT ON COLUMN bc_docs_attach_history.format IS '附件类型:如pdf、doc、mp3等';
COMMENT ON COLUMN bc_docs_attach_history.ptype IS '文档类型';
COMMENT ON COLUMN bc_docs_attach_history.puid IS '文档标识';
ALTER TABLE BC_DOCS_ATTACH_HISTORY ADD CONSTRAINT BCFK_ATTACHHISTORY_AUTHOR FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_DOCS_ATTACH_HISTORY ADD CONSTRAINT BCFK_ATTACHHISTORY_MODIFIER FOREIGN KEY (MODIFIER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_DOCS_ATTACH_HISTORY ADD CONSTRAINT BCFK_ATTACHHISTORY_ATTACH FOREIGN KEY (AID) 
	REFERENCES BC_DOCS_ATTACH (ID);

-- 用户反馈
CREATE TABLE BC_FEEDBACK (
    ID INTEGER NOT NULL,
    UID_ varchar(36) NOT NULL,
    STATUS_ int  NOT NULL,
    SUBJECT varchar(500) NOT NULL,
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    MODIFIER_ID integer,
    MODIFIED_DATE timestamp,
	LAST_REPLIER_ID integer,
	LAST_REPLY_DATE timestamp,
	REPLY_COUNT integer DEFAULT 0 NOT NULL,
    CONTENT text NOT NULL,
    CONSTRAINT BCPK_FEEDBACK PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_FEEDBACK IS '用户反馈';
COMMENT ON COLUMN BC_FEEDBACK.UID_ IS '关联附件的标识号';
COMMENT ON COLUMN BC_FEEDBACK.STATUS_ IS '状态:0-草稿,1-已提交,2-已受理';
COMMENT ON COLUMN BC_FEEDBACK.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_FEEDBACK.SUBJECT IS '标题';
COMMENT ON COLUMN BC_FEEDBACK.CONTENT IS '详细内容';
COMMENT ON COLUMN BC_FEEDBACK.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_FEEDBACK.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_FEEDBACK.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BC_FEEDBACK.LAST_REPLIER_ID IS '最后回复人ID';
COMMENT ON COLUMN BC_FEEDBACK.LAST_REPLY_DATE IS '最后回复时间';
COMMENT ON COLUMN BC_FEEDBACK.REPLY_COUNT IS '回复的总数量';
ALTER TABLE BC_FEEDBACK ADD CONSTRAINT BCFK_FEEDBACK_AUTHOR FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_FEEDBACK ADD CONSTRAINT BCFK_FEEDBACK_MODIFIER FOREIGN KEY (MODIFIER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_FEEDBACK ADD CONSTRAINT BSFK_FEEDBACK_REPLIER FOREIGN KEY (LAST_REPLIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 用户反馈的回复
CREATE TABLE BC_FEEDBACK_REPLY (
    ID INTEGER NOT NULL,
    PID INTEGER NOT NULL,
    UID_ varchar(36) NOT NULL,
    STATUS_ int  NOT NULL,
    SUBJECT varchar(500),
    FILE_DATE timestamp NOT NULL,
    AUTHOR_ID integer NOT NULL,
    MODIFIER_ID integer,
    MODIFIED_DATE timestamp,
    CONTENT text,
    CONSTRAINT BCPK_FEEDBACK_REPLY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_FEEDBACK_REPLY IS '用户反馈的回复';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.PID IS '所属反馈的id';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.UID_ IS '关联附件的标识号';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.STATUS_ IS '状态:0-正常,1-禁用,2-删除';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.SUBJECT IS '标题';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.CONTENT IS '详细内容';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_FEEDBACK_REPLY.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_FEEDBACK_REPLY ADD CONSTRAINT BCFK_FEEDBACK_REPLY_PID FOREIGN KEY (PID) 
	REFERENCES BC_FEEDBACK (ID);
ALTER TABLE BC_FEEDBACK_REPLY ADD CONSTRAINT BCFK_FEEDBACK_REPLY_AUTHOR FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_FEEDBACK_REPLY ADD CONSTRAINT BCFK_FEEDBACK_REPLY_MODIFIER FOREIGN KEY (MODIFIER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- ##选项模块##
-- 选项分组
CREATE TABLE BC_OPTION_GROUP (
    ID INTEGER NOT NULL,
    KEY_ varchar(255) NOT NULL,
    VALUE_ varchar(255) NOT NULL,
    ORDER_ varchar(100),
    ICON varchar(100),
    CONSTRAINT BCPK_OPTION_GROUP PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_OPTION_GROUP IS '选项分组';
COMMENT ON COLUMN BC_OPTION_GROUP.KEY_ IS '键';
COMMENT ON COLUMN BC_OPTION_GROUP.VALUE_ IS '值';
COMMENT ON COLUMN BC_OPTION_GROUP.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_OPTION_GROUP.ICON IS '图标样式';
CREATE INDEX BCIDX_OPTIONGROUP_KEY ON BC_OPTION_GROUP (KEY_);
CREATE INDEX BCIDX_OPTIONGROUP_VALUE ON BC_OPTION_GROUP (VALUE_);

-- 选项条目
CREATE TABLE BC_OPTION_ITEM (
    ID INTEGER NOT NULL,
    PID integer NOT NULL,
    KEY_ varchar(255) NOT NULL,
    VALUE_ varchar(255) NOT NULL,
    ORDER_ varchar(100),
    ICON varchar(100),
    STATUS_ int  NOT NULL,
    DESC_ varchar(1000),
    CONSTRAINT BCPK_OPTION_ITEM PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_OPTION_ITEM IS '选项条目';
COMMENT ON COLUMN BC_OPTION_ITEM.PID IS '所属分组的ID';
COMMENT ON COLUMN BC_OPTION_ITEM.KEY_ IS '键';
COMMENT ON COLUMN BC_OPTION_ITEM.VALUE_ IS '值';
COMMENT ON COLUMN BC_OPTION_ITEM.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_OPTION_ITEM.ICON IS '图标样式';
COMMENT ON COLUMN BC_OPTION_ITEM.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BC_OPTION_ITEM.DESC_ IS '说明';
ALTER TABLE BC_OPTION_ITEM ADD CONSTRAINT BCFK_OPTIONITEM_OPTIONGROUP FOREIGN KEY (PID) 
	REFERENCES BC_OPTION_GROUP (ID);
CREATE INDEX BCIDX_OPTIONITEM_KEY ON BC_OPTION_ITEM (KEY_);
CREATE INDEX BCIDX_OPTIONITEM_VALUE ON BC_OPTION_ITEM (VALUE_);
CREATE INDEX BCIDX_OPTIONITEM_PID ON BC_OPTION_ITEM (PID);

-- 调度任务配置
CREATE TABLE BC_SD_JOB (
    ID INTEGER NOT NULL,
    STATUS_ int  NOT NULL,
    NAME varchar(255) NOT NULL,
    GROUPN varchar(255) NOT NULL,
    CRON varchar(255) NOT NULL,
    BEAN varchar(255) NOT NULL,
    METHOD varchar(255) NOT NULL,
    IGNORE_ERROR boolean NOT NULL DEFAULT false,
    ORDER_ varchar(100),
    NEXT_DATE timestamp,
    MEMO_ varchar(1000),
    CONSTRAINT BCPK_SD_JOB PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_SD_JOB IS '调度任务配置';
COMMENT ON COLUMN BC_SD_JOB.NAME IS '名称';
COMMENT ON COLUMN BC_SD_JOB.BEAN IS '要调用的SpringBean名';
COMMENT ON COLUMN BC_SD_JOB.METHOD IS '要调用的SpringBean方法名';
COMMENT ON COLUMN BC_SD_JOB.IGNORE_ERROR IS '发现异常是否忽略后继续调度:0-否,1-是';
COMMENT ON COLUMN BC_SD_JOB.MEMO_ IS '备注';
COMMENT ON COLUMN BC_SD_JOB.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除,3-正在运行,4-暂停';
COMMENT ON COLUMN BC_SD_JOB.GROUPN IS '分组名';
COMMENT ON COLUMN BC_SD_JOB.CRON IS '表达式';
COMMENT ON COLUMN BC_SD_JOB.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_SD_JOB.NEXT_DATE IS '任务的下一运行时间';

-- 任务调度日志
CREATE TABLE BC_SD_LOG (
    ID INTEGER NOT NULL,
    SUCCESS boolean NOT NULL DEFAULT false,
    START_DATE timestamp NOT NULL,
    END_DATE timestamp NOT NULL,
    CFG_CRON varchar(255) NOT NULL,
    CFG_NAME varchar(255),
    CFG_GROUP varchar(255),
    CFG_BEAN varchar(255),
    CFG_METHOD varchar(255),
    ERROR_TYPE varchar(255),
    MSG text,
    CONSTRAINT BCPK_SD_LOG PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_SD_LOG IS '任务调度日志';
COMMENT ON COLUMN BC_SD_LOG.SUCCESS IS '任务是否处理成功';
COMMENT ON COLUMN BC_SD_LOG.START_DATE IS '任务的启动时间';
COMMENT ON COLUMN BC_SD_LOG.END_DATE IS '任务的结束时间';
COMMENT ON COLUMN BC_SD_LOG.ERROR_TYPE IS '异常分类';
COMMENT ON COLUMN BC_SD_LOG.MSG IS '异常信息';
COMMENT ON COLUMN BC_SD_LOG.CFG_CRON IS '对应ScheduleJob的cron';
COMMENT ON COLUMN BC_SD_LOG.CFG_NAME IS '对应ScheduleJob的name';
COMMENT ON COLUMN BC_SD_LOG.CFG_GROUP IS '对应ScheduleJob的groupn';
COMMENT ON COLUMN BC_SD_LOG.CFG_BEAN IS '对应ScheduleJob的bean';
COMMENT ON COLUMN BC_SD_LOG.CFG_METHOD IS '对应ScheduleJob的method';

-- 同步信息基表
CREATE TABLE BC_SYNC_BASE (
    ID INTEGER NOT NULL,
    STATUS_ INTEGER default 0 NOT NULL,
    SYNC_TYPE varchar(255) NOT NULL,
    SYNC_CODE varchar(255) NOT NULL,
    SYNC_FROM varchar(1000) NOT NULL,
    SYNC_DATE timestamp NOT NULL,
    AUTHOR_ID INTEGER NOT NULL,
    CONSTRAINT BCPK_SYNC_BASE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_SYNC_BASE IS '同步信息基表';
COMMENT ON COLUMN BC_SYNC_BASE.STATUS_ IS '状态:0-同步后待处理,1-已处理';
COMMENT ON COLUMN BC_SYNC_BASE.SYNC_TYPE IS '同步信息的类型';
COMMENT ON COLUMN BC_SYNC_BASE.SYNC_CODE IS '同步信息的标识符';
COMMENT ON COLUMN BC_SYNC_BASE.SYNC_FROM IS '同步信息的来源';
COMMENT ON COLUMN BC_SYNC_BASE.SYNC_DATE IS '同步时间';
COMMENT ON COLUMN BC_SYNC_BASE.AUTHOR_ID IS '同步人ID';
ALTER TABLE BC_SYNC_BASE ADD CONSTRAINT BCFK_SYNC_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_SYNC_BASE ADD CONSTRAINT BCUK_SYNC_ID UNIQUE (SYNC_TYPE,SYNC_CODE);

-- 籍贯
CREATE TABLE BC_PLACEORIGIN(
	ID INTEGER NOT NULL,
	PID INTEGER,
	TYPE_ int  DEFAULT 0 NOT NULL,
    STATUS_ int  DEFAULT 0 NOT NULL,
	CODE varchar(255),
    FULL_CODE varchar(255),
	NAME varchar(255) NOT NULL,
	FULL_NAME varchar(255) NOT NULL,
	DESC_ varchar(4000),
	FILE_DATE TIMESTAMP NOT NULL,
    AUTHOR_ID INTEGER NOT NULL,
    MODIFIER_ID INTEGER,
    MODIFIED_DATE TIMESTAMP,
	CONSTRAINT BCPK_PLACEORIGIN PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_PLACEORIGIN IS '籍贯模块';
COMMENT ON COLUMN BC_PLACEORIGIN.PID IS '所隶属的上级地方ID';
COMMENT ON COLUMN BC_PLACEORIGIN.TYPE_ IS '类型(0-国家,1-省级,2-地级,3-县级,4-乡级,5-村级)';
COMMENT ON COLUMN BC_PLACEORIGIN.STATUS_ IS '状态：0-启用中,1-已禁用';
COMMENT ON COLUMN BC_PLACEORIGIN.CODE IS '统计用区划代码和城乡划分代码';
COMMENT ON COLUMN BC_PLACEORIGIN.FULL_CODE IS '全编码 统计用区划代码和城乡划分代码';
COMMENT ON COLUMN BC_PLACEORIGIN.NAME  IS '名称 例如：荔湾区';
COMMENT ON COLUMN BC_PLACEORIGIN.FULL_NAME IS '全名 例如：广东省广州市荔湾区';
COMMENT ON COLUMN BC_PLACEORIGIN.DESC_ IS '描述';
COMMENT ON COLUMN BC_PLACEORIGIN.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_PLACEORIGIN.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_PLACEORIGIN.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_PLACEORIGIN.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_PLACEORIGIN ADD CONSTRAINT BCFK_PLACEORIGIN_PID FOREIGN KEY (PID) 
		REFERENCES BC_PLACEORIGIN (ID);
ALTER TABLE BC_PLACEORIGIN ADD CONSTRAINT BCFK_PLACEORIGIN_AUTHORID FOREIGN KEY (AUTHOR_ID)
		REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_PLACEORIGIN ADD CONSTRAINT BCFK_PLACEORIGIN_MODIFIER FOREIGN KEY (MODIFIER_ID)
		REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);	
	  
-- 模板类型
CREATE TABLE BC_TEMPLATE_TYPE(
	ID INTEGER NOT NULL,
	STATUS_ INT NOT NULL DEFAULT 0,
	ORDER_ VARCHAR(255),
	CODE	VARCHAR(255) NOT NULL ,
	NAME VARCHAR(255),
	IS_PATH BOOLEAN NOT NULL DEFAULT FALSE,
	IS_PURE_TEXT BOOLEAN NOT NULL DEFAULT FALSE,
	EXT VARCHAR(255),
	DESC_ VARCHAR(4000),
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	MODIFIER_ID INTEGER ,
	MODIFIED_DATE TIMESTAMP,
	CONSTRAINT BCPK_TEMPLATE_TYPE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_TEMPLATE_TYPE IS '模板类型';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.STATUS_ IS '状态：0-正常，1-禁用';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.CODE IS '编码：全局唯一';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.NAME IS '模板类型名称';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.IS_PATH IS '关联附件';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.IS_PURE_TEXT IS '纯文本';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.EXT IS '附件扩展名';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.DESC_ IS '备注';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_TEMPLATE_TYPE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_TEMPLATE_TYPE ADD CONSTRAINT BCFK_TEMPLATE_TYPE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_TEMPLATE_TYPE ADD CONSTRAINT BCFK_TEMPLATE_TYPE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_TEMPLATE_TYPE ADD CONSTRAINT BCUK_TEMPLATE_TYPE_CODE UNIQUE (CODE);

-- 模板管理
CREATE TABLE BC_TEMPLATE(
	ID 				INTEGER NOT NULL,
	uid_ 			VARCHAR(36) NOT NULL,
	ORDER_ 			VARCHAR(255),
	STATUS_ 		INTEGER NOT NULL DEFAULT 0,
	TYPE_ID 		INTEGER NOT NULL,
	CATEGORY		VARCHAR(255) NOT NULL ,
	CODE			VARCHAR(255) NOT NULL ,
	VERSION_		VARCHAR(255) NOT NULL ,
	SUBJECT			VARCHAR(255),
	PATH 			VARCHAR(255),
	CONTENT 		VARCHAR(4000),
	INNER_ 			boolean NOT NULL DEFAULT false,
	SIZE_ 			INTEGER NOT NULL DEFAULT 0,
	FORMATTED 		BOOLEAN NOT NULL DEFAULT FALSE,
	DESC_ 			VARCHAR(4000),
	FILE_DATE 		TIMESTAMP NOT NULL,
	AUTHOR_ID 		INTEGER NOT NULL,
	MODIFIER_ID 	INTEGER ,
	MODIFIED_DATE 	TIMESTAMP,
	CONSTRAINT BCPK_TEMPLATE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_TEMPLATE IS '模板管理';
COMMENT ON COLUMN BC_TEMPLATE.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_TEMPLATE.uid_ IS 'UID';
COMMENT ON COLUMN BC_TEMPLATE.STATUS_ IS '状态：0-正常,1-禁用';
COMMENT ON COLUMN BC_TEMPLATE.TYPE_ID IS '模板类型ID';
COMMENT ON COLUMN BC_TEMPLATE.CATEGORY IS '所属分类';
COMMENT ON COLUMN BC_TEMPLATE.CODE IS '编码：全局唯一';
COMMENT ON COLUMN BC_TEMPLATE.VERSION_ IS '版本号';
COMMENT ON COLUMN BC_TEMPLATE.SUBJECT IS '标题';
COMMENT ON COLUMN BC_TEMPLATE.PATH IS '物理文件保存的相对路径';
COMMENT ON COLUMN BC_TEMPLATE.CONTENT IS '模板内容：文本和Html类型显示模板内容';
COMMENT ON COLUMN BC_TEMPLATE.INNER_ IS '内置：true-是、false-否，默认否';
COMMENT ON COLUMN BC_TEMPLATE.SIZE_ IS '文件的大小(单位为字节) 默认0';
COMMENT ON COLUMN BC_TEMPLATE.FORMATTED IS '是够允许格式化：默认否';
COMMENT ON COLUMN BC_TEMPLATE.DESC_ IS '描述';
COMMENT ON COLUMN BC_TEMPLATE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_TEMPLATE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_TEMPLATE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_TEMPLATE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_TEMPLATE ADD CONSTRAINT BCFK_TEMPLATE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_TEMPLATE ADD CONSTRAINT BCFK_TEMPLATE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_TEMPLATE ADD CONSTRAINT BCUK_TEMPLATE_CODE_VERSION UNIQUE (CODE,VERSION_);
ALTER TABLE BC_TEMPLATE ADD CONSTRAINT BCFK_TEMPLATE_TYPE_ID FOREIGN KEY (TYPE_ID)
      REFERENCES BC_TEMPLATE_TYPE (ID);

-- 报表模板
CREATE TABLE BC_REPORT_TEMPLATE(
	ID INTEGER NOT NULL,
	STATUS_ INT NOT NULL DEFAULT 0,
	ORDER_ VARCHAR(255),
	CATEGORY VARCHAR(255),
	CODE	VARCHAR(255) NOT NULL ,
	NAME VARCHAR(255),
	DESC_ VARCHAR(4000),
	CONFIG VARCHAR(4000),
	FILE_DATE TIMESTAMP NOT NULL,
  AUTHOR_ID INTEGER NOT NULL,
  MODIFIER_ID INTEGER ,
  MODIFIED_DATE TIMESTAMP,
  CONSTRAINT BCPK_REPORT_TEMPLATE PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_REPORT_TEMPLATE IS '报表模板';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.status_ IS '状态：0-启用,1-禁用';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.CATEGORY IS '所属分类，如"营运系统/发票统计"';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.CODE IS '编码：全局唯一';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.NAME IS '名称';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.DESC_ IS '备注';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.CONFIG IS '详细配置';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_REPORT_TEMPLATE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_REPORT_TEMPLATE ADD CONSTRAINT BCFK_REPORT_TEMPLATE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_REPORT_TEMPLATE ADD CONSTRAINT BCFK_REPORT_TEMPLATE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_REPORT_TEMPLATE ADD CONSTRAINT BCUK_REPORT_TEMPLATE_CODE UNIQUE (CODE);

-- 报表模板使用人
CREATE TABLE BC_REPORT_TEMPLATE_ACTOR(
		TID INTEGER NOT NULL,
		AID INTEGER NOT NULL,
	CONSTRAINT BCPK_REPORT_TEMPLATE_ACTOR PRIMARY KEY (TID,AID)
);
COMMENT ON TABLE BC_REPORT_TEMPLATE_ACTOR IS '报表模板使用人';
COMMENT ON COLUMN BC_REPORT_TEMPLATE_ACTOR.TID IS '报表模板id';
COMMENT ON COLUMN BC_REPORT_TEMPLATE_ACTOR.AID IS '使用人id';
ALTER TABLE BC_REPORT_TEMPLATE_ACTOR ADD CONSTRAINT BCFK_REPORT_TEMPLATE_ACTOR_REPORT FOREIGN KEY (TID)
      REFERENCES BC_REPORT_TEMPLATE (ID);
ALTER TABLE BC_REPORT_TEMPLATE_ACTOR ADD CONSTRAINT BCFK_REPORT_TEMPLATE_ACTOR_ACTOR FOREIGN KEY (AID)
      REFERENCES BC_IDENTITY_ACTOR (ID);

-- 报表任务
CREATE TABLE BC_REPORT_TASK(
	ID INTEGER NOT NULL,
	STATUS_ INT NOT NULL DEFAULT 0,
	ORDER_ VARCHAR(255),
	NAME VARCHAR(255),
	CRON	VARCHAR(255),
	DESC_ VARCHAR(4000),
	CONFIG VARCHAR(4000),
	START_DATE TIMESTAMP,
	IGNORE_ERROR BOOLEAN NOT NULL DEFAULT FALSE,
	PID INTEGER NOT NULL,
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	MODIFIER_ID INTEGER ,
	MODIFIED_DATE TIMESTAMP,
	CONSTRAINT BCPK_REPORT_TASK PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_REPORT_TASK IS '报表任务';
COMMENT ON COLUMN BC_REPORT_TASK.status_ IS '状态：0-启用,1-禁用';
COMMENT ON COLUMN BC_REPORT_TASK.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_REPORT_TASK.NAME IS '名称';
COMMENT ON COLUMN BC_REPORT_TASK.CRON IS '定时表达式，按标准的cron表达式';
COMMENT ON COLUMN BC_REPORT_TASK.DESC_ IS '备注';
COMMENT ON COLUMN BC_REPORT_TASK.CONFIG IS '详细配置';
COMMENT ON COLUMN BC_REPORT_TASK.START_DATE IS '开始时间';
COMMENT ON COLUMN BC_REPORT_TASK.PID IS '所用模板ID';
COMMENT ON COLUMN BC_REPORT_TASK.IGNORE_ERROR IS '发现异常是否忽略后继续调度';
COMMENT ON COLUMN BC_REPORT_TASK.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_REPORT_TASK.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_REPORT_TASK.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_REPORT_TASK.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_REPORT_TASK ADD CONSTRAINT BCFK_REPORT_TASK_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_REPORT_TASK ADD CONSTRAINT BCFK_REPORT_TASK_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_REPORT_TASK ADD CONSTRAINT BCFK_REPORT_TASK_TEMPLATE FOREIGN KEY (PID)
      REFERENCES BC_REPORT_TEMPLATE (ID);

-- 历史报表
CREATE TABLE BC_REPORT_HISTORY(
	ID INTEGER NOT NULL,
	CATEGORY VARCHAR(255),
	SUBJECT VARCHAR(255),
	MSG VARCHAR(4000),
	SUCCESS BOOLEAN NOT NULL DEFAULT TRUE,
	PATH VARCHAR(4000),
	SOURCE_TYPE VARCHAR(255),
	SOURCE_ID INTEGER,
	START_DATE TIMESTAMP NOT NULL,
	END_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	CONSTRAINT BCPK_REPORT_HISTORY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_REPORT_HISTORY IS '历史报表';
COMMENT ON COLUMN BC_REPORT_HISTORY.CATEGORY IS '所属分类，如"营运系统/发票统计"';
COMMENT ON COLUMN BC_REPORT_HISTORY.SUBJECT IS '标题';
COMMENT ON COLUMN BC_REPORT_HISTORY.MSG IS '运行结果的描述信息，如成功、异常信息';
COMMENT ON COLUMN BC_REPORT_HISTORY.SUCCESS IS '运行是否成功';
COMMENT ON COLUMN BC_REPORT_HISTORY.PATH IS '报表运行结果所在的相对路径';
COMMENT ON COLUMN BC_REPORT_HISTORY.SOURCE_ID IS '来源ID';
COMMENT ON COLUMN BC_REPORT_HISTORY.SOURCE_TYPE IS '来源类型:用户生成、报表任务';
COMMENT ON COLUMN BC_REPORT_HISTORY.START_DATE IS '执行报表的开始时间';
COMMENT ON COLUMN BC_REPORT_HISTORY.END_DATE IS '执行报表的结束时间';
COMMENT ON COLUMN BC_REPORT_HISTORY.AUTHOR_ID IS '创建人ID';
ALTER TABLE BC_REPORT_HISTORY ADD CONSTRAINT BCFK_REPORT_HISTORY_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 问卷
CREATE TABLE BC_IVG_QUESTIONARY (
	ID INTEGER NOT NULL,
	TYPE_ INTEGER NOT NULL DEFAULT 0,
	STATUS_ INTEGER NOT NULL DEFAULT 0,
	SUBJECT VARCHAR(255),
	START_DATE TIMESTAMP NOT NULL,
	END_DATE TIMESTAMP,
	PERMITTED BOOLEAN NOT NULL DEFAULT FALSE,
	ISSUE_DATE TIMESTAMP,
	ISSUER_ID INTEGER,
	PIGEONHOLE_DATE TIMESTAMP,
	PIGEONHOLER_ID INTEGER,
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	MODIFIER_ID INTEGER ,
	MODIFIED_DATE TIMESTAMP,
	CONSTRAINT BCPK_IVG_QUESTIONARY PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_QUESTIONARY IS '问卷';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.TYPE_ IS '类型 : 0-网上调查,1-网上考试';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.STATUS_ IS '状态：-1-草稿,0-已发布,1-已归档';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.SUBJECT IS '标题';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.START_DATE IS '开始日期';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.END_DATE IS '结束日期';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.PERMITTED IS '提交前允许查看统计';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.ISSUE_DATE IS '发布时间';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.ISSUER_ID IS '发布人ID';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.PIGEONHOLE_DATE IS '归档时间';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.PIGEONHOLER_ID IS '归档人ID';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BC_IVG_QUESTIONARY.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BC_IVG_QUESTIONARY ADD CONSTRAINT BCFK_IVG_QUESTIONARY_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_IVG_QUESTIONARY ADD CONSTRAINT BCFK_IVG_QUESTIONARY_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_IVG_QUESTIONARY ADD CONSTRAINT BCFK_IVG_QUESTIONARY_ISSUER FOREIGN KEY (ISSUER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BC_IVG_QUESTIONARY ADD CONSTRAINT BCFK_IVG_QUESTIONARY_PIGEONHOLER FOREIGN KEY (PIGEONHOLER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 问卷所限制的参与人
CREATE TABLE BC_IVG_QUESTIONARY_ACTOR (
    QID integer NOT NULL,
    AID integer NOT NULL,
    CONSTRAINT BCPK_IVG_QUESTIONARY_ACTOR PRIMARY KEY (QID,AID)
);
COMMENT ON TABLE BC_IVG_QUESTIONARY_ACTOR IS '问卷所限制的参与人';
COMMENT ON COLUMN BC_IVG_QUESTIONARY_ACTOR.QID IS '问卷ID';
COMMENT ON COLUMN BC_IVG_QUESTIONARY_ACTOR.AID IS '参与人ID';
ALTER TABLE BC_IVG_QUESTIONARY_ACTOR ADD CONSTRAINT BCFK_IVG_QA_QUESTIONARY FOREIGN KEY (QID) REFERENCES BC_IVG_QUESTIONARY (ID);
ALTER TABLE BC_IVG_QUESTIONARY_ACTOR ADD CONSTRAINT BCFK_IVG_QA_ACTOR FOREIGN KEY (AID) REFERENCES BC_IDENTITY_ACTOR (ID);

-- 问题
CREATE TABLE BC_IVG_QUESTION (
	ID INTEGER NOT NULL,
	PID INTEGER NOT NULL,
	TYPE_ INTEGER NOT NULL DEFAULT 0,
	REQUIRED BOOLEAN NOT NULL DEFAULT TRUE,
	SUBJECT VARCHAR(255),
	ORDER_ INTEGER NOT NULL DEFAULT 0,
	SCORE INT DEFAULT 0 NOT NULL,
	SEPERATE_SCORE BOOLEAN DEFAULT true,
	CONFIG VARCHAR(1000),
	GRADE BOOLEAN NOT NULL DEFAULT FALSE,
	CONSTRAINT BCPK_IVG_QUESTION PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_QUESTION IS '问题';
COMMENT ON COLUMN BC_IVG_QUESTION.PID IS '所属问卷ID';
COMMENT ON COLUMN BC_IVG_QUESTION.TYPE_ IS '类型 : 0-单选题,1-多选题,2-填空题,3-问答题';
COMMENT ON COLUMN BC_IVG_QUESTION.REQUIRED IS '必选题，默认为是';
COMMENT ON COLUMN BC_IVG_QUESTION.SUBJECT IS '标题';
COMMENT ON COLUMN BC_IVG_QUESTION.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_IVG_QUESTION.CONFIG IS '配置:使用json格式，如控制选项水平、垂直布局，控制问答题输入框的默认大小等，格式为：{layout_orientation:"horizontal|vertical",row:5}';
COMMENT ON COLUMN BC_IVG_QUESTION.SCORE IS '分数';
COMMENT ON COLUMN BC_IVG_QUESTION.SEPERATE_SCORE IS '各个选项独立给分:(仅适用于网上考试的多选题)注意答错任一项将为0分';
COMMENT ON COLUMN BC_IVG_QUESTION.GRADE IS '是否需要评分';
ALTER TABLE BC_IVG_QUESTION ADD CONSTRAINT BCFK_IVG_QUESTION_PID FOREIGN KEY (PID)
      REFERENCES BC_IVG_QUESTIONARY (ID);

-- 问题项
CREATE TABLE BC_IVG_QUESTION_ITEM (
	ID INTEGER NOT NULL,
	PID INTEGER NOT NULL,
	SUBJECT VARCHAR(255),
	ORDER_ INTEGER NOT NULL DEFAULT 0,
	STANDARD BOOLEAN DEFAULT false NOT NULL,
	SCORE INT DEFAULT 0 NOT NULL,
	CONFIG VARCHAR(1000),
	CONSTRAINT BCPK_IVG_QUESTION_ITEM PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_QUESTION_ITEM IS '问题项';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.PID IS '所属问题ID';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.SUBJECT IS '单选多选题显示的选项文字,如果为问答题则为默认填写的内容';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.ORDER_ IS '排序号';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.STANDARD IS '标准答案';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.SCORE IS '分数 : 选择此答案的得分';
COMMENT ON COLUMN BC_IVG_QUESTION_ITEM.CONFIG IS '特殊配置 : 用于填空题的标准答案配置，使用json数组格式[{},...]，每个json元素格式为{key:"占位符",value:"标准答案",score:分数}';
ALTER TABLE BC_IVG_QUESTION_ITEM ADD CONSTRAINT BCFK_IVG_QUESTION_ITEM_PID FOREIGN KEY (PID)
      REFERENCES BC_IVG_QUESTION (ID);

-- 作答记录
CREATE TABLE BC_IVG_RESPOND (
	ID INTEGER NOT NULL,
	PID INTEGER NOT NULL,
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	SCORE INT DEFAULT 0 NOT NULL,
	GRADE BOOLEAN NOT NULL DEFAULT FALSE,
	CONSTRAINT BCPK_IVG_RESPOND PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_RESPOND IS '作答记录';
COMMENT ON COLUMN BC_IVG_RESPOND.PID IS '所属问卷ID';
COMMENT ON COLUMN BC_IVG_RESPOND.FILE_DATE IS '作答时间';
COMMENT ON COLUMN BC_IVG_RESPOND.AUTHOR_ID IS '作答人';
COMMENT ON COLUMN BC_IVG_RESPOND.SCORE IS '总得分';
COMMENT ON COLUMN BC_IVG_RESPOND.GRADE IS '是否需要评分';
ALTER TABLE BC_IVG_RESPOND ADD CONSTRAINT BCFK_IVG_RESPOND_PID FOREIGN KEY (PID)
      REFERENCES BC_IVG_QUESTIONARY (ID);
ALTER TABLE BC_IVG_RESPOND ADD CONSTRAINT BCFK_IVG_RESPOND_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 问题项的答案
CREATE TABLE BC_IVG_ANSWER (
	ID INTEGER NOT NULL,
	QID INTEGER NOT NULL,
	RID INTEGER NOT NULL,
	CONTENT VARCHAR(255),
	SCORE INT DEFAULT 0 NOT NULL,
	GRADE BOOLEAN NOT NULL DEFAULT FALSE,
	CONSTRAINT BCPK_IVG_ANSWER PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_ANSWER IS '答案';
COMMENT ON COLUMN BC_IVG_ANSWER.QID IS '问题项ID';
COMMENT ON COLUMN BC_IVG_ANSWER.RID IS '作答记录ID';
COMMENT ON COLUMN BC_IVG_ANSWER.SCORE IS '给分';
COMMENT ON COLUMN BC_IVG_ANSWER.CONTENT IS '问答题填写的内容';
COMMENT ON COLUMN BC_IVG_ANSWER.GRADE IS '是否需要评分';
ALTER TABLE BC_IVG_ANSWER ADD CONSTRAINT BCFK_IVG_ANSWER_QID FOREIGN KEY (QID)
      REFERENCES BC_IVG_QUESTION_ITEM (ID);
ALTER TABLE BC_IVG_ANSWER ADD CONSTRAINT BCFK_IVG_ANSWER_RID FOREIGN KEY (RID)
      REFERENCES BC_IVG_RESPOND (ID);

-- 对答案的评分记录
CREATE TABLE BC_IVG_GRADE (
	ID INT NOT NULL,
	ANSWER_ID INT NOT NULL,
	SCORE INT DEFAULT 0 NOT NULL,
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INT NOT NULL,
	DESC_ VARCHAR(1000),
	PRIMARY KEY (ID)
);
COMMENT ON TABLE BC_IVG_GRADE IS '评分记录';
COMMENT ON COLUMN BC_IVG_GRADE.ID IS 'ID';
COMMENT ON COLUMN BC_IVG_GRADE.ANSWER_ID IS '答案ID';
COMMENT ON COLUMN BC_IVG_GRADE.SCORE IS '给分';
COMMENT ON COLUMN BC_IVG_GRADE.FILE_DATE IS '评分时间';
COMMENT ON COLUMN BC_IVG_GRADE.AUTHOR_ID IS '评分人ID';
COMMENT ON COLUMN BC_IVG_GRADE.DESC_ IS '备注';
ALTER TABLE BC_IVG_GRADE ADD CONSTRAINT BCFK_IVG_GRADE_AID FOREIGN KEY (ANSWER_ID)
      REFERENCES BC_IVG_ANSWER (ID);
ALTER TABLE BC_IVG_GRADE ADD CONSTRAINT BCFK_IVG_GRADE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
-- ##bc平台的 postgresql 自定义函数和存储过程##

-- 模拟oracle dual功能的在hibernate hql中使用的视图
CREATE OR REPLACE VIEW bc_dual AS SELECT NULL::unknown;

-- 创建更新actor的pcode和pname的存储过程：会递归处理下级单位和部门
--	pid: actor所隶属上级的id，为0代表顶层单位
CREATE OR REPLACE FUNCTION update_actor_pcodepname(pid IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	pfcode varchar(4000);
	pfname varchar(4000);
	t integer := 0;
	child RECORD;
BEGIN
  	if pid > 0 then
		select (case when pcode is null then '' else pcode || '/' end) || '[' || type_ || ']' || code
        	,(case when pname is null then '' else pname || '/' end) || name
        	into pfcode,pfname from bc_identity_actor where id=pid;

		FOR child IN select a.id id,a.type_ type_ from bc_identity_actor a inner join bc_identity_actor_relation r on r.follower_id = a.id 
		where r.type_=0 and r.master_id=pid order by a.order_ LOOP
			update bc_identity_actor a set pcode=pfcode,pname=pfname where a.id=child.id;
			if child.type_ < 3 then 
				-- 单位或部门执行递归处理
				t := t + update_actor_pcodepname(child.id);
			end if;
		END LOOP;
	else
		FOR child IN select a.id id from bc_identity_actor a where a.type_=1 and not exists 
		(select r.follower_id from bc_identity_actor_relation r where r.type_=0 and a.id=r.follower_id)
	    order by a.order_ LOOP
			t := t + update_actor_pcodepname(child.id);
		END LOOP;
  	end if; 
	return t;
END;
$$ LANGUAGE plpgsql;


-- 创建更新resource的pname的存储过程：会递归处理下级资源
--	pid:resource所隶属的id，为0代表顶层资源
CREATE OR REPLACE FUNCTION update_resource_pname(pid IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	pfname varchar(4000);
	t integer := 0;
	child RECORD;
BEGIN
  	if pid > 0 then
		select (case when pname is null then '' else pname || '/' end) || name
        	into pfname from bc_identity_resource where id=pid;

		FOR child IN select r.id id,r.type_ type_ from bc_identity_resource r where r.belong = pid order by r.order_ LOOP
			update bc_identity_resource set pname=pfname where id=child.id;
			if child.type_ = 1 then 
				-- 分类型资源执行递归处理
				t := t + update_resource_pname(child.id);
			end if;
		END LOOP;
	else
		FOR child IN select r.id id from bc_identity_resource r where COALESCE(r.belong,0) = 0 order by r.order_ LOOP
			t := t + update_resource_pname(child.id);
		END LOOP;
  	end if; 
	return t;
END;
$$ LANGUAGE plpgsql;
	  
-- 报表模板使用人列函数
CREATE OR REPLACE FUNCTION getreporttemplateuser(rtid INTEGER)
	RETURNS CHARACTER VARYING  AS
$BODY$
DECLARE
		-- 使用者字符串
		users CHARACTER VARYING;
		-- 记录使用者字符串长度
		_length INTEGER;
		-- 一行结果的记录	
		rowinfo RECORD;
BEGIN
		-- 初始化变量
		users:='';
		_length:=0;
		FOR rowinfo IN SELECT b.name
						FROM bc_report_template a
						INNER JOIN bc_report_template_actor r on r.tid=a.id
						INNER JOIN bc_identity_actor b on r.aid=b.id
						WHERE a.id=rtid
		-- 循环开始
		LOOP
			users:=users||rowinfo.name||',';
		END LOOP;
		_length:=length(users);
		IF _length>0 THEN
		users:=substring(users from 1 for _length-1);
		END IF;
		RETURN users;
END;
$BODY$
LANGUAGE plpgsql;

create table ACT_ID_GROUP (
    ID_ varchar(64),
    REV_ integer,
    NAME_ varchar(255),
    TYPE_ varchar(255),
    primary key (ID_)
);
COMMENT ON TABLE ACT_ID_GROUP IS '用户组';
COMMENT ON COLUMN ACT_ID_GROUP.ID_ IS '标识';
COMMENT ON COLUMN ACT_ID_GROUP.REV_ IS '版本';
COMMENT ON COLUMN ACT_ID_GROUP.NAME_ IS '名称';
COMMENT ON COLUMN ACT_ID_GROUP.TYPE_ IS '类型';

create table ACT_ID_MEMBERSHIP (
    USER_ID_ varchar(64),
    GROUP_ID_ varchar(64),
    primary key (USER_ID_, GROUP_ID_)
);
COMMENT ON TABLE ACT_ID_MEMBERSHIP IS '用户和用户组关联关系';
COMMENT ON COLUMN ACT_ID_MEMBERSHIP.USER_ID_ IS '用户ID';
COMMENT ON COLUMN ACT_ID_MEMBERSHIP.GROUP_ID_ IS '用户组ID';

create table ACT_ID_USER (
    ID_ varchar(64),
    REV_ integer,
    FIRST_ varchar(255),
    LAST_ varchar(255),
    EMAIL_ varchar(255),
    PWD_ varchar(255),
    PICTURE_ID_ varchar(64),
    primary key (ID_)
);
COMMENT ON TABLE ACT_ID_USER IS '用户';
COMMENT ON COLUMN ACT_ID_USER.ID_ IS '用户ID,也是登录帐号名';
COMMENT ON COLUMN ACT_ID_USER.REV_ IS '版本号';
COMMENT ON COLUMN ACT_ID_USER.FIRST_ IS '名称';
COMMENT ON COLUMN ACT_ID_USER.LAST_ IS '姓氏';
COMMENT ON COLUMN ACT_ID_USER.EMAIL_ IS '邮箱';
COMMENT ON COLUMN ACT_ID_USER.PWD_ IS '登录密码';
COMMENT ON COLUMN ACT_ID_USER.PICTURE_ID_ IS '';

create table ACT_ID_INFO (
    ID_ varchar(64),
    REV_ integer,
    USER_ID_ varchar(64),
    TYPE_ varchar(64),
    KEY_ varchar(255),
    VALUE_ varchar(255),
    PASSWORD_ bytea,
    PARENT_ID_ varchar(255),
    primary key (ID_)
);

create index ACT_IDX_MEMB_GROUP on ACT_ID_MEMBERSHIP(GROUP_ID_);
alter table ACT_ID_MEMBERSHIP 
    add constraint ACT_FK_MEMB_GROUP
    foreign key (GROUP_ID_) 
    references ACT_ID_GROUP (ID_);

create index ACT_IDX_MEMB_USER on ACT_ID_MEMBERSHIP(USER_ID_);
alter table ACT_ID_MEMBERSHIP 
    add constraint ACT_FK_MEMB_USER
    foreign key (USER_ID_) 
    references ACT_ID_USER (ID_);

-- http://homeland520.blog.163.com/blog/static/81958868201112564938465/
create table ACT_GE_PROPERTY (
    NAME_ varchar(64),
    VALUE_ varchar(300),
    REV_ integer,
    primary key (NAME_)
);
COMMENT ON TABLE ACT_GE_PROPERTY IS '属性数据表,存储整个流程引擎级别的数据';
COMMENT ON COLUMN ACT_GE_PROPERTY.NAME_ IS '属性名称,如activiti的数据脚本名schema.version';
COMMENT ON COLUMN ACT_GE_PROPERTY.VALUE_ IS '属性值,如activiti的版本号5.9';
COMMENT ON COLUMN ACT_GE_PROPERTY.REV_ IS '修订号';

insert into ACT_GE_PROPERTY
values ('schema.version', '5.9', 1);

insert into ACT_GE_PROPERTY
values ('schema.history', 'create(5.9)', 1);

insert into ACT_GE_PROPERTY
values ('next.dbid', '1000', 1);

create table ACT_GE_BYTEARRAY (
    ID_ varchar(64),
    REV_ integer,
    NAME_ varchar(255),
    DEPLOYMENT_ID_ varchar(64),
    BYTES_ bytea,
    GENERATED_ boolean,
    primary key (ID_)
);
COMMENT ON TABLE ACT_GE_BYTEARRAY IS '用来保存部署文件的大文本数据';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.ID_ IS '资源文件编号,自增长';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.REV_ IS '版本号';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.NAME_ IS '资源文件名称';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.DEPLOYMENT_ID_ IS '来自于父表ACT_RE_DEPLOYMENT中的主键';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.BYTES_ IS '存储文本字节流';
COMMENT ON COLUMN ACT_GE_BYTEARRAY.GENERATED_ IS '';

create table ACT_RE_DEPLOYMENT (
    ID_ varchar(64),
    NAME_ varchar(255),
    DEPLOY_TIME_ timestamp,
    primary key (ID_)
);
COMMENT ON TABLE ACT_RE_DEPLOYMENT IS '用来存储部署时需要被持久化保存下来的信息';
COMMENT ON COLUMN ACT_RE_DEPLOYMENT.ID_ IS '部署编号,自增长';
COMMENT ON COLUMN ACT_RE_DEPLOYMENT.NAME_ IS '部署的包名称';
COMMENT ON COLUMN ACT_RE_DEPLOYMENT.DEPLOY_TIME_ IS '部署时间';

create table ACT_RU_EXECUTION (
    ID_ varchar(64),
    REV_ integer,
    PROC_INST_ID_ varchar(64),
    BUSINESS_KEY_ varchar(255),
    PARENT_ID_ varchar(64),
    PROC_DEF_ID_ varchar(64),
    SUPER_EXEC_ varchar(64),
    ACT_ID_ varchar(255),
    IS_ACTIVE_ boolean,
    IS_CONCURRENT_ boolean,
    IS_SCOPE_ boolean,
    IS_EVENT_SCOPE_ boolean,
    SUSPENSION_STATE_ integer,
    primary key (ID_),
    unique (PROC_DEF_ID_, BUSINESS_KEY_)
);
COMMENT ON TABLE ACT_RU_EXECUTION IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.ID_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.REV_ IS '版本号';
COMMENT ON COLUMN ACT_RU_EXECUTION.PROC_INST_ID_ IS '流程实例编号';
COMMENT ON COLUMN ACT_RU_EXECUTION.BUSINESS_KEY_ IS '业务编号';
COMMENT ON COLUMN ACT_RU_EXECUTION.PARENT_ID_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.PROC_DEF_ID_ IS '流程ID';
COMMENT ON COLUMN ACT_RU_EXECUTION.SUPER_EXEC_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.ACT_ID_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.IS_ACTIVE_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.IS_CONCURRENT_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.IS_SCOPE_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.IS_EVENT_SCOPE_ IS '';
COMMENT ON COLUMN ACT_RU_EXECUTION.SUSPENSION_STATE_ IS '';

create table ACT_RU_JOB (
    ID_ varchar(64) NOT NULL,
	  REV_ integer,
    TYPE_ varchar(255) NOT NULL,
    LOCK_EXP_TIME_ timestamp,
    LOCK_OWNER_ varchar(255),
    EXCLUSIVE_ boolean,
    EXECUTION_ID_ varchar(64),
    PROCESS_INSTANCE_ID_ varchar(64),
    RETRIES_ integer,
    EXCEPTION_STACK_ID_ varchar(64),
    EXCEPTION_MSG_ varchar(4000),
    DUEDATE_ timestamp,
    REPEAT_ varchar(255),
    HANDLER_TYPE_ varchar(255),
    HANDLER_CFG_ varchar(4000),
    primary key (ID_)
);
COMMENT ON TABLE ACT_RU_JOB IS '运行时定时任务数据表';

-- 注意：此表与ACT_RE_DEPLOYMENT是多对一的关系，即一个部署的bar包里可能包含多个流程定义文件，
-- 每个流程定义文件都会有一条记录在ACT_RE_PROCDEF表内，每条流程定义的数据，都会对应ACT_GE_BYTEARRAY表
-- 内的一个资源文件和PNG图片文件。
-- 与ACT_GE_BYTEARRAY的关联是通过程序用ACT_GE_BYTEARRAY.NAME_与ACT_RE_PROCDEF.RESOURCE_NAME_完成的，
-- 在数据库表结构内没有体现。
create table ACT_RE_PROCDEF (
    ID_ varchar(64),
    REV_ integer,
    CATEGORY_ varchar(255),
    NAME_ varchar(255),
    KEY_ varchar(255),
    VERSION_ integer,
    DEPLOYMENT_ID_ varchar(64),
    RESOURCE_NAME_ varchar(4000),
    DGRM_RESOURCE_NAME_ varchar(4000),
    HAS_START_FORM_KEY_ boolean,
    SUSPENSION_STATE_ integer,
    primary key (ID_)
);
COMMENT ON TABLE ACT_RE_PROCDEF IS '业务流程定义数据表';
COMMENT ON COLUMN ACT_RE_PROCDEF.ID_ IS '流程ID,由“流程编号:流程版本号:自增长ID”组成';
COMMENT ON COLUMN ACT_RE_PROCDEF.REV_ IS '';
COMMENT ON COLUMN ACT_RE_PROCDEF.CATEGORY_ IS '流程命令空间(该编号是流程文件targetNamespace的属性值)';
COMMENT ON COLUMN ACT_RE_PROCDEF.NAME_ IS '流程名称(该编号就是流程文件process元素的name属性值)';
COMMENT ON COLUMN ACT_RE_PROCDEF.KEY_ IS '流程编号(该编号就是流程文件process元素的id属性值)';
COMMENT ON COLUMN ACT_RE_PROCDEF.VERSION_ IS '流程版本号(由程序控制,新增即为1,修改后依次加1)';
COMMENT ON COLUMN ACT_RE_PROCDEF.DEPLOYMENT_ID_ IS '部署编号';
COMMENT ON COLUMN ACT_RE_PROCDEF.RESOURCE_NAME_ IS '资源文件名称';
COMMENT ON COLUMN ACT_RE_PROCDEF.DGRM_RESOURCE_NAME_ IS '图片资源文件名称';
COMMENT ON COLUMN ACT_RE_PROCDEF.HAS_START_FORM_KEY_ IS '是否有Start Form Key';
COMMENT ON COLUMN ACT_RE_PROCDEF.SUSPENSION_STATE_ IS '';

create table ACT_RU_TASK (
    ID_ varchar(64),
    REV_ integer,
    EXECUTION_ID_ varchar(64),
    PROC_INST_ID_ varchar(64),
    PROC_DEF_ID_ varchar(64),
    NAME_ varchar(255),
    PARENT_TASK_ID_ varchar(64),
    DESCRIPTION_ varchar(4000),
    TASK_DEF_KEY_ varchar(255),
    OWNER_ varchar(64),
    ASSIGNEE_ varchar(64),
    DELEGATION_ varchar(64),
    PRIORITY_ integer,
    CREATE_TIME_ timestamp,
    DUE_DATE_ timestamp,
    primary key (ID_)
);
COMMENT ON TABLE ACT_RU_TASK IS '运行时任务数据表';

create table ACT_RU_IDENTITYLINK (
    ID_ varchar(64),
    REV_ integer,
    GROUP_ID_ varchar(64),
    TYPE_ varchar(255),
    USER_ID_ varchar(64),
    TASK_ID_ varchar(64),
    primary key (ID_)
);
COMMENT ON TABLE ACT_RU_IDENTITYLINK IS '任务参与者数据表,存储当前节点参与者的信息';

create table ACT_RU_VARIABLE (
    ID_ varchar(64) not null,
    REV_ integer,
    TYPE_ varchar(255) not null,
    NAME_ varchar(255) not null,
    EXECUTION_ID_ varchar(64),
	  PROC_INST_ID_ varchar(64),
    TASK_ID_ varchar(64),
    BYTEARRAY_ID_ varchar(64),
    DOUBLE_ double precision,
    LONG_ bigint,
    TEXT_ varchar(4000),
    TEXT2_ varchar(4000),
    primary key (ID_)
);
COMMENT ON TABLE ACT_RU_VARIABLE IS '运行时流程变量数据表';

create table ACT_RU_EVENT_SUBSCR (
    ID_ varchar(64) not null,
    REV_ integer,
    EVENT_TYPE_ varchar(255) not null,
    EVENT_NAME_ varchar(255),
    EXECUTION_ID_ varchar(64),
    PROC_INST_ID_ varchar(64),
    ACTIVITY_ID_ varchar(64),
    CONFIGURATION_ varchar(255),
    CREATED_ timestamp not null,
    primary key (ID_)
);

create index ACT_IDX_EXEC_BUSKEY on ACT_RU_EXECUTION(BUSINESS_KEY_);
create index ACT_IDX_TASK_CREATE on ACT_RU_TASK(CREATE_TIME_);
create index ACT_IDX_IDENT_LNK_USER on ACT_RU_IDENTITYLINK(USER_ID_);
create index ACT_IDX_IDENT_LNK_GROUP on ACT_RU_IDENTITYLINK(GROUP_ID_);
create index ACT_IDX_EVENT_SUBSCR_CONFIG_ on ACT_RU_EVENT_SUBSCR(CONFIGURATION_);

create index ACT_IDX_BYTEAR_DEPL on ACT_GE_BYTEARRAY(DEPLOYMENT_ID_);
alter table ACT_GE_BYTEARRAY
    add constraint ACT_FK_BYTEARR_DEPL
    foreign key (DEPLOYMENT_ID_) 
    references ACT_RE_DEPLOYMENT (ID_);

create index ACT_IDX_EXE_PROCINST on ACT_RU_EXECUTION(PROC_INST_ID_);
alter table ACT_RU_EXECUTION
    add constraint ACT_FK_EXE_PROCINST 
    foreign key (PROC_INST_ID_) 
    references ACT_RU_EXECUTION (ID_);

create index ACT_IDX_EXE_PARENT on ACT_RU_EXECUTION(PARENT_ID_);
alter table ACT_RU_EXECUTION
    add constraint ACT_FK_EXE_PARENT
    foreign key (PARENT_ID_) 
    references ACT_RU_EXECUTION (ID_);
    
create index ACT_IDX_EXE_SUPER on ACT_RU_EXECUTION(SUPER_EXEC_);
alter table ACT_RU_EXECUTION
    add constraint ACT_FK_EXE_SUPER
    foreign key (SUPER_EXEC_) 
    references ACT_RU_EXECUTION (ID_);

create index ACT_IDX_TSKASS_TASK on ACT_RU_IDENTITYLINK(TASK_ID_);
alter table ACT_RU_IDENTITYLINK
    add constraint ACT_FK_TSKASS_TASK
    foreign key (TASK_ID_) 
    references ACT_RU_TASK (ID_);
    
create index ACT_IDX_TASK_EXEC on ACT_RU_TASK(EXECUTION_ID_);
alter table ACT_RU_TASK
    add constraint ACT_FK_TASK_EXE
    foreign key (EXECUTION_ID_)
    references ACT_RU_EXECUTION (ID_);
    
create index ACT_IDX_TASK_PROCINST on ACT_RU_TASK(PROC_INST_ID_);
alter table ACT_RU_TASK
    add constraint ACT_FK_TASK_PROCINST
    foreign key (PROC_INST_ID_)
    references ACT_RU_EXECUTION (ID_);
    
create index ACT_IDX_TASK_PROCDEF on ACT_RU_TASK(PROC_DEF_ID_);
alter table ACT_RU_TASK
  add constraint ACT_FK_TASK_PROCDEF
  foreign key (PROC_DEF_ID_)
  references ACT_RE_PROCDEF (ID_);
  
create index ACT_IDX_VAR_EXE on ACT_RU_VARIABLE(EXECUTION_ID_);
alter table ACT_RU_VARIABLE 
    add constraint ACT_FK_VAR_EXE
    foreign key (EXECUTION_ID_) 
    references ACT_RU_EXECUTION (ID_);

create index ACT_IDX_VAR_PROCINST on ACT_RU_VARIABLE(PROC_INST_ID_);
alter table ACT_RU_VARIABLE
    add constraint ACT_FK_VAR_PROCINST
    foreign key (PROC_INST_ID_)
    references ACT_RU_EXECUTION(ID_);

create index ACT_IDX_VAR_BYTEARRAY on ACT_RU_VARIABLE(BYTEARRAY_ID_);
alter table ACT_RU_VARIABLE 
    add constraint ACT_FK_VAR_BYTEARRAY 
    foreign key (BYTEARRAY_ID_) 
    references ACT_GE_BYTEARRAY (ID_);

create index ACT_IDX_JOB_EXCEPTION on ACT_RU_JOB(EXCEPTION_STACK_ID_);
alter table ACT_RU_JOB 
    add constraint ACT_FK_JOB_EXCEPTION
    foreign key (EXCEPTION_STACK_ID_) 
    references ACT_GE_BYTEARRAY (ID_);

create index ACT_IDX_EVENT_SUBSCR on ACT_RU_EVENT_SUBSCR(EXECUTION_ID_);
alter table ACT_RU_EVENT_SUBSCR
    add constraint ACT_FK_EVENT_EXEC
    foreign key (EXECUTION_ID_)
    references ACT_RU_EXECUTION(ID_);
	
-- ADD BY DRAGON
create index ACT_FK_VAR_TASK on ACT_RU_VARIABLE(TASK_ID_);
create index ACT_FK_PROCDEF_DEPLOYMENT on ACT_RE_PROCDEF(DEPLOYMENT_ID_);
create index ACT_FK_TASK_PARENT on ACT_RU_TASK(PARENT_TASK_ID_);

create table ACT_HI_PROCINST (
    ID_ varchar(64) not null,
    PROC_INST_ID_ varchar(64) not null,
    BUSINESS_KEY_ varchar(255),
    PROC_DEF_ID_ varchar(64) not null,
    START_TIME_ timestamp not null,
    END_TIME_ timestamp,
    DURATION_ bigint,
    START_USER_ID_ varchar(255),
    START_ACT_ID_ varchar(255),
    END_ACT_ID_ varchar(255),
    SUPER_PROCESS_INSTANCE_ID_ varchar(64),
    DELETE_REASON_ varchar(4000),
    primary key (ID_),
    unique (PROC_INST_ID_),
    unique (PROC_DEF_ID_, BUSINESS_KEY_)
);

create table ACT_HI_ACTINST (
    ID_ varchar(64) not null,
    PROC_DEF_ID_ varchar(64) not null,
    PROC_INST_ID_ varchar(64) not null,
    EXECUTION_ID_ varchar(64) not null,
    ACT_ID_ varchar(255) not null,
    ACT_NAME_ varchar(255),
    ACT_TYPE_ varchar(255) not null,
    ASSIGNEE_ varchar(64),
    START_TIME_ timestamp not null,
    END_TIME_ timestamp,
    DURATION_ bigint,
    primary key (ID_)
);

create table ACT_HI_TASKINST (
    ID_ varchar(64) not null,
    PROC_DEF_ID_ varchar(64),
    TASK_DEF_KEY_ varchar(255),
    PROC_INST_ID_ varchar(64),
    EXECUTION_ID_ varchar(64),
    NAME_ varchar(255),
    PARENT_TASK_ID_ varchar(64),
    DESCRIPTION_ varchar(4000),
    OWNER_ varchar(64),
    ASSIGNEE_ varchar(64),
    START_TIME_ timestamp not null,
    END_TIME_ timestamp,
    DURATION_ bigint,
    DELETE_REASON_ varchar(4000),
    PRIORITY_ integer,
    DUE_DATE_ timestamp,
    primary key (ID_)
);

create table ACT_HI_DETAIL (
    ID_ varchar(64) not null,
    TYPE_ varchar(255) not null,
    PROC_INST_ID_ varchar(64) not null,
    EXECUTION_ID_ varchar(64) not null,
    TASK_ID_ varchar(64),
    ACT_INST_ID_ varchar(64),
    NAME_ varchar(255) not null,
    VAR_TYPE_ varchar(64),
    REV_ integer,
    TIME_ timestamp not null,
    BYTEARRAY_ID_ varchar(64),
    DOUBLE_ double precision,
    LONG_ bigint,
    TEXT_ varchar(4000),
    TEXT2_ varchar(4000),
    primary key (ID_)
);

create table ACT_HI_COMMENT (
    ID_ varchar(64) not null,
    TYPE_ varchar(255),
    TIME_ timestamp not null,
    USER_ID_ varchar(255),
    TASK_ID_ varchar(64),
    PROC_INST_ID_ varchar(64),
    ACTION_ varchar(255),
    MESSAGE_ varchar(4000),
    FULL_MSG_ bytea,
    primary key (ID_)
);

create table ACT_HI_ATTACHMENT (
    ID_ varchar(64) not null,
    REV_ integer,
    USER_ID_ varchar(255),
    NAME_ varchar(255),
    DESCRIPTION_ varchar(4000),
    TYPE_ varchar(255),
    TASK_ID_ varchar(64),
    PROC_INST_ID_ varchar(64),
    URL_ varchar(4000),
    CONTENT_ID_ varchar(64),
    primary key (ID_)
);


create index ACT_IDX_HI_PRO_INST_END on ACT_HI_PROCINST(END_TIME_);
create index ACT_IDX_HI_PRO_I_BUSKEY on ACT_HI_PROCINST(BUSINESS_KEY_);
create index ACT_IDX_HI_ACT_INST_START on ACT_HI_ACTINST(START_TIME_);
create index ACT_IDX_HI_ACT_INST_END on ACT_HI_ACTINST(END_TIME_);
create index ACT_IDX_HI_DETAIL_PROC_INST on ACT_HI_DETAIL(PROC_INST_ID_);
create index ACT_IDX_HI_DETAIL_ACT_INST on ACT_HI_DETAIL(ACT_INST_ID_);
create index ACT_IDX_HI_DETAIL_TIME on ACT_HI_DETAIL(TIME_);
create index ACT_IDX_HI_DETAIL_NAME on ACT_HI_DETAIL(NAME_);
-- ##BC平台workflow的 postgresql 建表脚本##

-- bc营运管理子系统的建表脚本,所有表名须附带前缀"BS_"
-- 运行此脚本之前需先运行平台的建表脚本framework.db.postgresql.create.sql

-- 创建数据转换用的序列，开始于100000
CREATE sequence DC_SEQUENCE
    minvalue 1
    start with 100000
    increment by 1
    cache 20;

-- 数据转换记录
CREATE TABLE DC_RECORD(
  TYPE_         VARCHAR(255) NOT NULL,
  FROM_ID       INTEGER NOT NULL,
  TO_ID         INTEGER NOT NULL,
  FROM_TABLE    VARCHAR(255),
  TO_TABLE      VARCHAR(255),
  CREATE_DATE   TIMESTAMP NOT NULL,
  REMARK        VARCHAR(4000),
  MODIFIED_DATE TIMESTAMP
);
COMMENT ON TABLE DC_RECORD IS '数据转换记录';
COMMENT ON COLUMN DC_RECORD.TYPE_ IS '类型';
COMMENT ON COLUMN DC_RECORD.FROM_ID IS '旧表数据ID';
COMMENT ON COLUMN DC_RECORD.TO_ID IS '新表数据的ID';
COMMENT ON COLUMN DC_RECORD.FROM_TABLE IS '旧数据表名';
COMMENT ON COLUMN DC_RECORD.TO_TABLE IS '新数据表名';
COMMENT ON COLUMN DC_RECORD.CREATE_DATE IS '创建时间';
COMMENT ON COLUMN DC_RECORD.REMARK IS '备注说明';
COMMENT ON COLUMN DC_RECORD.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE DC_RECORD ADD CONSTRAINT BSUK_RECORD UNIQUE (TYPE_, FROM_ID);

-- 车队信息
CREATE TABLE BS_MOTORCADE (
   ID                   INTEGER           NOT NULL,
   UID_                 VARCHAR(36),
   CODE                 VARCHAR(255)        NOT NULL,
   NAME                 VARCHAR(255)        NOT NULL,
   STATUS_              INTEGER            NOT NULL,
   UNIT_ID              INTEGER           NOT NULL,
   PRINCIPAL_ID         INTEGER,
   PRINCIPAL_NAME       VARCHAR(255),
   TYPE_                INTEGER            NOT NULL,
   PID                  INTEGER,
   DESC_                VARCHAR(4000),
   PAYMENT_DATE         VARCHAR(255),
   COLOR                VARCHAR(255), ADDRESS              VARCHAR(255),
   PHONE                VARCHAR(255),
   FAX                  VARCHAR(255),
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   CONSTRAINT BSPK_MOTORCADE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_MOTORCADE IS '车队';
COMMENT ON COLUMN BS_MOTORCADE.CODE IS '编码';
COMMENT ON COLUMN BS_MOTORCADE.NAME IS '名称';
COMMENT ON COLUMN BS_MOTORCADE.STATUS_ IS '状态：0-在案,1-已禁用,2-已删除';
COMMENT ON COLUMN BS_MOTORCADE.UNIT_ID IS '所属单位ID';
COMMENT ON COLUMN BS_MOTORCADE.PRINCIPAL_ID IS '负责人ID';
COMMENT ON COLUMN BS_MOTORCADE.PRINCIPAL_NAME IS '负责人姓名';
COMMENT ON COLUMN BS_MOTORCADE.TYPE_ IS '类别：0-分队,1-分组';
COMMENT ON COLUMN BS_MOTORCADE.PID IS '所属父类ID';
COMMENT ON COLUMN BS_MOTORCADE.DESC_ IS '备注';
COMMENT ON COLUMN BS_MOTORCADE.PAYMENT_DATE IS '缴费日';
COMMENT ON COLUMN BS_MOTORCADE.COLOR IS '颜色';
COMMENT ON COLUMN BS_MOTORCADE.ADDRESS IS '地址';
COMMENT ON COLUMN BS_MOTORCADE.PHONE IS '电话';
COMMENT ON COLUMN BS_MOTORCADE.FAX IS '传真';
COMMENT ON COLUMN BS_MOTORCADE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_MOTORCADE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_MOTORCADE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_MOTORCADE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_MOTORCADE ADD CONSTRAINT BSFK_MOTORCADE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_MOTORCADE ADD CONSTRAINT BSFK_MOTORCADE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_MOTORCADE ADD CONSTRAINT BSFK_MOTORCADE_PID FOREIGN KEY (PID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_MOTORCADE ADD CONSTRAINT BSFK_MOTORCADE_PRINCIPAL FOREIGN KEY (PRINCIPAL_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BS_MOTORCADE ADD CONSTRAINT BSFK_MOTORCADE_UNIT FOREIGN KEY (UNIT_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
CREATE INDEX BSIDX_MOTORCADE_STATUS ON BS_MOTORCADE (STATUS_);

-- 车队历史车辆数
CREATE TABLE BS_MOTORCADE_CARQUANTITY (
   ID                   INTEGER           NOT NULL,
   MOTORCADE_ID         INTEGER           NOT NULL,
   YEAR_                NUMERIC(4)            NOT NULL,
   MONTH_               NUMERIC(2)            NOT NULL,
   QUANTITY             INTEGER           NOT NULL,
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   CONSTRAINT BSPK_CARQUANTITY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_MOTORCADE_CARQUANTITY IS '车队历史车辆数';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.MOTORCADE_ID IS '所属车队ID';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.YEAR_ IS '年份';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.MONTH_ IS '月份';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.QUANTITY IS '车辆数';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_MOTORCADE_CARQUANTITY.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_MOTORCADE_CARQUANTITY ADD CONSTRAINT BSFK_CARQUANTITY_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_MOTORCADE_CARQUANTITY ADD CONSTRAINT BSFK_CARQUANTITY_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_MOTORCADE_CARQUANTITY ADD CONSTRAINT BSFK_CARQUANTITY_MOTORCADE FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);


-- 证件
create table BS_CERT (
    ID INTEGER NOT NULL,
    STATUS_ INTEGER NOT NULL,
    UID_ VARCHAR(36) NOT NULL,
    TYPE_ INTEGER NOT NULL,
    CERT_CODE VARCHAR(255) NOT NULL,
    CERT_NAME VARCHAR(255) NOT NULL,
    CERT_FULL_NAME VARCHAR(255),
    LICENCER VARCHAR(255),
    ISSUE_DATE TIMESTAMP,
    START_DATE TIMESTAMP,
    END_DATE TIMESTAMP,
    EXT_STR1 VARCHAR(255),
    EXT_STR2 VARCHAR(255),
    EXT_STR3 VARCHAR(255),
    EXT_NUM1 INTEGER,
    EXT_NUM2 INTEGER,
    EXT_NUM3 INTEGER,
    FILE_DATE TIMESTAMP NOT NULL,
    AUTHOR_ID INTEGER NOT NULL,
    MODIFIER_ID INTEGER ,
    MODIFIED_DATE TIMESTAMP,
    CONSTRAINT BSPK_CERT primary key (ID)
);
COMMENT ON TABLE BS_CERT IS '证件';
COMMENT ON COLUMN BS_CERT.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BS_CERT.CERT_CODE IS '证件号';
COMMENT ON COLUMN BS_CERT.TYPE_ IS '证件类型：居民身份证、机动车驾驶证、从业资格证、服务资格证、驾驶培训证、机动车行驶证、道路运输证';
COMMENT ON COLUMN BS_CERT.CERT_NAME IS '证件简称';
COMMENT ON COLUMN BS_CERT.CERT_FULL_NAME IS '证件全称';
COMMENT ON COLUMN BS_CERT.LICENCER IS '发证机关';
COMMENT ON COLUMN BS_CERT.START_DATE IS '生效日期';
COMMENT ON COLUMN BS_CERT.ISSUE_DATE IS '发证日期';
COMMENT ON COLUMN BS_CERT.END_DATE IS '到期日期';
COMMENT ON COLUMN BS_CERT.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CERT.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CERT.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CERT.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_CERT ADD CONSTRAINT BSFK_CERT_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CERT ADD CONSTRAINT BSFK_CERT_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CERT_CODE ON BS_CERT (CERT_CODE ASC);
CREATE INDEX BSIDX_CERT_NAME ON BS_CERT (CERT_NAME ASC);

-- 证件:居民身份证
create table BS_CERT_IDENTITY (
    ID INTEGER NOT NULL,
    NAME VARCHAR(255),
    SEX NUMERIC(1),
    BIRTHDATE TIMESTAMP,
    NATION VARCHAR(255),
    ADDRESS VARCHAR(500),
    CONSTRAINT BSPK_CERT_IDENTITY primary key (ID)
);
COMMENT ON TABLE BS_CERT_IDENTITY IS '证件:居民身份证';
COMMENT ON COLUMN BS_CERT_IDENTITY.NAME IS '姓名';
COMMENT ON COLUMN BS_CERT_IDENTITY.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CERT_IDENTITY.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CERT_IDENTITY.NATION IS '民族';
COMMENT ON COLUMN BS_CERT_IDENTITY.ADDRESS IS '住址';
ALTER TABLE BS_CERT_IDENTITY ADD CONSTRAINT BSFK_CERT4IDENTITY_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);

-- 证件:机动车驾驶证
create table BS_CERT_DRIVING (
    ID INTEGER NOT NULL,
    NAME VARCHAR(255),
    SEX NUMERIC(1),
    BIRTHDATE TIMESTAMP,
    NATION VARCHAR(255),
    ADDRESS VARCHAR(500),
    MODEL VARCHAR(255),
    RECEIVEDATE TIMESTAMP,
    VALIDFOR VARCHAR(255),
    ARCHIVENO VARCHAR(255),
    RECORD VARCHAR(255),
    CONSTRAINT BSPK_CERT_DRIVING primary key (ID)
);
COMMENT ON TABLE BS_CERT_DRIVING IS '证件:机动车驾驶证';
COMMENT ON COLUMN BS_CERT_DRIVING.NAME IS '姓名';
COMMENT ON COLUMN BS_CERT_DRIVING.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CERT_DRIVING.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CERT_DRIVING.NATION IS '国籍';
COMMENT ON COLUMN BS_CERT_DRIVING.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_DRIVING.MODEL IS '准驾车型';
COMMENT ON COLUMN BS_CERT_DRIVING.RECEIVEDATE IS '初次领证日期';
COMMENT ON COLUMN BS_CERT_DRIVING.VALIDFOR IS '有效期限';
COMMENT ON COLUMN BS_CERT_DRIVING.ARCHIVENO IS '档案编号';
COMMENT ON COLUMN BS_CERT_DRIVING.RECORD IS '记录';
ALTER TABLE BS_CERT_DRIVING ADD CONSTRAINT BSFK_CERT4DRIVING_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);

-- 证件:从业资格证
create table BS_CERT_CYZG (
    ID INTEGER NOT NULL,
    NAME VARCHAR(255),
    SEX NUMERIC(1),
    BIRTHDATE TIMESTAMP,
    NATION VARCHAR(255),
    ADDRESS VARCHAR(500),
    SCOPE_ VARCHAR(255),
    IDENTITY_NO VARCHAR(255),
    SERVICE_UNIT VARCHAR(500),
    CONSTRAINT BSPK_CERT_CYZG primary key (ID)
);
COMMENT ON TABLE BS_CERT_CYZG IS '证件:从业资格证';
COMMENT ON COLUMN BS_CERT_CYZG.NAME IS '姓名';
COMMENT ON COLUMN BS_CERT_CYZG.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CERT_CYZG.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CERT_CYZG.NATION IS '国籍';
COMMENT ON COLUMN BS_CERT_CYZG.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_CYZG.SCOPE_ IS '从业资格';
COMMENT ON COLUMN BS_CERT_CYZG.IDENTITY_NO IS '身份证件号';
COMMENT ON COLUMN BS_CERT_CYZG.SERVICE_UNIT IS '服务单位';
ALTER TABLE BS_CERT_CYZG ADD CONSTRAINT BSFK_CERT4CYZG_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);

-- 证件:服务资格证
create table BS_CERT_FWZG (
    ID INTEGER NOT NULL,
    NAME VARCHAR(255),
    SEX NUMERIC(1),
    BIRTHDATE TIMESTAMP,
    NATION VARCHAR(255),
    ADDRESS VARCHAR(500),
    LEVEL_ VARCHAR(255),
    SERVICE_UNIT VARCHAR(500),
    CONSTRAINT BSPK_CERT_FWZG primary key (ID)
);
COMMENT ON TABLE BS_CERT_FWZG IS '证件:服务资格证';
COMMENT ON COLUMN BS_CERT_FWZG.NAME IS '姓名';
COMMENT ON COLUMN BS_CERT_FWZG.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CERT_FWZG.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CERT_FWZG.NATION IS '国籍';
COMMENT ON COLUMN BS_CERT_FWZG.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_FWZG.LEVEL_ IS '等级';
COMMENT ON COLUMN BS_CERT_FWZG.SERVICE_UNIT IS '服务单位';
ALTER TABLE BS_CERT_FWZG ADD CONSTRAINT BSFK_CERT4FWZG_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);

-- 证件:驾驶培训证
create table BS_CERT_JSPX (
    ID INTEGER NOT NULL,
    NAME VARCHAR(255),
    SEX NUMERIC(1),
    BIRTHDATE TIMESTAMP,
    NATION VARCHAR(255),
    ADDRESS VARCHAR(500),
    DOMAIN VARCHAR(255),
    TRAIN_DATE TIMESTAMP,
    TRAIN_HOUR NUMERIC(3),
    GRADE1 NUMERIC(3),
    GRADE2 VARCHAR(10),
    GRADE3 VARCHAR(10),
    IDENTITY_NO VARCHAR(255),
    CONSTRAINT BSPK_CERT_JSPX primary key (ID)
);
COMMENT ON TABLE BS_CERT_JSPX IS '证件:驾驶培训证';
COMMENT ON COLUMN BS_CERT_JSPX.NAME IS '姓名';
COMMENT ON COLUMN BS_CERT_JSPX.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CERT_JSPX.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CERT_JSPX.NATION IS '国籍';
COMMENT ON COLUMN BS_CERT_JSPX.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_JSPX.DOMAIN IS '培训专业';
COMMENT ON COLUMN BS_CERT_JSPX.TRAIN_DATE IS '培训时间';
COMMENT ON COLUMN BS_CERT_JSPX.TRAIN_HOUR IS '培训学时';
COMMENT ON COLUMN BS_CERT_JSPX.GRADE1 IS '理论知识考核成绩';
COMMENT ON COLUMN BS_CERT_JSPX.GRADE2 IS '操作技能考核成绩';
COMMENT ON COLUMN BS_CERT_JSPX.GRADE3 IS '评定成绩';
COMMENT ON COLUMN BS_CERT_JSPX.IDENTITY_NO IS '身份证件号';
ALTER TABLE BS_CERT_JSPX ADD CONSTRAINT BSFK_CERT4JSPX_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);

-- 证件:道路运输证
CREATE TABLE BS_CERT_ROADTRANSPORT(
	ID                   INTEGER NOT NULL,
	FACTORY              VARCHAR(255),
	PLATE                VARCHAR(255),
	OWNER                VARCHAR(255),
	ADDRESS              VARCHAR(255),
	BS_CERT_NO           VARCHAR(255),
	SEAT                 VARCHAR(255),
	DIM_LEN              INTEGER,
	DIM_WIDTH            INTEGER,
	DIM_HEIGHT           INTEGER,
	SCOPE_               VARCHAR(255),
	LEVEL_               VARCHAR(255),
	DESC_                VARCHAR(255),
  	CONSTRAINT BSPK_CERT_ROADTRANSPORT PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CERT_ROADTRANSPORT IS '证件：道路运输证';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.FACTORY IS '品牌型号，如“桑塔纳SVW7182QQD”';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.PLATE IS '车牌及号码，如“粤AC4X74”';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.OWNER IS '业户名称';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.BS_CERT_NO IS '经营许可证号';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.SEAT IS '吨（座）位';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.DIM_LEN IS '外廓尺寸：长，单位MM';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.DIM_WIDTH IS '外廓尺寸：宽，单位MM';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.DIM_HEIGHT IS '外廓尺寸：高，单位MM';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.SCOPE_ IS '经营范围';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.LEVEL_ IS '技术等级';
COMMENT ON COLUMN BS_CERT_ROADTRANSPORT.DESC_ IS '备注';
ALTER TABLE BS_CERT_ROADTRANSPORT ADD CONSTRAINT BSFK_CERT4ROADTRANSPORT_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);
  
-- 证件:机动车行驶证
CREATE TABLE BS_CERT_VEHICELICENSE(
	ID                   INTEGER NOT NULL,
	FACTORY              VARCHAR(255),
	PLATE                VARCHAR(255),
	OWNER                VARCHAR(255),
	ADDRESS              VARCHAR(255),
	USE_CHARACTER        VARCHAR(255),
	VEHICE_TYPE          VARCHAR(255),
	VIN                  VARCHAR(255),
	ENGINE_NO            VARCHAR(255),
	REGISTER_DATE        TIMESTAMP,
	ARCHIVE_NO           VARCHAR(255),
	DIM_LEN              INTEGER,
	DIM_WIDTH            INTEGER,
	DIM_HEIGHT           INTEGER,
	TOTAL_WEIGHT         INTEGER,
	CURB_WEIGHT          INTEGER,
	ACCESS_WEIGHT        INTEGER,
	PULL_WEIGHT          INTEGER,
	ACCESS_COUNT         INTEGER,
	SCRAP_DATE           TIMESTAMP,
	DESC_                VARCHAR(500),
	RECORD_              VARCHAR(500),
	CONSTRAINT BSPK_CERT_VEHICELICENSE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CERT_VEHICELICENSE IS '证件：机动车行驶证';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.FACTORY IS '品牌型号，如“桑塔纳SVW7182QQD”';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.PLATE IS '车牌及号码，如“粤AC4X74”';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.OWNER IS '业户名称';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.ADDRESS IS '地址';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.USE_CHARACTER IS '使用性质';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.VEHICE_TYPE IS '车辆类型';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.VIN IS '车辆识别代号';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.ENGINE_NO IS '发动机号码';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.REGISTER_DATE IS '注册日期';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.ARCHIVE_NO IS '档案编号';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.DIM_LEN IS '外廓尺寸：长，单位MM';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.DIM_WIDTH IS '外廓尺寸：宽，单位MM';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.DIM_HEIGHT IS '外廓尺寸：高，单位MM';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.TOTAL_WEIGHT IS '总质量，单位KG';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.CURB_WEIGHT IS '整备质量，单位KG';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.ACCESS_WEIGHT IS '核定载质量，单位KG';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.PULL_WEIGHT IS '准牵引总质量，单位KG';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.ACCESS_COUNT IS '核定载人数';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.SCRAP_DATE IS '强制报废日期';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.DESC_ IS '备注';
COMMENT ON COLUMN BS_CERT_VEHICELICENSE.RECORD_ IS '检验记录';
ALTER TABLE BS_CERT_VEHICELICENSE ADD CONSTRAINT BSFK_CERT4VEHICELICENSE_CERT FOREIGN KEY (ID) 
	REFERENCES BS_CERT (ID);


-- 司机责任人
create table BS_CARMAN (
    ID 						INTEGER NOT NULL,
    UID_ 					VARCHAR(36) NOT NULL,
    STATUS_ 				INTEGER NOT NULL,
    TYPE_ 					INTEGER default 0 NOT NULL,
    NAME 					VARCHAR(255) NOT NULL,
    ORDER_ 					VARCHAR(100),
    SEX 					INTEGER default 0 NOT NULL,
    WORK_DATE 				TIMESTAMP,
    ORIGIN 					VARCHAR(255),
    REGION_  				NUMERIC(1),
    HOUSE_TYPE 				VARCHAR(255),
    BIRTHDATE 				TIMESTAMP,
    FORMER_UNIT 			VARCHAR(500),
    ADDRESS 				VARCHAR(500),
    ADDRESS1 				VARCHAR(500),
    PHONE 					VARCHAR(500),
    PHONE1 					VARCHAR(500),
    MODEL_                	VARCHAR(255),
	LEVEL_ 					VARCHAR(255),
    CERT_IDENTITY        	VARCHAR(255),
    CERT_DRIVING         	VARCHAR(255),
    CERT_DRIVING_ARCHIVE 	VARCHAR(255),
    CERT_DRIVING_FIRST_DATE TIMESTAMP,
    CERT_DRIVING_START_DATE TIMESTAMP,
    CERT_DRIVING_END_DATE 	TIMESTAMP,
    CERT_FWZG            	VARCHAR(255),
	CERT_FWZG_ID            VARCHAR(255),
    CERT_CYZG            	VARCHAR(255),
    OLD_UNIT_NAME        	VARCHAR(255),
    GZ                   	boolean default false,
    ACCESS_CERTS         	VARCHAR(255),
    DESC_                	VARCHAR(4000),
    CHARGER					VARCHAR(4000),
    MAIN_CAR_ID 			INTEGER,
    CARINFO 				VARCHAR(4000),
    MOVE_TYPE 				INTEGER,
    MOVE_DATE 				TIMESTAMP,
    SHIFTWORK_END_DATE 		TIMESTAMP,
    CLASSES 				INTEGER,
    FILE_DATE 				TIMESTAMP NOT NULL,
    AUTHOR_ID 				INTEGER NOT NULL,
    MODIFIER_ID 			INTEGER,
    MODIFIED_DATE 			TIMESTAMP,
    CONSTRAINT BSPK_CARMAN primary key (ID)
);
COMMENT ON TABLE BS_CARMAN IS '司机责任人';
COMMENT ON COLUMN BS_CARMAN.UID_ IS 'UID';
COMMENT ON COLUMN BS_CARMAN.STATUS_ IS '状态：-1-草稿,0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BS_CARMAN.TYPE_ IS '类别:0-司机,1-责任人,2-司机和责任人';
COMMENT ON COLUMN BS_CARMAN.NAME IS '姓名';
COMMENT ON COLUMN BS_CARMAN.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_CARMAN.SEX IS '性别：0-未设置,1-男,2-女';
COMMENT ON COLUMN BS_CARMAN.WORK_DATE IS '入职日期';
COMMENT ON COLUMN BS_CARMAN.ORIGIN IS '籍贯';
COMMENT ON COLUMN BS_CARMAN.REGION_ IS '区域：0-未定义，1-本市，2-本省，3-外省';
COMMENT ON COLUMN BS_CARMAN.HOUSE_TYPE IS '户口类型';
COMMENT ON COLUMN BS_CARMAN.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CARMAN.FORMER_UNIT IS '入职原单位';
COMMENT ON COLUMN BS_CARMAN.ADDRESS IS '身份证住址';
COMMENT ON COLUMN BS_CARMAN.ADDRESS1 IS '暂住地址';
COMMENT ON COLUMN BS_CARMAN.PHONE IS '电话';
COMMENT ON COLUMN BS_CARMAN.PHONE1 IS '电话1';
COMMENT ON COLUMN BS_CARMAN.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CARMAN.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CARMAN.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CARMAN.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CARMAN.MODEL_ IS '准驾车型';
COMMENT ON COLUMN BS_CARMAN.LEVEL_ IS '司机等级';
COMMENT ON COLUMN BS_CARMAN.CERT_IDENTITY IS '身份证号';
COMMENT ON COLUMN BS_CARMAN.CERT_DRIVING IS '驾驶证号';
COMMENT ON COLUMN BS_CARMAN.CERT_DRIVING_ARCHIVE IS '驾驶证档案号';
COMMENT ON COLUMN BS_CARMAN.CERT_DRIVING_FIRST_DATE IS '初次领证日期';
COMMENT ON COLUMN BS_CARMAN.CERT_DRIVING_START_DATE IS '驾驶证起效日期';
COMMENT ON COLUMN BS_CARMAN.CERT_DRIVING_END_DATE IS '驾驶证过期日期';
COMMENT ON COLUMN BS_CARMAN.CERT_FWZG IS '服务资格证号';
COMMENT ON COLUMN BS_CARMAN.CERT_FWZG_ID IS '服务资格证号';
COMMENT ON COLUMN BS_CARMAN.CERT_CYZG IS '从业资格证号';
COMMENT ON COLUMN BS_CARMAN.OLD_UNIT_NAME IS '分支机构：用于历史数据的保存';
COMMENT ON COLUMN BS_CARMAN.GZ IS '驾驶证是否广州:0-否,1-是';
COMMENT ON COLUMN BS_CARMAN.ACCESS_CERTS IS '已考取证件：历史数据保存';
COMMENT ON COLUMN BS_CARMAN.DESC_ IS '备注';
COMMENT ON COLUMN BS_CARMAN.CHARGER IS '沉余字段：责任人信息';
COMMENT ON COLUMN BS_CARMAN.MAIN_CAR_ID IS '沉余字段：主车辆id';
COMMENT ON COLUMN BS_CARMAN.CARINFO IS '沉余字段：营运车辆';
COMMENT ON COLUMN BS_CARMAN.MOVE_TYPE IS '沉余字段：迁移类型:1-公司到公司(已注销);2-注销未有去向;3-由外公司迁回;4-交回未注销;5-新入职;6-转车队;7-顶班;8-交回后转车';
COMMENT ON COLUMN BS_CARMAN.MOVE_DATE IS '沉余字段：迁移日期(或顶班合同开始日期)';
COMMENT ON COLUMN BS_CARMAN.SHIFTWORK_END_DATE IS '沉余字段：顶班合同期结束日期';
COMMENT ON COLUMN BS_CARMAN.CLASSES IS '沉余字段：营运班次:如0-""、1-正班、2-副班、3-主挂、4-顶班';
ALTER TABLE BS_CARMAN ADD CONSTRAINT BSFK_CARMAN_AUTHOR FOREIGN KEY (AUTHOR_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CARMAN ADD CONSTRAINT BSFK_CARMAN_MODIFIER FOREIGN KEY (MODIFIER_ID) 
	REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CARMAN_STATUS_FWZG ON BS_CARMAN (STATUS_,CERT_FWZG);
CREATE INDEX BSIDX_CARMAN_STATUS_NAME ON BS_CARMAN (STATUS_,NAME);

-- 司机责任人与证件的关联
CREATE TABLE BS_CARMAN_CERT (
    MAN_ID INTEGER NOT NULL,
    CERT_ID INTEGER NOT NULL,
    CONSTRAINT BSPK_CARMAN_CERT PRIMARY KEY (MAN_ID,CERT_ID)
);
COMMENT ON TABLE BS_CARMAN_CERT IS '司机责任人与证件的关联';
COMMENT ON COLUMN BS_CARMAN_CERT.MAN_ID IS '司机责任人ID';
COMMENT ON COLUMN BS_CARMAN_CERT.CERT_ID IS '证件ID';
ALTER TABLE BS_CARMAN_CERT ADD CONSTRAINT BSFK_CARMANCERT_MAN FOREIGN KEY (MAN_ID) 
	REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_CARMAN_CERT ADD CONSTRAINT BSFK_CARMANCERT_CERT FOREIGN KEY (CERT_ID) 
	REFERENCES BS_CERT (ID);


-- 车辆 
CREATE TABLE BS_CAR (
   ID                   INTEGER           NOT NULL,
   UID_                 VARCHAR(36)       NOT NULL,
   STATUS_              INTEGER           NOT NULL,
   VER_MAJOR            NUMERIC(2),
   VER_MINOR            NUMERIC(3),
   COMPANY        		VARCHAR(255),
   MOTORCADE_ID         INTEGER,
   DRIVER				VARCHAR(4000),
   CHARGER				VARCHAR(4000),
   BS_TYPE              VARCHAR(255),
   CODE                 VARCHAR(255),
   ORIGIN_NO            VARCHAR(255),
   PLATE_TYPE           VARCHAR(255),
   PLATE_NO             VARCHAR(255),
   VIN                  VARCHAR(255),
   RENT_NO              VARCHAR(255),
   FACTORY_TYPE         VARCHAR(255),
   FACTORY_MODEL        VARCHAR(255),
   REGISTER_DATE        TIMESTAMP,
   OPERATE_DATE         TIMESTAMP,
   SCRAP_DATE           TIMESTAMP,
   FACTORY_DATE         TIMESTAMP,
   REGISTER_NO          VARCHAR(255),
   LEVEL_               VARCHAR(255),
   COLOR                VARCHAR(255),
   ENGINE_NO            VARCHAR(255),
   ENGINE_TYPE          VARCHAR(255),
   FUEL_TYPE            VARCHAR(255),
   DISPLACEMENT         INTEGER,
   POWER                NUMERIC(19,2),
   TURN_TYPE            VARCHAR(255),
   TIRE_COUNT           INTEGER,
   TIRE_STANDARD        VARCHAR(255),
   TIRE_FRONT_DISTANCE  VARCHAR(255),
   TIRE_BEHIND_DISTANCE VARCHAR(255),
   AXIS_DISTANCE        INTEGER,
   AXIS_COUNT           INTEGER,
   PIECE_COUNT          INTEGER,
   DIM_LEN              INTEGER,
   DIM_WIDTH            INTEGER,
   DIM_HEIGHT           INTEGER,
   TOTAL_WEIGHT         INTEGER,
   ACCESS_WEIGHT        INTEGER,
   ACCESS_COUNT         INTEGER,
   ORIGINAL_VALUE       NUMERIC(19,2),
   INVOICE_NO1          VARCHAR(255),
   INVOICE_NO2          VARCHAR(255),
   PAYMENT_TYPE         VARCHAR(255),
   CERT_NO1             VARCHAR(255),
   CERT_NO2             VARCHAR(255),
   CERT_NO3             VARCHAR(255),
   TAXIMETER_FACTORY    VARCHAR(255),
   TAXIMETER_TYPE       VARCHAR(255),
   TAXIMETER_NO         VARCHAR(255),
   DESC1                VARCHAR(4000),
   DESC2                VARCHAR(4000),
   DESC3                VARCHAR(4000),
   FILE_DATE            TIMESTAMP	NOT NULL,
   AUTHOR_ID            INTEGER		NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   RETURN_DATE        	TIMESTAMP,
   IS_LOGOUT 			BOOLEAN DEFAULT FALSE,
   LOGOUT_REASON		INTEGER DEFAULT 0,
   DISTANCE_SCRAP_MONTH	VARCHAR(20),
   IS_VERIFY 			BOOLEAN DEFAULT FALSE,
   VERIFY_DATE			TIMESTAMP,
   LOGOUT_REMARK		VARCHAR(4000),
	CERT_NO4 				VARCHAR(255),
	LPG_NAME 				VARCHAR(255),
	LPG_MODEL 				VARCHAR(255),
	LPG_GP_MODEL 			VARCHAR(255),
	LPG_GP_ID 				VARCHAR(255),
	LPG_GP_DATE 			TIMESTAMP,
	LPG_JCF_MODEL 			VARCHAR(255),
	LPG_QHQ_MODEL 			VARCHAR(255),
	LPG_PSQ_MODEL 			VARCHAR(255),
	LPG_REFIT_FACTORY 		VARCHAR(255),
	LPG_REFIT_DATE 			TIMESTAMP,
	LPG_INSURANCE_ID 		VARCHAR(255),
	LPG_INSURANCE_STARTDATE	TIMESTAMP,
	LPG_INSURANCE_ENDDATE 	TIMESTAMP,
	CAR_TV_SCREEN 			VARCHAR(255),
   CONSTRAINT BSPK_CAR PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR IS '车辆';
COMMENT ON COLUMN BS_CAR.STATUS_ IS '状态：-1-草稿,0-在案,1-注销,2-报废';
COMMENT ON COLUMN BS_CAR.VER_MAJOR IS '主版本号';
COMMENT ON COLUMN BS_CAR.VER_MINOR IS '次版本号';
COMMENT ON COLUMN BS_CAR.COMPANY IS '所属单位';
COMMENT ON COLUMN BS_CAR.MOTORCADE_ID IS '所属车队ID';
COMMENT ON COLUMN BS_CAR.DRIVER IS '司机信息';
COMMENT ON COLUMN BS_CAR.CHARGER IS '责任人信息';
COMMENT ON COLUMN BS_CAR.BS_TYPE IS '营运性质';
COMMENT ON COLUMN BS_CAR.CODE IS '自编号';
COMMENT ON COLUMN BS_CAR.ORIGIN_NO IS '原车号';
COMMENT ON COLUMN BS_CAR.PLATE_TYPE IS '车牌归属，如“粤A”';
COMMENT ON COLUMN BS_CAR.PLATE_NO IS '车牌号码，如“C4X74”';
COMMENT ON COLUMN BS_CAR.VIN IS '车辆识别代号';
COMMENT ON COLUMN BS_CAR.RENT_NO IS '出租牌号';
COMMENT ON COLUMN BS_CAR.FACTORY_TYPE IS '厂牌类型，如“桑塔纳”';
COMMENT ON COLUMN BS_CAR.FACTORY_MODEL IS '厂牌型号，如“SVW7182QQD”';
COMMENT ON COLUMN BS_CAR.REGISTER_DATE IS '登记日期';
COMMENT ON COLUMN BS_CAR.OPERATE_DATE IS '投产日期';
COMMENT ON COLUMN BS_CAR.SCRAP_DATE IS '报废日期';
COMMENT ON COLUMN BS_CAR.FACTORY_DATE IS '出厂日期';
COMMENT ON COLUMN BS_CAR.REGISTER_NO IS '机动车登记编号';
COMMENT ON COLUMN BS_CAR.LEVEL_ IS '车辆定级';
COMMENT ON COLUMN BS_CAR.COLOR IS '颜色';
COMMENT ON COLUMN BS_CAR.ENGINE_NO IS '发动机号码';
COMMENT ON COLUMN BS_CAR.ENGINE_TYPE IS '发动机类型';
COMMENT ON COLUMN BS_CAR.FUEL_TYPE IS '燃料类型，如“汽油”';
COMMENT ON COLUMN BS_CAR.DISPLACEMENT IS '排量，单位ML';
COMMENT ON COLUMN BS_CAR.POWER IS '功率，单位KW';
COMMENT ON COLUMN BS_CAR.TURN_TYPE IS '转向方式，如“方向盘”';
COMMENT ON COLUMN BS_CAR.TIRE_COUNT IS '轮胎数';
COMMENT ON COLUMN BS_CAR.TIRE_STANDARD IS '轮胎规格';
COMMENT ON COLUMN BS_CAR.TIRE_FRONT_DISTANCE IS '前轮距';
COMMENT ON COLUMN BS_CAR.TIRE_BEHIND_DISTANCE IS '后轮距';
COMMENT ON COLUMN BS_CAR.AXIS_DISTANCE IS '轴距';
COMMENT ON COLUMN BS_CAR.AXIS_COUNT IS '轴数';
COMMENT ON COLUMN BS_CAR.PIECE_COUNT IS '后轴钢板弹簧片数';
COMMENT ON COLUMN BS_CAR.DIM_LEN IS '外廓尺寸：长，单位MM';
COMMENT ON COLUMN BS_CAR.DIM_WIDTH IS '外廓尺寸：宽，单位MM';
COMMENT ON COLUMN BS_CAR.DIM_HEIGHT IS '外廓尺寸：高，单位MM';
COMMENT ON COLUMN BS_CAR.TOTAL_WEIGHT IS '总质量，单位KG';
COMMENT ON COLUMN BS_CAR.ACCESS_WEIGHT IS '核定载质量，单位KG';
COMMENT ON COLUMN BS_CAR.ACCESS_COUNT IS '核定载人数';
COMMENT ON COLUMN BS_CAR.ORIGINAL_VALUE IS '固定资产原值，单位元';
COMMENT ON COLUMN BS_CAR.INVOICE_NO1 IS '购车发票号';
COMMENT ON COLUMN BS_CAR.INVOICE_NO2 IS '购置税发票号';
COMMENT ON COLUMN BS_CAR.PAYMENT_TYPE IS '缴费日';
COMMENT ON COLUMN BS_CAR.CERT_NO1 IS '购置税证号';
COMMENT ON COLUMN BS_CAR.CERT_NO2 IS '经营权使用证号';
COMMENT ON COLUMN BS_CAR.CERT_NO3 IS '强检证号';
COMMENT ON COLUMN BS_CAR.TAXIMETER_FACTORY IS '计价器制造厂';
COMMENT ON COLUMN BS_CAR.TAXIMETER_TYPE IS '计价器型号';
COMMENT ON COLUMN BS_CAR.TAXIMETER_NO IS '计价器出厂编号';
COMMENT ON COLUMN BS_CAR.DESC1 IS '备注1';
COMMENT ON COLUMN BS_CAR.DESC2 IS '备注2';
COMMENT ON COLUMN BS_CAR.DESC3 IS '备注3';
COMMENT ON COLUMN BS_CAR.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CAR.IS_LOGOUT IS '起动注销程序';
COMMENT ON COLUMN BS_CAR.RETURN_DATE IS '交车日期';
COMMENT ON COLUMN BS_CAR.LOGOUT_REASON IS '注销原因(0-"",1-转蓝归公司,2-转蓝归责任人,3-报废,4-被盗,5-被抢,9-其它),详见car.logout.reason选项的配置';
COMMENT ON COLUMN BS_CAR.DISTANCE_SCRAP_MONTH IS '离报废日期时间';
COMMENT ON COLUMN BS_CAR.IS_VERIFY IS '主管部门核准';
COMMENT ON COLUMN BS_CAR.VERIFY_DATE IS '核准日期';
COMMENT ON COLUMN BS_CAR.LOGOUT_REMARK IS '注销原因';
COMMENT ON COLUMN BS_CAR.CERT_NO4 IS '道路运输证号';
COMMENT ON COLUMN BS_CAR.LPG_NAME IS 'LPG专用装置供应商';
COMMENT ON COLUMN BS_CAR.LPG_MODEL IS 'LPG专用装置品牌型号';
COMMENT ON COLUMN BS_CAR.LPG_GP_MODEL IS 'LPG钢瓶品牌型号';
COMMENT ON COLUMN BS_CAR.LPG_GP_ID IS 'LPG钢瓶编号';
COMMENT ON COLUMN BS_CAR.LPG_GP_DATE IS 'LPG钢瓶出厂日期';
COMMENT ON COLUMN BS_CAR.LPG_JCF_MODEL IS 'LPG集成阀品牌型号';
COMMENT ON COLUMN BS_CAR.LPG_QHQ_MODEL IS 'LPG汽化器品牌型号';
COMMENT ON COLUMN BS_CAR.LPG_PSQ_MODEL IS 'LPG混合/喷射器品牌型号';
COMMENT ON COLUMN BS_CAR.LPG_REFIT_FACTORY IS 'LPG改装厂';
COMMENT ON COLUMN BS_CAR.LPG_REFIT_DATE IS 'LPG改装出厂日期';
COMMENT ON COLUMN BS_CAR.LPG_INSURANCE_ID IS 'LPG保单号';
COMMENT ON COLUMN BS_CAR.LPG_INSURANCE_STARTDATE IS 'LPG保单开始日期';
COMMENT ON COLUMN BS_CAR.LPG_INSURANCE_ENDDATE IS 'LPG保单结束日期';
COMMENT ON COLUMN BS_CAR.CAR_TV_SCREEN IS '车载电视屏';
ALTER TABLE BS_CAR ADD CONSTRAINT BSFK_CAR_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR ADD CONSTRAINT BSFK_CAR_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR ADD CONSTRAINT BSFK_CAR_MOTORCADEID FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CARMAN ADD CONSTRAINT BSFK_CARMAN_MAINCAR FOREIGN KEY (MAIN_CAR_ID) 
	REFERENCES BS_CAR (ID);
CREATE INDEX BSIDX_CAR_STATUS ON BS_CAR (STATUS_);
CREATE INDEX BSIDX_CAR_STATUS_PLATE ON BS_CAR (STATUS_,PLATE_TYPE,PLATE_NO);
CREATE INDEX BSIDX_CAR_STATUS_CODE ON BS_CAR (STATUS_,CODE);
CREATE INDEX BSIDX_CAR_MOTORCADE ON BS_CAR (MOTORCADE_ID);
CREATE INDEX BSIDX_CAR_VIN ON BS_CAR (VIN);
CREATE INDEX BSIDX_CAR_ENGINENO ON BS_CAR (ENGINE_NO);
CREATE INDEX BSIDX_CAR_INVOICENO2 ON BS_CAR (INVOICE_NO2);

-- 车型配置
CREATE TABLE BS_CAR_MODEL (
   ID                   INTEGER           NOT NULL,
   UID_                 VARCHAR(36)       NOT NULL,
   STATUS_              INTEGER           NOT NULL,
   ORDER_         		VARCHAR(100),
   FACTORY_TYPE         VARCHAR(255),
   FACTORY_MODEL        VARCHAR(255),
   ENGINE_TYPE          VARCHAR(255),
   FUEL_TYPE            VARCHAR(255),
   DISPLACEMENT         INTEGER,
   POWER                NUMERIC(19,2),
   TURN_TYPE            VARCHAR(255),
   TIRE_COUNT           INTEGER,
   TIRE_STANDARD        VARCHAR(255),
   TIRE_FRONT_DISTANCE  VARCHAR(255),
   TIRE_BEHIND_DISTANCE VARCHAR(255),
   AXIS_DISTANCE        INTEGER,
   AXIS_COUNT           INTEGER,
   PIECE_COUNT          INTEGER,
   DIM_LEN              INTEGER,
   DIM_WIDTH            INTEGER,
   DIM_HEIGHT           INTEGER,
   TOTAL_WEIGHT         INTEGER,
   ACCESS_WEIGHT        INTEGER,
   ACCESS_COUNT         INTEGER,
   FILE_DATE            TIMESTAMP	NOT NULL,
   AUTHOR_ID            INTEGER		NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   CONSTRAINT BSPK_CAR_MODEL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_MODEL IS '车型配置';
COMMENT ON COLUMN BS_CAR_MODEL.STATUS_ IS '状态：0-在案,1-注销';
COMMENT ON COLUMN BS_CAR_MODEL.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_CAR_MODEL.FACTORY_TYPE IS '厂牌类型，如“桑塔纳”';
COMMENT ON COLUMN BS_CAR_MODEL.FACTORY_MODEL IS '厂牌型号，如“SVW7182QQD”';
COMMENT ON COLUMN BS_CAR_MODEL.ENGINE_TYPE IS '发动机类型';
COMMENT ON COLUMN BS_CAR_MODEL.FUEL_TYPE IS '燃料类型，如“汽油”';
COMMENT ON COLUMN BS_CAR_MODEL.DISPLACEMENT IS '排量，单位ML';
COMMENT ON COLUMN BS_CAR_MODEL.POWER IS '功率，单位KW';
COMMENT ON COLUMN BS_CAR_MODEL.TURN_TYPE IS '转向方式，如“方向盘”';
COMMENT ON COLUMN BS_CAR_MODEL.TIRE_COUNT IS '轮胎数';
COMMENT ON COLUMN BS_CAR_MODEL.TIRE_STANDARD IS '轮胎规格';
COMMENT ON COLUMN BS_CAR_MODEL.TIRE_FRONT_DISTANCE IS '前轮距';
COMMENT ON COLUMN BS_CAR_MODEL.TIRE_BEHIND_DISTANCE IS '后轮距';
COMMENT ON COLUMN BS_CAR_MODEL.AXIS_DISTANCE IS '轴距';
COMMENT ON COLUMN BS_CAR_MODEL.AXIS_COUNT IS '轴数';
COMMENT ON COLUMN BS_CAR_MODEL.PIECE_COUNT IS '后轴钢板弹簧片数';
COMMENT ON COLUMN BS_CAR_MODEL.DIM_LEN IS '外廓尺寸：长，单位MM';
COMMENT ON COLUMN BS_CAR_MODEL.DIM_WIDTH IS '外廓尺寸：宽，单位MM';
COMMENT ON COLUMN BS_CAR_MODEL.DIM_HEIGHT IS '外廓尺寸：高，单位MM';
COMMENT ON COLUMN BS_CAR_MODEL.TOTAL_WEIGHT IS '总质量，单位KG';
COMMENT ON COLUMN BS_CAR_MODEL.ACCESS_WEIGHT IS '核定载质量，单位KG';
COMMENT ON COLUMN BS_CAR_MODEL.ACCESS_COUNT IS '核定载人数';
COMMENT ON COLUMN BS_CAR_MODEL.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_MODEL.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_MODEL.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR_MODEL.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_CAR_MODEL ADD CONSTRAINT BSFK_CAR_MODEL_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_MODEL ADD CONSTRAINT BSFK_CAR_MODEL_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CAR_MODEL_STATUS ON BS_CAR_MODEL (STATUS_);

-- 车辆与证件的关联
CREATE TABLE BS_CAR_CERT (
    CAR_ID INTEGER NOT NULL,
    CERT_ID INTEGER NOT NULL,
    CONSTRAINT BSPK_CAR_CERT PRIMARY KEY (CAR_ID,CERT_ID)
);
COMMENT ON TABLE BS_CAR_CERT IS '车辆与证件的关联';
COMMENT ON COLUMN BS_CAR_CERT.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CAR_CERT.CERT_ID IS '证件ID';
ALTER TABLE BS_CAR_CERT ADD CONSTRAINT BSFK_CARCERT_CAR FOREIGN KEY (CAR_ID) 
	REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_CERT ADD CONSTRAINT BSFK_CARCERT_CERT FOREIGN KEY (CERT_ID) 
	REFERENCES BS_CERT (ID);


-- 合同
CREATE TABLE BS_CONTRACT (
   ID                   INTEGER           NOT NULL,
   UID_                 VARCHAR(36)         NOT NULL,
   PID                  INTEGER,
   STATUS_              INTEGER            NOT NULL,
   VER_MAJOR            NUMERIC(2),
   VER_MINOR            NUMERIC(3),
   PATCH_NO             VARCHAR(255)        NOT NULL,
   MAIN                 INTEGER            NOT NULL,
   WORD_NO              VARCHAR(255),
   CODE                 VARCHAR(255)        NOT NULL,
   TYPE_                INTEGER            NOT NULL,
   OP_TYPE              INTEGER            NOT NULL,
   TRANSACTOR_ID        INTEGER,
   TRANSACTOR_NAME      VARCHAR(255),
   SIGN_DATE            TIMESTAMP,
   START_DATE           TIMESTAMP                 NOT NULL,
   END_DATE             TIMESTAMP                 NOT NULL,
   STOP_DATE 			TIMESTAMP,
   CONTENT              VARCHAR(4000),
   EXT_STR1             VARCHAR(255),
   EXT_STR2             VARCHAR(4000),
   EXT_STR3             VARCHAR(255),
   EXT_NUM1             INTEGER,
   EXT_NUM2             INTEGER,
   EXT_NUM3             INTEGER,
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   LOGOUT_ID 			INTEGER,
   LOGOUT_DATE 			TIMESTAMP,
   CONSTRAINT PK_BS_CONTRACT PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CONTRACT IS'合同';
COMMENT ON COLUMN BS_CONTRACT.STATUS_ IS'状态：-1-草稿,0-在案,1-注销,2-离职';
COMMENT ON COLUMN BS_CONTRACT.VER_MAJOR IS '主版本号';
COMMENT ON COLUMN BS_CONTRACT.VER_MINOR IS '次版本号';
COMMENT ON COLUMN BS_CONTRACT.PATCH_NO IS '批号';
COMMENT ON COLUMN BS_CONTRACT.MAIN IS '主体: 0-当前版本,1-历史版本';
COMMENT ON COLUMN BS_CONTRACT.WORD_NO IS '文书号';
COMMENT ON COLUMN BS_CONTRACT.CODE IS '合同号';
COMMENT ON COLUMN BS_CONTRACT.TYPE_ IS '合同类型：1-司机劳动合同、2-责任人合同';
COMMENT ON COLUMN BS_CONTRACT.OP_TYPE IS '操作类型: 1-新建,2-维护,3-转车,4-续约,5-离职';
COMMENT ON COLUMN BS_CONTRACT.TRANSACTOR_ID IS '经办人ID';
COMMENT ON COLUMN BS_CONTRACT.TRANSACTOR_NAME IS '经办人姓名';
COMMENT ON COLUMN BS_CONTRACT.SIGN_DATE IS '签订日期';
COMMENT ON COLUMN BS_CONTRACT.START_DATE IS '生效日期';
COMMENT ON COLUMN BS_CONTRACT.END_DATE IS '到期日期';
COMMENT ON COLUMN BS_CONTRACT.STOP_DATE IS '合同实际结束日';
COMMENT ON COLUMN BS_CONTRACT.CONTENT IS '合同内容';
COMMENT ON COLUMN BS_CONTRACT.EXT_STR1 IS '车牌';
COMMENT ON COLUMN BS_CONTRACT.EXT_STR2 IS '司机责任人姓名';
COMMENT ON COLUMN BS_CONTRACT.EXT_STR3 IS '字符扩展域3';
COMMENT ON COLUMN BS_CONTRACT.EXT_NUM1 IS '数字扩展域1';
COMMENT ON COLUMN BS_CONTRACT.EXT_NUM2 IS '数字扩展域2';
COMMENT ON COLUMN BS_CONTRACT.EXT_NUM3 IS '数字扩展域3';
COMMENT ON COLUMN BS_CONTRACT.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CONTRACT.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CONTRACT.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CONTRACT.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CONTRACT.LOGOUT_ID IS '注销人ID';
COMMENT ON COLUMN BS_CONTRACT.LOGOUT_DATE IS '注销时间';
ALTER TABLE BS_CONTRACT ADD CONSTRAINT BSFK_CONTRACT_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CONTRACT ADD CONSTRAINT BSFK_CONTRACT_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CONTRACT ADD CONSTRAINT BSFK_CONTR_REFERENCE_BS_CONTR FOREIGN KEY (PID)
      REFERENCES BS_CONTRACT (ID);
ALTER TABLE BS_CONTRACT ADD CONSTRAINT BSFK_CONTRACT_LOGOUT_ID FOREIGN KEY (LOGOUT_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CONTRACT_STATUS ON BS_CONTRACT (STATUS_);
CREATE INDEX BSIDX_CONTRACT_PATCH_NO ON BS_CONTRACT (PATCH_NO);

-- 司机劳动合同
CREATE TABLE BS_CONTRACT_LABOUR (
   ID                   INTEGER           NOT NULL,
   CERT_NO              VARCHAR(255)        NOT NULL,
   CERT_IDENTITY        VARCHAR(255),
   SEX                  NUMERIC(1),
   BIRTHDATE            TIMESTAMP,
   AGE                  NUMERIC(3),
   ORIGIN               VARCHAR(255),
   REGION_              NUMERIC(1) DEFAULT 0,
   HOUSE_TYPE           VARCHAR(255),
   DOLE                 boolean default false,
   FUNDING              boolean default false,
   INSURCODE            VARCHAR(255),
   JOINDATE             TIMESTAMP,
   REGISTER_DATE        TIMESTAMP,
   INSURE_DATE          TIMESTAMP,
   BS_TYPE              VARCHAR(255),
   BUY_UNIT             VARCHAR(255),
   INSURANCE_TYPE       VARCHAR(255),
   IS_IQAMA             BOOLEAN            DEFAULT FALSE,
   IS_ACCOUNT_BOOK      BOOLEAN            DEFAULT FALSE,
   IS_IDENTITY_CARDS    BOOLEAN            DEFAULT FALSE,
   IS_FPC               BOOLEAN            DEFAULT FALSE,
   IS_UNEMPLOYED        BOOLEAN            DEFAULT FALSE,
   IS_HEALTHFORM        BOOLEAN            DEFAULT FALSE,
   IS_PHOTO             BOOLEAN            DEFAULT FALSE,
   BREEDING_DATE        TIMESTAMP,
   GET_STARTDATE        TIMESTAMP,
   GET_ENDDATE          TIMESTAMP,
   REMARK               VARCHAR(255),
   STOPDATE				TIMESTAMP,
   LEAVEDATE			TIMESTAMP,
   DOMICILE_PLACE 		VARCHAR(255),
   CULTURAL_DEGREE 		VARCHAR(255),
   MARITAL_STATUS 		VARCHAR(255),
   CONSTRAINT PK_BS_CONTRACT_LABOUR PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CONTRACT_LABOUR IS '司机劳动合同';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.CERT_NO IS '资格证号';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.CERT_IDENTITY IS '身份证号';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.SEX IS '性别(0-未设置,1-男,2-女)';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.BIRTHDATE IS '出生日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.AGE IS '年龄: 通过出生年月算出';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.ORIGIN IS '籍贯';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.REGION_ IS '区域：0-未定义，1-本市，2-本省，3-外省';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.HOUSE_TYPE IS '户口类型';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.DOLE IS '个人岗位补贴:0-无,1-有';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.FUNDING IS '对公社保资助';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.INSURCODE IS '社保号';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.JOINDATE IS '参保日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.REGISTER_DATE IS '车辆登记日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.INSURE_DATE IS '申领日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.BS_TYPE IS '营运性质';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.BUY_UNIT IS '购买单位';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.INSURANCE_TYPE IS '社保险种';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_IQAMA IS '是否缴交暂住证';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_ACCOUNT_BOOK IS '是否缴交户口薄';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_IDENTITY_CARDS IS '是否缴交身份证';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_FPC IS '是否缴交计生证';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_UNEMPLOYED IS '是否缴交失业就业手册';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_HEALTHFORM IS '是否缴交体检表';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.IS_PHOTO IS '是否缴交照片';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.BREEDING_DATE IS '生育日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.GET_STARTDATE IS '申领开始日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.GET_ENDDATE IS '申领结束日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.REMARK IS '备注';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.STOPDATE IS '停保日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.LEAVEDATE IS '离职日期';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.DOMICILE_PLACE IS '户口所在地';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.CULTURAL_DEGREE IS '文化程度';
COMMENT ON COLUMN BS_CONTRACT_LABOUR.MARITAL_STATUS IS '婚姻状况';
ALTER TABLE BS_CONTRACT_LABOUR ADD CONSTRAINT BSFK_CONTRACT4LABOUR_CONTRACT FOREIGN KEY (ID)
      REFERENCES BS_CONTRACT (ID);

-- 责任人合同
CREATE TABLE BS_CONTRACT_CHARGER (
   ID                   INTEGER           	NOT NULL,
   SIGN_TYPE            VARCHAR(255)        NOT NULL,
   TAKEBACK_ORIGIN      BOOLEAN            	DEFAULT FALSE,
   INCLUDE_COST         BOOLEAN            	DEFAULT FALSE,
   BS_TYPE				VARCHAR(255),
   PAYMENT_DATE			VARCHAR(255),
   CONTRACT_VERSION_NO 	VARCHAR(255),
   SCRAPTO 				VARCHAR(255),
   OLD_CONTENT          VARCHAR(4000),
   QUITTER_ID			INTEGER,
   AGREEMENT_START_DATE TIMESTAMP,
   AGREEMENT_END_DATE 	TIMESTAMP,
   CONSTRAINT BSPK_CONTRACT_CHARGER PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CONTRACT_CHARGER IS '责任人合同:如承包合同';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.SIGN_TYPE IS '签约类型:如新户';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.PAYMENT_DATE IS '缴费日期';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.TAKEBACK_ORIGIN IS '已经收回原件:0-未1-已';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.INCLUDE_COST IS '包含检审费用:0-不包含,1-包含';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.BS_TYPE IS '合同性质';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.CONTRACT_VERSION_NO IS '合同版本号';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.SCRAPTO IS '残值归属';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.OLD_CONTENT IS '旧合同内容';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.QUITTER_ID IS '提前终止方';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.AGREEMENT_START_DATE IS '履方协议期限(开始日期)';
COMMENT ON COLUMN BS_CONTRACT_CHARGER.AGREEMENT_END_DATE IS '履方协议期限(结束日期)';
ALTER TABLE BS_CONTRACT_CHARGER ADD CONSTRAINT BSFK_CONTRACT4CHARGER_CONTRACT FOREIGN KEY (ID)
      REFERENCES BS_CONTRACT (ID);
ALTER TABLE BS_CONTRACT_CHARGER ADD CONSTRAINT BSFK_CONTRACT4CHARGER_QUITTER FOREIGN KEY (QUITTER_ID)
      REFERENCES BS_CARMAN (ID);
      
-- 司机责任人与合同的关联
CREATE TABLE BS_CARMAN_CONTRACT (
   MAN_ID               INTEGER           NOT NULL,
   CONTRACT_ID          INTEGER           NOT NULL,
   CONSTRAINT BSPK_CARMAN_CONTRACT PRIMARY KEY (MAN_ID, CONTRACT_ID)
);
COMMENT ON TABLE BS_CARMAN_CONTRACT IS '司机责任人与合同的关联';
COMMENT ON COLUMN BS_CARMAN_CONTRACT.MAN_ID IS '司机责任人ID';
COMMENT ON COLUMN BS_CARMAN_CONTRACT.CONTRACT_ID IS '合同ID';
ALTER TABLE BS_CARMAN_CONTRACT ADD CONSTRAINT BSFK_CARMANCONTRACT_CONTRACT FOREIGN KEY (CONTRACT_ID)
      REFERENCES BS_CONTRACT (ID);
ALTER TABLE BS_CARMAN_CONTRACT ADD CONSTRAINT BSFK_CARMANCONTRACT_MAN FOREIGN KEY (MAN_ID)
      REFERENCES BS_CARMAN (ID);
CREATE INDEX BSIDX_CARMANCONTRACT_CONTRACT ON BS_CARMAN_CONTRACT (CONTRACT_ID);
CREATE INDEX BSIDX_CARMANCONTRACT_MAN ON BS_CARMAN_CONTRACT (MAN_ID);

-- 车辆与合同的关联
CREATE TABLE BS_CAR_CONTRACT (
   CAR_ID               INTEGER           NOT NULL,
   CONTRACT_ID          INTEGER           NOT NULL,
   CONSTRAINT BSPK_CAR_CONTRACT PRIMARY KEY (CAR_ID, CONTRACT_ID)
);
COMMENT ON TABLE BS_CAR_CONTRACT IS '车辆与合同的关联';
COMMENT ON COLUMN BS_CAR_CONTRACT.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CAR_CONTRACT.CONTRACT_ID IS '合同ID';
ALTER TABLE BS_CAR_CONTRACT ADD CONSTRAINT BSFK_CARCONTRACT_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_CONTRACT ADD CONSTRAINT BSFK_CARCONTRACT_CONTRACT FOREIGN KEY (CONTRACT_ID)
      REFERENCES BS_CONTRACT (ID);
            
-- 司机营运车辆
CREATE TABLE BS_CAR_DRIVER (
   ID                   INTEGER         NOT NULL,
   PID                  INTEGER,
   STATUS_              INTEGER         NOT NULL,
   DRIVER_ID            INTEGER         NOT NULL,
   CAR_ID               INTEGER         NOT NULL,
   CLASSES              INTEGER         NOT NULL,
   FILE_DATE            TIMESTAMP       NOT NULL,
   AUTHOR_ID            INTEGER         NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   DESC_                VARCHAR(4000),
  CONSTRAINT BSPK_CAR_DRIVER PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_DRIVER IS '司机营运车辆';
COMMENT ON COLUMN BS_CAR_DRIVER.PID IS '相对应的迁移记录id';
COMMENT ON COLUMN BS_CAR_DRIVER.STATUS_ IS '状态：0-启用中,1-已禁用,2-已删除';
COMMENT ON COLUMN BS_CAR_DRIVER.DRIVER_ID IS '司机ID';
COMMENT ON COLUMN BS_CAR_DRIVER.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CAR_DRIVER.CLASSES IS '营运班次:如1-正班、2-副班、3-主挂、4-顶班';
COMMENT ON COLUMN BS_CAR_DRIVER.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_DRIVER.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_DRIVER.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CAR_DRIVER.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR_DRIVER.DESC_ IS '备注';
ALTER TABLE BS_CAR_DRIVER ADD CONSTRAINT BSFK_CARDRIVER_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_DRIVER ADD CONSTRAINT BSFK_CARDRIVER_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_DRIVER ADD CONSTRAINT BSFK_CARDRIVER_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_DRIVER ADD CONSTRAINT BSFK_CARDRIVER_CARMAN FOREIGN KEY (DRIVER_ID)
      REFERENCES BS_CARMAN (ID);
      CREATE INDEX BSIDX_CARDRIVER_CAR ON BS_CAR_DRIVER (CAR_ID);
      CREATE INDEX BSIDX_CARDRIVER_DRIVER ON BS_CAR_DRIVER (DRIVER_ID);
      
 -- 迁移记录
CREATE TABLE BS_CAR_DRIVER_HISTORY (
   ID                   INTEGER           NOT NULL,
   DRIVER_ID            INTEGER  ,
   FROM_CAR_ID             INTEGER,
   FROM_MOTORCADE_ID       INTEGER,
   FROM_CLASSES       NUMERIC(1),
   TO_CAR_ID             INTEGER,
   TO_MOTORCADE_ID       INTEGER,
   TO_CLASSES      NUMERIC(1),
   MOVE_DATE              TIMESTAMP,
   MOVE_TYPE            INTEGER         NOT NULL,  
   FROM_UNIT              VARCHAR(255),
   TO_UNIT                VARCHAR(255),
   HAND_PAPERS_DATE      TIMESTAMP,
   CANCEL_ID            VARCHAR(255),
   END_DATE             TIMESTAMP,
   SHIFTWORK            VARCHAR(255),
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   DESC_                VARCHAR(4000),
  CONSTRAINT BSPK_CAR_DRIVER_HISTORY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_DRIVER_HISTORY IS '迁移记录';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.DRIVER_ID IS '司机ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.FROM_CAR_ID IS '原车辆ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.FROM_MOTORCADE_ID IS '原车队ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.FROM_CLASSES IS '原营运班次:如1-正班、2-副班、3-主挂、4-顶班';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.TO_CAR_ID IS '新车辆ID(或主挂车)';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.TO_MOTORCADE_ID IS '新车队ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.TO_CLASSES IS '新营运班次:如1-正班、2-副班、3-主挂、4-顶班';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.MOVE_DATE IS '迁移日期(或顶班合同的开始日期)';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.MOVE_TYPE IS '迁移类型:1-公司到公司(已注销);2-注销未有去向;3-由外公司迁回;4-交回未注销;5-新入职;6-转车队;7-顶班;8-交回后转车';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.FROM_UNIT IS '原单位';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.TO_UNIT IS '现单位';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.HAND_PAPERS_DATE IS '交证日期';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.CANCEL_ID IS '注销单号';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.END_DATE IS '顶班合同结束日期';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.SHIFTWORK IS '顶班车辆';

COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR_DRIVER_HISTORY.DESC_ IS '备注';
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CARDRIVERHISTORY_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CARDRIVERHISTORY_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CARDRIVER_OLD_CAR FOREIGN KEY (FROM_CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CARDRIVER_NEW_CAR FOREIGN KEY (TO_CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CASEBASE_OLD_MOTORCADE FOREIGN KEY (FROM_MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CASEBASE_NEW_MOTORCADE FOREIGN KEY (TO_MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CAR_DRIVER_HISTORY ADD CONSTRAINT BSFK_CARDRIVERHISTORY_CARMAN FOREIGN KEY (DRIVER_ID)
      REFERENCES BS_CARMAN (ID);
      CREATE INDEX BSIDX_CARDRIVERHISTORY_TO_CAR ON BS_CAR_DRIVER_HISTORY (TO_CAR_ID);
      CREATE INDEX BSIDX_CARDRIVERHISTORY_FR_CAR ON BS_CAR_DRIVER_HISTORY (FROM_CAR_ID);
      CREATE INDEX BSIDX_CARDRIVERHISTORY_DRIVER ON BS_CAR_DRIVER_HISTORY (DRIVER_ID);
           
-- 司机迁移历史
CREATE TABLE BS_CARMAN_HISTORY (
   ID                   INTEGER           NOT NULL,
   TYPE_                VARCHAR(255)        NOT NULL,
   DRIVER_ID            INTEGER           NOT NULL,
   SUBJECT              VARCHAR(1000),
   FROM_CARID           INTEGER,
   TO_CARID             INTEGER           NOT NULL,
   FROM_CLASSES         VARCHAR(255),
   TO_CLASSES           VARCHAR(255)        NOT NULL,
   SHIFT_DATE           TIMESTAMP                 NOT NULL,
   FROM_MOTORCADEID     INTEGER,
   TO_MOTORCADEID       INTEGER           NOT NULL,
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   CONSTRAINT BSPK_CARMAN_HISTORY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CARMAN_HISTORY IS '司机迁移历史';
COMMENT ON COLUMN BS_CARMAN_HISTORY.TYPE_ IS '迁移属性，如新入职';
COMMENT ON COLUMN BS_CARMAN_HISTORY.DRIVER_ID IS '司机ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.SUBJECT IS '其他';
COMMENT ON COLUMN BS_CARMAN_HISTORY.FROM_CARID IS '迁自车辆ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.TO_CARID IS '迁往车辆ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.FROM_CLASSES IS '原营运班次:如正班、副班、顶班';
COMMENT ON COLUMN BS_CARMAN_HISTORY.TO_CLASSES IS '新营运班次:如正班、副班、顶班';
COMMENT ON COLUMN BS_CARMAN_HISTORY.SHIFT_DATE IS '迁移日期';
COMMENT ON COLUMN BS_CARMAN_HISTORY.FROM_MOTORCADEID IS '原车队ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.TO_MOTORCADEID IS '迁往车队ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CARMAN_HISTORY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CARMAN_HISTORY.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CARMAN_HISTORY.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_DRIVER FOREIGN KEY (DRIVER_ID)
      REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_FROMCAR FOREIGN KEY (FROM_CARID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_TOCAR FOREIGN KEY (TO_CARID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_FROMMC FOREIGN KEY (FROM_MOTORCADEID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_TOMC FOREIGN KEY (TO_MOTORCADEID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID); 
ALTER TABLE BS_CARMAN_HISTORY ADD CONSTRAINT BSFK_CARMANH_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 黑名单
CREATE TABLE BS_BLACKLIST (
   ID                   INTEGER           NOT NULL,
   STATUS_              NUMERIC(1),
   TYPE_                VARCHAR(255)        NOT NULL,
   COMPANY        		VARCHAR(255),
   DRIVER_ID            INTEGER,
   CAR_ID               INTEGER,
   MOTORCADE_ID         INTEGER,
   SUBJECT              VARCHAR(1000),
   LOCK_DATE            TIMESTAMP                 NOT NULL,
   UNLOCK_DATE          TIMESTAMP,
   LOCKER_ID            INTEGER           NOT NULL,
   UNLOCKER_ID          INTEGER,
   LOCK_REASON          VARCHAR(4000),
   UNLOCK_REASON        VARCHAR(4000),
   LEVEL_               VARCHAR(255),
   CODE                 VARCHAR(255),
   APPOINT_DATE 		TIMESTAMP,
   CONVERSION_TYPE 		VARCHAR(255),
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   CONSTRAINT BSPK_BLACKLIST PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_BLACKLIST IS '黑名单';
COMMENT ON COLUMN BS_BLACKLIST.STATUS_ IS '状态：0-锁定,1-解锁';
COMMENT ON COLUMN BS_BLACKLIST.TYPE_ IS '限制项目';
COMMENT ON COLUMN BS_BLACKLIST.COMPANY IS '所属公司';
COMMENT ON COLUMN BS_BLACKLIST.DRIVER_ID IS '司机ID';
COMMENT ON COLUMN BS_BLACKLIST.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_BLACKLIST.MOTORCADE_ID IS '车队ID';
COMMENT ON COLUMN BS_BLACKLIST.SUBJECT IS '主题';
COMMENT ON COLUMN BS_BLACKLIST.LOCK_DATE IS '锁定时间';
COMMENT ON COLUMN BS_BLACKLIST.UNLOCK_DATE IS '解锁时间';
COMMENT ON COLUMN BS_BLACKLIST.LOCKER_ID IS '锁定人ID';
COMMENT ON COLUMN BS_BLACKLIST.UNLOCKER_ID IS '解锁人ID';
COMMENT ON COLUMN BS_BLACKLIST.LOCK_REASON IS '锁定原因';
COMMENT ON COLUMN BS_BLACKLIST.UNLOCK_REASON IS '解锁原因';
COMMENT ON COLUMN BS_BLACKLIST.LEVEL_ IS '等级';
COMMENT ON COLUMN BS_BLACKLIST.CODE IS '编号';
COMMENT ON COLUMN BS_BLACKLIST.APPOINT_DATE IS '指定日期';
COMMENT ON COLUMN BS_BLACKLIST.CONVERSION_TYPE IS '指定日期后替换为限制项目';
COMMENT ON COLUMN BS_BLACKLIST.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_BLACKLIST.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_BLACKLIST.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_BLACKLIST.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_MOTORCADE FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_DIRVER FOREIGN KEY (DRIVER_ID)
      REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_LOCKER FOREIGN KEY (LOCKER_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
ALTER TABLE BS_BLACKLIST ADD CONSTRAINT BSFK_BLACKLIST_UNLOCKER FOREIGN KEY (UNLOCKER_ID)
      REFERENCES BC_IDENTITY_ACTOR (ID);
      CREATE INDEX BSIDX_BLACKLIST_DRIVER ON BS_BLACKLIST (DRIVER_ID);
      CREATE INDEX BSIDX_BLACKLIST_CAR ON BS_BLACKLIST (CAR_ID);

-- 营运事件基表
CREATE TABLE BS_CASE_BASE (
   ID                   INTEGER           NOT NULL,
   UID_                 VARCHAR(36)         NOT NULL,
   CASE_NO              VARCHAR(255),
   CODE                 VARCHAR(255),
   TYPE_                INTEGER            NOT NULL,
   STATUS_              INTEGER            NOT NULL,
   SOURCE               INTEGER            NOT NULL,
   SUBJECT              VARCHAR(1000),
   ADDRESS              VARCHAR(1000),
   FROM_                VARCHAR(255),
   HAPPEN_DATE          TIMESTAMP                 NOT NULL,
   COMPANY       		VARCHAR(255),
   MOTORCADE_ID         INTEGER,
   MOTORCADE_NAME       VARCHAR(255),
   CAR_ID               INTEGER,
   CAR_PLATE            VARCHAR(255),
   DRIVER_ID		INTEGER,
   DRIVER_NAME          VARCHAR(255),
   DRIVER_CERT          VARCHAR(255),
   CLOSE_DATE           TIMESTAMP,
   CLOSER_ID            INTEGER,
   CLOSER_NAME          VARCHAR(255),
   DESC_                VARCHAR(4000),
   FILE_DATE            TIMESTAMP                 NOT NULL,
   AUTHOR_ID            INTEGER           NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   SYNC_UID             VARCHAR(36),
   SYNC_ID              INTEGER,
   CONSTRAINT BSPK_CASEBASE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_BASE IS '营运事件：表扬、投诉、营运违章、交通违法、事故等的基表';
COMMENT ON COLUMN BS_CASE_BASE.CASE_NO IS '案号：营运违章的案号，交通违章的违章顺序号等';
COMMENT ON COLUMN BS_CASE_BASE.CODE IS '自编号';
COMMENT ON COLUMN BS_CASE_BASE.TYPE_ IS '内部类型：1-表扬、2-投诉、3-营运违章、4-交通违章、5-事故';
COMMENT ON COLUMN BS_CASE_BASE.STATUS_ IS '状态：0-在案,1-已结案';
COMMENT ON COLUMN BS_CASE_BASE.SOURCE IS '来源：1-用户创建(手输)、2-接口导入、3-司机递交等';
COMMENT ON COLUMN BS_CASE_BASE.SUBJECT IS '标题';
COMMENT ON COLUMN BS_CASE_BASE.ADDRESS IS '事发地点';
COMMENT ON COLUMN BS_CASE_BASE.HAPPEN_DATE IS '事发时间';
COMMENT ON COLUMN BS_CASE_BASE.FROM_ IS '信息来源(用户填写)';
COMMENT ON COLUMN BS_CASE_BASE.COMPANY IS '所属公司:如宝城、广发';
COMMENT ON COLUMN BS_CASE_BASE.MOTORCADE_ID IS '车队ID';
COMMENT ON COLUMN BS_CASE_BASE.MOTORCADE_NAME IS '车队名称';
COMMENT ON COLUMN BS_CASE_BASE.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CASE_BASE.CAR_PLATE IS '车辆号码';
COMMENT ON COLUMN BS_CASE_BASE.DRIVER_CERT IS '司机ID';
COMMENT ON COLUMN BS_CASE_BASE.DRIVER_NAME IS '司机姓名';
COMMENT ON COLUMN BS_CASE_BASE.DRIVER_CERT IS '服务资格证';
COMMENT ON COLUMN BS_CASE_BASE.CLOSE_DATE IS '结案日期';
COMMENT ON COLUMN BS_CASE_BASE.CLOSER_ID IS '结案人ID';
COMMENT ON COLUMN BS_CASE_BASE.CLOSER_NAME IS '结案人姓名';
COMMENT ON COLUMN BS_CASE_BASE.DESC_ IS '备注';
COMMENT ON COLUMN BS_CASE_BASE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CASE_BASE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CASE_BASE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CASE_BASE.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CASE_BASE.SYNC_UID IS '旧数据同步的UID';
COMMENT ON COLUMN BS_CASE_BASE.SYNC_ID IS '数据同步ID';
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_MOTORCADE FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_DRIVER FOREIGN KEY (DRIVER_ID)
      REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_CLOSER FOREIGN KEY (CLOSER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_BASE ADD CONSTRAINT BSFK_CASEBASE_SYNC FOREIGN KEY (SYNC_ID)
      REFERENCES BC_SYNC_BASE (ID);
CREATE INDEX BSIDX_CASE_BASE_DRIVER ON BS_CASE_BASE (DRIVER_CERT);
CREATE INDEX BSIDX_CASE_BASE_CAR ON BS_CASE_BASE (CAR_ID);
            
-- 营运违章
CREATE TABLE BS_CASE_INFRACT_BUSINESS (
   ID                   INTEGER           NOT NULL,
   RECEIVE_DATE         TIMESTAMP,
   RECEIVER_ID        	INTEGER,
   RECEIVER_NAME      	VARCHAR(255),
   DUTY                 VARCHAR(255),
   SORT                 VARCHAR(255),
   EXTENT               VARCHAR(255),
   CERT_KJ_TYPE         VARCHAR(255),
   CERT_KJ              VARCHAR(255),
   CERT_YY              VARCHAR(255),
   DETAIN               VARCHAR(255),
   JEOM                 NUMERIC(3,1),
   PENALTY              NUMERIC(10,2),
   PENALTY2             NUMERIC(10,2),
   AREA                 VARCHAR(255),
   PULL_UNIT            VARCHAR(255),
   OPERATOR             VARCHAR(255),
   OPERATE_UNIT         VARCHAR(255),
   RECEIPT              VARCHAR(255),
   COMMENT_             VARCHAR(4000),
   IS_INVALID           boolean default false,
   IS_SEAL              boolean default false,
   SEAL_DATE            TIMESTAMP,
   IS_DELIVER           boolean default false,
   IS_CLOSE             boolean default false,
   IS_OVERDUE           boolean default false,
   IS_STOP              boolean default false,
   CATEGORY          	INTEGER,
   TRANSACTOR_ID        INTEGER,
   TRANSACTOR_NAME      VARCHAR(255),
   BRANCH_CHARGER_ID  	INTEGER,
   BRANCH_CHARGER_NAME	VARCHAR(255),
   COMPANY_APPROVAL_ID 	INTEGER,
   COMPANY_APPROVAL_NAME VARCHAR(255),
   CONTENT        	VARCHAR(4000),
   STOP_PRODUCTION      VARCHAR(255),
   STUDY        	VARCHAR(255),
   DEDIT        	NUMERIC(10,2),
   DRIVER_RATING        VARCHAR(255),
   CHARGER        	VARCHAR(255),
   CONSTRAINT BSPK_CASE_INFRACT_BUSINESS PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_INFRACT_BUSINESS IS '营运违章';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.RECEIVE_DATE IS '接案日期';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.RECEIVER_ID IS '接案人id';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.RECEIVER_NAME IS '接案人姓名';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.DUTY IS '责任';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.SORT IS '性质';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.EXTENT IS '程度';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CERT_KJ_TYPE IS '没收证件类型';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CERT_KJ IS '扣件证号';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CERT_YY IS '营运证号';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.DETAIN IS '扣留物品';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.JEOM IS '扣分';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.PENALTY IS '罚款';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.PENALTY2 IS '违约金';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.AREA IS '所属区县';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.PULL_UNIT IS '拖车单位';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.OPERATOR IS '执法人';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.OPERATE_UNIT IS '执法机关';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.RECEIPT IS '罚没收据编号';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.COMMENT_ IS '处理意见';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_INVALID IS '是否无效：1-无效';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_SEAL IS '是否盖章：1-盖';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.SEAL_DATE IS '盖章日期';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_DELIVER IS '是否交结案单：1-已交';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_CLOSE IS '是否结案：1-结案';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_OVERDUE IS '是否过期：1-过期';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.IS_STOP IS '是否停场：1-停';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CATEGORY IS '类别:0-营运违章,1-站场违章,2-服务违章';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.TRANSACTOR_ID IS '经办人id';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.TRANSACTOR_NAME IS '经办人姓名';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.BRANCH_CHARGER_ID IS '分公司负责人id';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.BRANCH_CHARGER_NAME IS '分公司负责人姓名';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.COMPANY_APPROVAL_ID IS '公司审批人id';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.COMPANY_APPROVAL_NAME IS '公司审批人姓名';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CONTENT IS '内容';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.STOP_PRODUCTION IS '停产';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.STUDY IS '学习';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.DEDIT IS '违约金';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.DRIVER_RATING IS '驾驶员评级';
COMMENT ON COLUMN BS_CASE_INFRACT_BUSINESS.CHARGER IS '责任人';
ALTER TABLE BS_CASE_INFRACT_BUSINESS ADD CONSTRAINT BSFK_INFRACTB_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
ALTER TABLE BS_CASE_INFRACT_BUSINESS ADD CONSTRAINT BSFK_INFRACTB_RECEIVER FOREIGN KEY (RECEIVER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_INFRACT_BUSINESS ADD CONSTRAINT BSFK_INFRACTB_TRANSACTOR FOREIGN KEY (TRANSACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_INFRACT_BUSINESS ADD CONSTRAINT BSFK_INFRACTB_BRANCH_CHARGER FOREIGN KEY (BRANCH_CHARGER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_INFRACT_BUSINESS ADD CONSTRAINT BSFK_INFRACTB_COMPANY_APPROVAL FOREIGN KEY (COMPANY_APPROVAL_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 交通违章
CREATE TABLE BS_CASE_INFRACT_TRAFFIC (
   ID                   INTEGER           NOT NULL,
   CHARGER        		VARCHAR(255),
   DUTY                 VARCHAR(255),
   SORT                 VARCHAR(255),
   JEOM                 NUMERIC(3,1),
   COMMENT_             VARCHAR(4000),
   IS_DELIVER           boolean default false,
   DELIVER_DATE         TIMESTAMP,
   IS_SIGN              boolean default false,
   SIGN_DATE            TIMESTAMP,
   CONSTRAINT BSPK_CASE_INFRACT_TRAFFIC PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_INFRACT_TRAFFIC IS '交通违章';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.CHARGER IS '责任人';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.DUTY IS '责任';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.SORT IS '性质';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.JEOM IS '扣分';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.COMMENT_ IS '处理意见';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.IS_DELIVER IS '是否邮递：1-是';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.DELIVER_DATE IS '邮递时间';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.IS_SIGN IS '是否签领：1-是';
COMMENT ON COLUMN BS_CASE_INFRACT_TRAFFIC.SIGN_DATE IS '签领时间';
ALTER TABLE BS_CASE_INFRACT_TRAFFIC ADD CONSTRAINT BSFK_INFRACTT_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
      
-- 事故理赔
CREATE TABLE BS_CASE_ACCIDENT (
   ID                   INTEGER           NOT NULL,
   RECEIVE_DATE         TIMESTAMP,
   RECEIVER_ID          INTEGER,
   RECEIVER_NAME        VARCHAR(255),
   RECEIVE_CODE         VARCHAR(255),
   DEPARTMENT           VARCHAR(255),
   CHARGER_ID           INTEGER,
   CHARGER_NAME         VARCHAR(255),
   DUTY                 VARCHAR(255),
   SORT                 VARCHAR(255),
   WEATHER              VARCHAR(255),
   DRIVER_AREA          NUMERIC(1),
   DRIVER_TYPE          NUMERIC(1),
   DRIVER_CLASSES       NUMERIC(1),
   INSURANCE_COMPANY    VARCHAR(255),
   INSURANCE_INFO       VARCHAR(4000),
   IS_DELIVER           boolean default false,
   DELIVER_DATE         TIMESTAMP,
   DELIVER_MONEY        NUMERIC(10,2),
   IS_PAY               boolean default false,
   PAY_DATE             TIMESTAMP,
   PAY_MONEY            NUMERIC(10,2),
   PAY_CODE             VARCHAR(255),
   IS_CLAIM             boolean default false,
   CLAIM_DATE           TIMESTAMP,
   CLAIM_MONEY          NUMERIC(10,2),
   CLAIM_CODE           VARCHAR(255),
   CLAIM_NO1           VARCHAR(255),
   CLAIM_NO2           VARCHAR(255),
   CASUALTIES           VARCHAR(255),
   CAR_HURT             VARCHAR(255),
   THIRD_PARTY          VARCHAR(255),
   IS_ROB               boolean default false,
   HURT_COUNT           NUMERIC(10),
   DEAD_COUNT           NUMERIC(10),
   ACTUAL_LOSS          NUMERIC(10,2),
   IS_INNER_FIX         boolean default false,
   FIX_COST             NUMERIC(10,2),
   COST_DETAIL          VARCHAR(4000),
   CARMAN_COST  		NUMERIC(10,2),
   THIRD_LOSS 			NUMERIC(10,2),
   THIRD_COST 			NUMERIC(10,2),
   AGREEMENT_PAYMENT 	NUMERIC(10,2),
   DESC_ 				VARCHAR(4000),
   ORIGIN 				VARCHAR(200),
   CLAIM_AMOUNT 		NUMERIC(10,2),
   CAR_WOUNDING 		NUMERIC(10,2),
   THIRD_WOUNDING 		NUMERIC(10,2),
   MEDICAL_FEE 			NUMERIC(10,2),
   PAY_DRIVERID 		INTEGER,
   PAY_DRIVER 			VARCHAR(255),
   PAY_DESC 			VARCHAR(255),
   IS_DELIVER_SECOND 	BOOLEAN DEFAULT FALSE,
   IS_DELIVER_TWO 		BOOLEAN DEFAULT FALSE,
   DELIVER_DATE_TWO 	TIMESTAMP,
   DELIVER_MONEY_TWO 	NUMERIC(10,2),
   IS_CLAIM_TWO 		BOOLEAN DEFAULT FALSE,
   CLAIM_DATE_TWO 		TIMESTAMP,
   CLAIM_MONEY_TWO 		NUMERIC(10,2),
   IS_PAY_TWO 			BOOLEAN DEFAULT FALSE,
   PAY_DRIVERID_TWO 	INTEGER,
   PAY_DRIVER_TWO 		VARCHAR(255),
   PAY_DATE_TWO 		TIMESTAMP,
   PAY_MONEY_TWO 		NUMERIC(10,2),
   PAY_DESC_TWO 		VARCHAR(255),
   THIRD_LOSS_INFO 		VARCHAR(255),
   DELAY_DATE 			TIMESTAMP,
   DELAY_DESC 			VARCHAR(255),
   CONSTRAINT BSPK_CASE_ACCIDENT PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_ACCIDENT IS '事故理赔';
COMMENT ON COLUMN BS_CASE_ACCIDENT.RECEIVE_DATE IS '受理时间';
COMMENT ON COLUMN BS_CASE_ACCIDENT.RECEIVER_ID IS '经办人ID';
COMMENT ON COLUMN BS_CASE_ACCIDENT.RECEIVER_NAME IS '经办人姓名';
COMMENT ON COLUMN BS_CASE_ACCIDENT.RECEIVE_CODE IS '受理编号';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DEPARTMENT IS '处理部门';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CHARGER_ID IS '负责人ID';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CHARGER_NAME IS '负责人姓名';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DUTY IS '责任';
COMMENT ON COLUMN BS_CASE_ACCIDENT.SORT IS '性质';
COMMENT ON COLUMN BS_CASE_ACCIDENT.WEATHER IS '天气';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DRIVER_AREA IS '司机区域:0-未定义，1-本市，2-本省，3-外省';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DRIVER_TYPE IS '司机类型：0:未定义,1:车主 ,2:司机,3:非编';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DRIVER_CLASSES IS '驾驶状态：如正班等';
COMMENT ON COLUMN BS_CASE_ACCIDENT.INSURANCE_COMPANY IS '保险公司';
COMMENT ON COLUMN BS_CASE_ACCIDENT.INSURANCE_INFO IS '相关保单';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_DELIVER IS '是否送保：1-是';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELIVER_DATE IS '送保日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELIVER_MONEY IS '送保金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_PAY IS '是否司机受款：1-是';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DATE IS '司机受款日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_MONEY IS '司机受款金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_CODE IS '司机受款收据号';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DESC IS '司机受款说明';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_CLAIM IS '是否保险公司赔付：1-是';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_DATE IS '保险公司赔付日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_MONEY IS '保险公司赔付金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_CODE IS '保险公司赔付收据号';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_NO1 IS '商业险赔付号';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_NO2 IS '交强险赔付号';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CASUALTIES IS '伤亡情况';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CAR_HURT IS '车损情况';
COMMENT ON COLUMN BS_CASE_ACCIDENT.THIRD_PARTY IS '第三者情况';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_ROB IS '是否抢劫：1-是';
COMMENT ON COLUMN BS_CASE_ACCIDENT.HURT_COUNT IS '受伤人数';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DEAD_COUNT IS '死亡人数';
COMMENT ON COLUMN BS_CASE_ACCIDENT.ACTUAL_LOSS IS '实际损失';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_INNER_FIX IS '是否修理厂内修：1-是';
COMMENT ON COLUMN BS_CASE_ACCIDENT.FIX_COST IS '修理厂内修金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.COST_DETAIL IS '损失明细';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CARMAN_COST IS '司机拖车费';
COMMENT ON COLUMN BS_CASE_ACCIDENT.THIRD_LOSS IS '第三者损失';
COMMENT ON COLUMN BS_CASE_ACCIDENT.THIRD_COST IS '第三者拖车费';
COMMENT ON COLUMN BS_CASE_ACCIDENT.AGREEMENT_PAYMENT IS '协议赔付';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DESC_ IS '备注';
COMMENT ON COLUMN BS_CASE_ACCIDENT.ORIGIN IS '籍贯';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_AMOUNT IS '出险金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CAR_WOUNDING IS '自车伤人';
COMMENT ON COLUMN BS_CASE_ACCIDENT.THIRD_WOUNDING IS '第三者伤人';
COMMENT ON COLUMN BS_CASE_ACCIDENT.MEDICAL_FEE IS '第三者医疗费用';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DRIVERID IS '送保的受款司机ID';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DRIVER IS '送保的受款司机';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_DELIVER_SECOND IS '是否第二次送保';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_DELIVER_TWO IS '第二次送保里的送保';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELIVER_DATE_TWO IS '第二次送保里的送保日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELIVER_MONEY_TWO IS '第二次送保里的送保金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_CLAIM_TWO IS '第二次送保里的赔付';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_DATE_TWO IS '第二次送保里的赔付日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.CLAIM_MONEY_TWO IS '第二次送保里的赔付金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.IS_DELIVER_TWO IS '第二次送保里的司机受款';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DRIVERID_TWO IS '第二次送保里的受款司机ID';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DRIVER_TWO IS '第二次送保里的受款司机';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DATE_TWO IS '第二次送保里的司机受款日期';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_MONEY_TWO IS '第二次送保里的司机受款金额';
COMMENT ON COLUMN BS_CASE_ACCIDENT.PAY_DESC_TWO IS '司机二次受款说明';
COMMENT ON COLUMN BS_CASE_ACCIDENT.THIRD_LOSS_INFO IS '第三者损失情况';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELAY_DATE IS '事故延期至日期 ';
COMMENT ON COLUMN BS_CASE_ACCIDENT.DELAY_DESC IS '事故延期说明';
ALTER TABLE BS_CASE_ACCIDENT ADD CONSTRAINT BSFK_ACCIDENT_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
ALTER TABLE BS_CASE_ACCIDENT ADD CONSTRAINT BSFK_ACCIDENT_CHARGER FOREIGN KEY (CHARGER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_ACCIDENT ADD CONSTRAINT BSFK_ACCIDENT_RECEIVER FOREIGN KEY (RECEIVER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
      

-- 投诉与建议
CREATE TABLE BS_CASE_ADVICE (
   ID                   INTEGER           NOT NULL,
   ADVICE_TYPE          INTEGER           NOT NULL,
   RECEIVE_DATE         TIMESTAMP,
   RECEIVE_CODE         VARCHAR(255),
   TRANSACTOR_ID        INTEGER,
   TRANSACTOR_NAME      VARCHAR(255),
   SUBJECT2             VARCHAR(255),
   DETAIL               VARCHAR(4000),
   CAR_COLOR            VARCHAR(255),
   DRIVER_SEX           NUMERIC(1),
   DRIVER_FEATURE       VARCHAR(255),
   ADVISOR_NAME         VARCHAR(255),
   ADVISOR_SEX          INTEGER            NOT NULL,
   ADVISOR_AGE          NUMERIC(3),
   ADVISOR_PHONE        VARCHAR(255),
   ADVISOR_CERT         VARCHAR(255),
   DUTY                 VARCHAR(255),
   EXTENT               VARCHAR(255),
   NOTICE_DATE          TIMESTAMP,
   RESULT_              VARCHAR(4000),
   TICKET               VARCHAR(255),
   MACHINE_PRICE        NUMERIC(10),
   CHARGE               NUMERIC(10),
   RIDING_TIME_START    TIMESTAMP,
   RIDING_TIME_END      TIMESTAMP,
   PATH_FROM            VARCHAR(255),
   PATH_TO              VARCHAR(255),
   PATH                 VARCHAR(255),
   PASSENGER_COUNT_MAN  NUMERIC(1),
   PASSENGER_COUNT_WOMAN NUMERIC(1),
   PASSENGER_COUNT_CHILD NUMERIC(1),
   PASSENGER_COUNT      NUMERIC(1),
   DELIVER_DATE         TIMESTAMP,
   IS_INVALID           boolean default false,
   BRANCH_CHARGER_ID        	INTEGER,
   BRANCH_CHARGER_NAME      	VARCHAR(255),
   COMPANY_APPROVAL_ID        	INTEGER,
   COMPANY_APPROVAL_NAME      	VARCHAR(255),
   STOP_PRODUCTION      		VARCHAR(255),
   STUDY      					VARCHAR(255),
   DEDIT      					NUMERIC(10,2),
   DRIVER_RATING      			VARCHAR(255),
   HANDLER_ID      				INTEGER,
   HANDLER_NAME      			VARCHAR(255),
   HANDLE_STATUS      			INTEGER,
   HANDLE_OPINION      			VARCHAR(255),
   HANDLE_DATE      			TIMESTAMP,
   CHARGER      				VARCHAR(255),
   CONSTRAINT BSPK_CASE_ADVICE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_ADVICE IS '投诉与建议';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVICE_TYPE IS '标识是投诉还是建议:0-投诉,1-建议';
COMMENT ON COLUMN BS_CASE_ADVICE.RECEIVE_DATE IS '接诉时间';
COMMENT ON COLUMN BS_CASE_ADVICE.RECEIVE_CODE IS '受理号';
COMMENT ON COLUMN BS_CASE_ADVICE.TRANSACTOR_ID IS '经办人ID';
COMMENT ON COLUMN BS_CASE_ADVICE.TRANSACTOR_NAME IS '经办人姓名';
COMMENT ON COLUMN BS_CASE_ADVICE.SUBJECT2 IS '投诉项目小类';
COMMENT ON COLUMN BS_CASE_ADVICE.DETAIL IS '投诉内容';
COMMENT ON COLUMN BS_CASE_ADVICE.CAR_COLOR IS '车色';
COMMENT ON COLUMN BS_CASE_ADVICE.DRIVER_SEX IS '司机性别:0-未设,1-男,2-女';
COMMENT ON COLUMN BS_CASE_ADVICE.DRIVER_FEATURE IS '司机特征';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVISOR_NAME IS '投诉人姓名';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVISOR_SEX IS '投诉人性别';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVISOR_AGE IS '投诉人年龄';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVISOR_PHONE IS '投诉人电话';
COMMENT ON COLUMN BS_CASE_ADVICE.ADVISOR_CERT IS '投诉人证件号';
COMMENT ON COLUMN BS_CASE_ADVICE.DUTY IS '责任';
COMMENT ON COLUMN BS_CASE_ADVICE.EXTENT IS '程度';
COMMENT ON COLUMN BS_CASE_ADVICE.NOTICE_DATE IS '通知时间';
COMMENT ON COLUMN BS_CASE_ADVICE.RESULT_ IS '处理结果';
COMMENT ON COLUMN BS_CASE_ADVICE.TICKET IS '车票号码';
COMMENT ON COLUMN BS_CASE_ADVICE.MACHINE_PRICE IS '计费器显示价格';
COMMENT ON COLUMN BS_CASE_ADVICE.CHARGE IS '实际收费';
COMMENT ON COLUMN BS_CASE_ADVICE.RIDING_TIME_START IS '乘车起始时间';
COMMENT ON COLUMN BS_CASE_ADVICE.RIDING_TIME_END IS '乘车结束时间';
COMMENT ON COLUMN BS_CASE_ADVICE.PATH_FROM IS '乘车路线(从)';
COMMENT ON COLUMN BS_CASE_ADVICE.PATH_TO IS '乘车路线(到)';
COMMENT ON COLUMN BS_CASE_ADVICE.PATH IS '乘车路线';
COMMENT ON COLUMN BS_CASE_ADVICE.PASSENGER_COUNT_MAN IS '乘车人数(男)';
COMMENT ON COLUMN BS_CASE_ADVICE.PASSENGER_COUNT_WOMAN IS '乘车人数(女)';
COMMENT ON COLUMN BS_CASE_ADVICE.PASSENGER_COUNT_CHILD IS '乘车人数(童)';
COMMENT ON COLUMN BS_CASE_ADVICE.PASSENGER_COUNT IS '乘车人数';
COMMENT ON COLUMN BS_CASE_ADVICE.DELIVER_DATE IS '结案书交回日期';
COMMENT ON COLUMN BS_CASE_ADVICE.IS_INVALID IS '是否无效：1-无效';
COMMENT ON COLUMN BS_CASE_ADVICE.BRANCH_CHARGER_ID IS '分公司负责人id';
COMMENT ON COLUMN BS_CASE_ADVICE.BRANCH_CHARGER_NAME IS '分公司负责人姓名';
COMMENT ON COLUMN BS_CASE_ADVICE.COMPANY_APPROVAL_ID IS '公司审批人id';
COMMENT ON COLUMN BS_CASE_ADVICE.COMPANY_APPROVAL_NAME IS '公司审批人姓名';
COMMENT ON COLUMN BS_CASE_ADVICE.STOP_PRODUCTION IS '停产';
COMMENT ON COLUMN BS_CASE_ADVICE.STUDY IS '学习';
COMMENT ON COLUMN BS_CASE_ADVICE.DEDIT IS '违约金';
COMMENT ON COLUMN BS_CASE_ADVICE.DRIVER_RATING IS '驾驶员评级';
COMMENT ON COLUMN BS_CASE_ADVICE.HANDLER_ID IS '核准人id';
COMMENT ON COLUMN BS_CASE_ADVICE.HANDLER_NAME IS '核准人姓名';
COMMENT ON COLUMN BS_CASE_ADVICE.HANDLE_STATUS IS '核准状态';
COMMENT ON COLUMN BS_CASE_ADVICE.HANDLE_OPINION IS '核准意见';
COMMENT ON COLUMN BS_CASE_ADVICE.HANDLE_DATE IS '核准时间';
COMMENT ON COLUMN BS_CASE_ADVICE.CHARGER IS '责任人';
ALTER TABLE BS_CASE_ADVICE ADD CONSTRAINT BSFK_ADVICE_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
ALTER TABLE BS_CASE_ADVICE ADD CONSTRAINT BSFK_ADVICE_TRANSACTOR FOREIGN KEY (TRANSACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_ADVICE ADD CONSTRAINT BSFK_ADVICE_BRANCH_CHARGER FOREIGN KEY (BRANCH_CHARGER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_ADVICE ADD CONSTRAINT BSFK_ADVICE_COMPANY_APPROVAL FOREIGN KEY (COMPANY_APPROVAL_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CASE_ADVICE ADD CONSTRAINT BSFK_ADVICE_HANDLER FOREIGN KEY (HANDLER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
      
-- 表扬
CREATE TABLE BS_CASE_PRAISE (
   ID                   INTEGER           NOT NULL,
   PRAISE_TYPE          VARCHAR(255),
   RECEIVE_DATE         TIMESTAMP                 NOT NULL,
   TRANSACTOR_ID          INTEGER,
   TRANSACTOR_NAME        VARCHAR(255),
   SUBJECT2             VARCHAR(255),
   DETAIL               VARCHAR(4000),
   CAR_COLOR            VARCHAR(255),
   DRIVER_SEX           INTEGER            NOT NULL,
   DRIVER_FEATURE       VARCHAR(255),
   ADVISOR_NAME         VARCHAR(255)        NOT NULL,
   ADVISOR_SEX          INTEGER            NOT NULL,
   ADVISOR_AGE          NUMERIC(3),
   ADVISOR_PHONE        VARCHAR(255),
   ADVISOR_CERT         VARCHAR(255),
   NOTICE_DATE          TIMESTAMP,
   RESULT_              VARCHAR(4000),
   TICKET               VARCHAR(255),
   MACHINE_PRICE        NUMERIC(10),
   CHARGE               NUMERIC(10),
   RIDING_TIME_START    TIMESTAMP,
   RIDING_TIME_END      TIMESTAMP,
   PATH_FROM            VARCHAR(255),
   PATH_TO              VARCHAR(255),
   PATH                 VARCHAR(255),
   PASSENGER_COUNT_MAN  NUMERIC(1),
   PASSENGER_COUNT_WOMAN NUMERIC(1),
   PASSENGER_COUNT_CHILD NUMERIC(1),
   PASSENGER_COUNT      NUMERIC(1),
   REWARD_MONEY         NUMERIC(10,2),
   CONSTRAINT BSPK_CASE_PRAISE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_PRAISE IS '表扬';
COMMENT ON COLUMN BS_CASE_PRAISE.PRAISE_TYPE IS '表扬类型';
COMMENT ON COLUMN BS_CASE_PRAISE.RECEIVE_DATE IS '接诉时间';
COMMENT ON COLUMN BS_CASE_PRAISE.TRANSACTOR_ID IS '经办人ID';
COMMENT ON COLUMN BS_CASE_PRAISE.TRANSACTOR_NAME IS '经办人姓名';
COMMENT ON COLUMN BS_CASE_PRAISE.SUBJECT2 IS '表扬项目小类';
COMMENT ON COLUMN BS_CASE_PRAISE.DETAIL IS '表扬内容';
COMMENT ON COLUMN BS_CASE_PRAISE.CAR_COLOR IS '车色';
COMMENT ON COLUMN BS_CASE_PRAISE.DRIVER_SEX IS '司机性别:0-未设,1-男,2-女';
COMMENT ON COLUMN BS_CASE_PRAISE.DRIVER_FEATURE IS '司机特征';
COMMENT ON COLUMN BS_CASE_PRAISE.ADVISOR_NAME IS '投诉人姓名';
COMMENT ON COLUMN BS_CASE_PRAISE.ADVISOR_SEX IS '投诉人性别';
COMMENT ON COLUMN BS_CASE_PRAISE.ADVISOR_AGE IS '投诉人年龄';
COMMENT ON COLUMN BS_CASE_PRAISE.ADVISOR_PHONE IS '投诉人电话';
COMMENT ON COLUMN BS_CASE_PRAISE.ADVISOR_CERT IS '投诉人证件号';
COMMENT ON COLUMN BS_CASE_PRAISE.NOTICE_DATE IS '通知时间';
COMMENT ON COLUMN BS_CASE_PRAISE.RESULT_ IS '处理结果';
COMMENT ON COLUMN BS_CASE_PRAISE.TICKET IS '车票号码';
COMMENT ON COLUMN BS_CASE_PRAISE.MACHINE_PRICE IS '计费器显示价格';
COMMENT ON COLUMN BS_CASE_PRAISE.CHARGE IS '实际收费';
COMMENT ON COLUMN BS_CASE_PRAISE.RIDING_TIME_START IS '乘车起始时间';
COMMENT ON COLUMN BS_CASE_PRAISE.RIDING_TIME_END IS '乘车结束时间';
COMMENT ON COLUMN BS_CASE_PRAISE.PATH_FROM IS '乘车路线(从)';
COMMENT ON COLUMN BS_CASE_PRAISE.PATH_TO IS '乘车路线(到)';
COMMENT ON COLUMN BS_CASE_PRAISE.PATH IS '乘车路线';
COMMENT ON COLUMN BS_CASE_PRAISE.PASSENGER_COUNT_MAN IS '乘车人数(男)';
COMMENT ON COLUMN BS_CASE_PRAISE.PASSENGER_COUNT_WOMAN IS '乘车人数(女)';
COMMENT ON COLUMN BS_CASE_PRAISE.PASSENGER_COUNT_CHILD IS '乘车人数(童)';
COMMENT ON COLUMN BS_CASE_PRAISE.PASSENGER_COUNT IS '乘车人数';
COMMENT ON COLUMN BS_CASE_PRAISE.REWARD_MONEY IS '获奖金额';
ALTER TABLE BS_CASE_PRAISE ADD CONSTRAINT BSFK_PRAISE_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
ALTER TABLE BS_CASE_PRAISE ADD CONSTRAINT BSFK_PRAISE_TRANSACTOR FOREIGN KEY (TRANSACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

-- 工伤
CREATE TABLE BS_INDUSTRIAL_INJURY 
(
   ID                   INTEGER         NOT NULL,
   UID_                 VARCHAR(36)     NOT NULL,
   CONTRACT_ID          INTEGER         NOT NULL,
   STATUS_		INTEGER		NOT NULL,
   CODE                 VARCHAR(255)    NOT NULL,
   HAPPEN_DATE          TIMESTAMP,
   CONFIRM_DATE         TIMESTAMP,
   START_DATE           TIMESTAMP,
   END_DATE             TIMESTAMP,
   COMPENSATION         VARCHAR(255),
   MONEY                NUMERIC(10,2),        
   IS_OAS               BOOLEAN          DEFAULT FALSE,
   IS_IN_HOSPITAL       BOOLEAN          DEFAULT FALSE,
   IS_LI                BOOLEAN          DEFAULT FALSE,
   DESCRIPTION          VARCHAR(4000),
   FILE_DATE            TIMESTAMP        NOT NULL,
   AUTHOR_ID            INTEGER          NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   CONSTRAINT PK_BS_INDUSTRIAL_INJURY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_INDUSTRIAL_INJURY IS '工伤';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.CONTRACT_ID IS '合同ID';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.STATUS_ IS '状态：0-正常,1-已禁用';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.CODE IS '工伤号';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.HAPPEN_DATE IS '工伤时间';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.CONFIRM_DATE IS '认定日期';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.START_DATE IS '医疗开始日期';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.END_DATE IS '医疗结束日期';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.COMPENSATION IS '赔偿项目';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.MONEY IS '金额';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.IS_OAS IS '是否门诊';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.IS_IN_HOSPITAL IS '是否住院';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.IS_LI IS '是否劳动鉴别';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.DESCRIPTION IS '概况描述';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_INDUSTRIAL_INJURY.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_INDUSTRIAL_INJURY ADD CONSTRAINT BSFK_INDUS_REFERENCE_BS_CONTR FOREIGN KEY (CONTRACT_ID)
      REFERENCES BS_CONTRACT_LABOUR (ID);
ALTER TABLE BS_INDUSTRIAL_INJURY ADD CONSTRAINT BSFK_INDUS_REFERENCE_BC_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INDUSTRIAL_INJURY ADD CONSTRAINT BSFK_INDUS_INJURY_BC_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
	  
-- 车辆保单
CREATE TABLE BS_CAR_POLICY (
   ID                   INTEGER           	NOT NULL,
   UID_                 VARCHAR(36)   		NOT NULL,
   VER_MAJOR            NUMERIC(2),
   VER_MINOR            NUMERIC(3),
   PATCH_NO             VARCHAR(255)        NOT NULL,
   MAIN                 INTEGER            	NOT NULL,
   PID                  INTEGER,
   OP_TYPE              INTEGER            	NOT NULL,
   STATUS_              INTEGER            	NOT NULL,
   CAR_ID               INTEGER           	NOT NULL,
   ASSURED              VARCHAR(255),
   COMMERIAL_NO         VARCHAR(255),
   COMMERIAL_COMPANY    VARCHAR(255),
   COMMERIAL_START_DATE TIMESTAMP,
   COMMERIAL_END_DATE   TIMESTAMP,
   OWNRISK              boolean default false,
   GREENSLIP            boolean default false,
   GREENSLIP_SAME_DATE  boolean default false,
   GREENSLIP_NO         VARCHAR(255),
   GREENSLIP_COMPANY    VARCHAR(255),
   GREENSLIP_START_DATE	TIMESTAMP,
   GREENSLIP_END_DATE	TIMESTAMP,
   GREENSLIP_SOURCE     VARCHAR(255),
   LIABILITY_NO         VARCHAR(255),
   STOP_DATE     		TIMESTAMP,
   AMOUNT               NUMERIC(10,2),
   FILE_DATE            TIMESTAMP     		NOT NULL,
   AUTHOR_ID            INTEGER           	NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   LIABILITY_AMOUNT  	NUMERIC(20,2),
   COMMERIAL_AMOUNT  	NUMERIC(20,2),
   GREENSLIP_AMOUNT  	NUMERIC(20,2),
   LOGOUT_ID  			INTEGER,
   LOGOUT_DATE  		TIMESTAMP,
   BUY_PLANT         	VARCHAR(4000),
   CONSTRAINT BSPK_CAR_POLICY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_POLICY IS '车辆保单';
COMMENT ON COLUMN BS_CAR_POLICY.STATUS_ IS '状态：0-正常,1-注销';
COMMENT ON COLUMN BS_CAR_POLICY.VER_MAJOR IS '主版本号';
COMMENT ON COLUMN BS_CAR_POLICY.VER_MINOR IS '次版本号';
COMMENT ON COLUMN BS_CAR_POLICY.PATCH_NO IS '批号';
COMMENT ON COLUMN BS_CAR_POLICY.MAIN IS '主体: 0-当前版本,1-历史版本';
COMMENT ON COLUMN BS_CAR_POLICY.PID IS '父级ID';
COMMENT ON COLUMN BS_CONTRACT.OP_TYPE IS '操作类型: 1-新建,2-维护,3-续保,4-停保';
COMMENT ON COLUMN BS_CAR_POLICY.CAR_ID IS '投保车号';
COMMENT ON COLUMN BS_CAR_POLICY.ASSURED IS '投保人';
COMMENT ON COLUMN BS_CAR_POLICY.COMMERIAL_NO IS '商业险号';
COMMENT ON COLUMN BS_CAR_POLICY.COMMERIAL_COMPANY IS '商业险保险公司';
COMMENT ON COLUMN BS_CAR_POLICY.COMMERIAL_START_DATE IS '商业险开始日期';
COMMENT ON COLUMN BS_CAR_POLICY.COMMERIAL_END_DATE IS '商业险结束日期';
COMMENT ON COLUMN BS_CAR_POLICY.OWNRISK IS '是否自保';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP IS '是否购买了强制险';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_SAME_DATE IS '强制险是否与商业险同期';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_NO IS '强险单号';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_COMPANY IS '强险保险公司';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_START_DATE IS '强制险开始日期';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_END_DATE IS '强制险结束日期';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_SOURCE IS '强保人来源';
COMMENT ON COLUMN BS_CAR_POLICY.LIABILITY_NO IS '责任险单号';
COMMENT ON COLUMN BS_CAR_POLICY.STOP_DATE IS '停保日期';
COMMENT ON COLUMN BS_CAR_POLICY.AMOUNT IS '合计';
COMMENT ON COLUMN BS_CAR_POLICY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_POLICY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_POLICY.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CAR_POLICY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR_POLICY.LIABILITY_AMOUNT IS '责任险合计';
COMMENT ON COLUMN BS_CAR_POLICY.COMMERIAL_AMOUNT IS '商业险合计';
COMMENT ON COLUMN BS_CAR_POLICY.GREENSLIP_AMOUNT IS '强制险合计';
COMMENT ON COLUMN BS_CAR_POLICY.LOGOUT_ID IS '注销人ID';
COMMENT ON COLUMN BS_CAR_POLICY.LOGOUT_DATE IS '注销日期';
COMMENT ON COLUMN BS_CAR_POLICY.BUY_PLANT IS '保单的险种列,字符串格式保存';
ALTER TABLE BS_CAR_POLICY ADD CONSTRAINT BSFK_CARPOLICY_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_POLICY ADD CONSTRAINT BSFK_CARPOLICY_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_POLICY ADD CONSTRAINT BSFK_POLICY_REFERENCE_BS_POLICY FOREIGN KEY (PID)
      REFERENCES BS_CAR_POLICY (ID);
ALTER TABLE BS_CAR_POLICY ADD CONSTRAINT BSFK_CARPOLICY_CAR FOREIGN KEY (CAR_ID )
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_CAR_POLICY ADD CONSTRAINT BSFK_CARPOLICY_LOGOUT FOREIGN KEY (LOGOUT_ID) 
	  REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CAR_POLICY ON BS_CAR_POLICY (CAR_ID);

-- 购买车保险种
CREATE TABLE BS_BUY_PLANT (
   ID                   INTEGER          NOT NULL,
   PID                  INTEGER          NOT NULL,
   ORDER_               INTEGER,
   NAME                 VARCHAR(255)       NOT NULL,
   COVERAGE		        VARCHAR(255),
   DESC_                VARCHAR(4000),
   CONSTRAINT BSPK_BUY_PLANT PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_BUY_PLANT IS '购买车保险种';
COMMENT ON COLUMN BS_BUY_PLANT.PID IS '所属保单ID';
COMMENT ON COLUMN BS_BUY_PLANT.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_BUY_PLANT.NAME IS '险种名称';
COMMENT ON COLUMN BS_BUY_PLANT.COVERAGE IS '保额';
COMMENT ON COLUMN BS_BUY_PLANT.DESC_ IS '备注';
ALTER TABLE BS_BUY_PLANT ADD CONSTRAINT BSFK_BUYPLANT_CARPOLICY FOREIGN KEY (PID)
      REFERENCES BS_CAR_POLICY (ID);
	  
-- 车辆保单险种
CREATE TABLE BS_INSURANCE_TYPE (
   ID                   INTEGER          	NOT NULL,
   PID              	INTEGER,
   STATUS_              INTEGER            	NOT NULL,
   TYPE_              	INTEGER  			DEFAULT 0,
   ORDER_               VARCHAR(255),
   NAME                 VARCHAR(255)       	NOT NULL,
   COVERAGE		        VARCHAR(255),
   DESC_                VARCHAR(4000),
   FILE_DATE            TIMESTAMP         	NOT NULL,
   AUTHOR_ID            INTEGER           	NOT NULL,
   MODIFIER_ID          INTEGER,
   MODIFIED_DATE        TIMESTAMP,
   CONSTRAINT BSPK_INSURANCE_TYPE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_INSURANCE_TYPE IS '车辆保单险种';
COMMENT ON COLUMN BS_INSURANCE_TYPE.PID IS '所属模板的ID';
COMMENT ON COLUMN BS_INSURANCE_TYPE.STATUS_ IS '状态：0-正常,1-禁用';
COMMENT ON COLUMN BS_INSURANCE_TYPE.TYPE_ IS '险种类型 0-险种，1-模板';
COMMENT ON COLUMN BS_INSURANCE_TYPE.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_INSURANCE_TYPE.NAME IS '险种名称';
COMMENT ON COLUMN BS_INSURANCE_TYPE.COVERAGE IS '保额';
COMMENT ON COLUMN BS_INSURANCE_TYPE.DESC_ IS '备注';
COMMENT ON COLUMN BS_INSURANCE_TYPE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_INSURANCE_TYPE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_INSURANCE_TYPE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_INSURANCE_TYPE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_INSURANCE_TYPE ADD CONSTRAINT BSFK_INSURANCETYPE_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INSURANCE_TYPE ADD CONSTRAINT BSFK_INSURANCETYPE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INSURANCE_TYPE ADD CONSTRAINT BSFK_INSURANCETYPE_PID FOREIGN KEY (PID)
			REFERENCES BS_INSURANCE_TYPE (ID);
			
-- 从交委WebService接口同步的交通违章信息
CREATE TABLE BS_SYNC_JIAOWEI_JTWF (
    ID INTEGER NOT NULL,
    UNIT_NAME VARCHAR(255),
    MOTORCADE_NAME VARCHAR(255),
    HAPPEN_DATE TIMESTAMP NOT NULL,
    CAR_PLATE_TYPE VARCHAR(100) NOT NULL,
    CAR_PLATE_NO VARCHAR(100) NOT NULL,
    DRIVER_CERT VARCHAR(255),
    DRIVER_NAME VARCHAR(255),
    JEOM NUMERIC(10,1) NOT NULL,
    COMPANY_NAME VARCHAR(255),
    CONTENT VARCHAR(4000) NOT NULL,
    CONSTRAINT BSPK_SYNC_JIAOWEI_JTWF PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SYNC_JIAOWEI_JTWF IS '交委WebService接口的交通违章信息';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.UNIT_NAME IS '分公司';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.MOTORCADE_NAME IS '所属车队';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.HAPPEN_DATE IS '违章时间';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.CONTENT IS '违章内容';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.CAR_PLATE_TYPE IS '车牌类型';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.CAR_PLATE_NO IS '车牌号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.DRIVER_NAME IS '当事司机姓名';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.DRIVER_CERT IS '服务资格证';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.JEOM IS '本次扣分';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_JTWF.COMPANY_NAME IS '单位名称';
ALTER TABLE BS_SYNC_JIAOWEI_JTWF ADD CONSTRAINT BSFK_JIAOWEIJTWF2BASE FOREIGN KEY (ID)
      REFERENCES BC_SYNC_BASE (ID);
CREATE INDEX BCIDX_JIAOWEIJTWF_DRIVER_CERT ON BS_SYNC_JIAOWEI_JTWF (DRIVER_CERT);
CREATE INDEX BCIDX_JIAOWEIJTWF_CAR_PLATE ON BS_SYNC_JIAOWEI_JTWF (CAR_PLATE_TYPE,CAR_PLATE_NO);

-- 从交委WebService接口同步的营运违章信息
CREATE TABLE BS_SYNC_JIAOWEI_YYWZ (
    ID					INTEGER NOT NULL,
    C_ID				VARCHAR(255) NOT NULL,
    UNIT_NAME 			VARCHAR(255),
    MOTORCADE_NAME 		VARCHAR(255),
    STATUS				VARCHAR(100),
    CERT_KJ				VARCHAR(255),
    OPERATOR			VARCHAR(255),
    OPERATE_UNIT        VARCHAR(255),
    VIDEO_OPERATER      VARCHAR(255),
    DRIVER_NAME			VARCHAR(255),
    IDCARD_TYPE         VARCHAR(255),
    IDCARD_CODE         VARCHAR(255),
    CAR_PLATE			VARCHAR(255),
    COMPANY				VARCHAR(255),
    ADDRESS             VARCHAR(1000),
    OWNER               VARCHAR(255),
    OWNER_ID            VARCHAR(100),
    BS_CERT_NO          VARCHAR(255),
    CONTENT				VARCHAR(4000) NOT NULL,
    HAPPEN_DATE         TIMESTAMP NOT NULL,
    EVIDENCE_UNIT       VARCHAR(255),
    WZ_TYPE				VARCHAR(255),
    BUSLINES			VARCHAR(255),
    CARPLATE_COLOR		VARCHAR(100),
    DRIVER_CERT			VARCHAR(255),
    COMMIT_STATUS		VARCHAR(255),
    RECEIPT             VARCHAR(255),
    NOTICE				VARCHAR(255),
    CERT_YY             VARCHAR(255),
    SEATING				NUMERIC(10,1),
    OWE_RECORD          VARCHAR(255),
    OWE_SIGNATURE		VARCHAR(255),
    LEAVE_TROOPS		VARCHAR(255),
    AREA                VARCHAR(255),
    CLOSE_DATE          TIMESTAMP,
    DESC_               VARCHAR(4000),
    CLONE               VARCHAR(4000),
    SUBJECT             VARCHAR(1000),
    DETAIN              VARCHAR(255),
    PULL_UNIT           VARCHAR(255),
    PENALTY             NUMERIC(10,2),
    CONSTRAINT BSPK_SYNC_JIAOWEI_YYWZ PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SYNC_JIAOWEI_YYWZ IS '交委WebService接口的营运违章信息';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.UNIT_NAME IS '分公司';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.MOTORCADE_NAME IS '所属车队';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.STATUS IS '状态';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CERT_KJ IS '扣件证号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OPERATOR IS '执法人';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OPERATE_UNIT IS '执法分队';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.VIDEO_OPERATER IS '摄录员';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.DRIVER_NAME IS '当事人';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.IDCARD_TYPE IS '身份证明类型';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.IDCARD_CODE IS '身份证明编号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CAR_PLATE IS '违章主体';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.COMPANY IS '违章企业';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.ADDRESS IS '违章地段';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OWNER IS '业户名称';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OWNER_ID IS '业户ID';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.BS_CERT_NO IS '经营许可证号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CONTENT IS '违章内容';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.EVIDENCE_UNIT IS '证物保存单位';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.WZ_TYPE IS '违章类型';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.BUSLINES IS '公交线路';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CARPLATE_COLOR IS '车牌颜色';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.DRIVER_CERT IS '资格证号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.COMMIT_STATUS IS '提交状态';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.RECEIPT IS '罚没收据编号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.NOTICE IS '放行通知书编号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CERT_YY IS '营运证号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.SEATING IS '座位数';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OWE_RECORD IS '欠笔录';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.OWE_SIGNATURE IS '欠签名';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.LEAVE_TROOPS IS '留队部';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.AREA IS '所属区县';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CLOSE_DATE IS '结案日期';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.DESC_ IS '备注';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.CLONE IS '是否克隆车';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.SUBJECT IS '违章项目';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.DETAIN IS '扣留物品';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.PULL_UNIT IS '拖车单位';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_YYWZ.PENALTY IS '罚款';
ALTER TABLE BS_SYNC_JIAOWEI_YYWZ ADD CONSTRAINT BSFK_JIAOWEIYYWZBASE FOREIGN KEY (ID)
      REFERENCES BC_SYNC_BASE (ID);
CREATE INDEX BCIDX_JIAOWEIYYWZ_DRIVER_CERT ON BS_SYNC_JIAOWEI_YYWZ (DRIVER_CERT);


-- 从交委WebService接口同步的投诉与建议信息
CREATE TABLE BS_SYNC_JIAOWEI_ADVICE (
    ID					INTEGER NOT NULL,
    C_ID				VARCHAR(255) NOT NULL,
    UNIT_NAME 			VARCHAR(255),
    MOTORCADE_NAME 		VARCHAR(255),
    RECEIVE_CODE        VARCHAR(255),
    ADVISOR_NAME        VARCHAR(255) NOT NULL,
    PATH_FROM           VARCHAR(255),
    PATH_TO             VARCHAR(255),
    RIDING_TIME_START   TIMESTAMP,
    RIDING_TIME_END     TIMESTAMP,
    ADVISOR_SEX         VARCHAR(100),
    ADVISOR_AGE         NUMERIC(3,0),
    ADVISOR_PHONE       VARCHAR(255),
    ADVISOR_CERT        VARCHAR(255),
    OLD_UNIT_NAME       VARCHAR(255),
    CAR_PLATE			VARCHAR(255),
    DRIVER_CERT			VARCHAR(255),
    DRIVER_CHAR         VARCHAR(255),
    CONTENT				VARCHAR(4000) NOT NULL,
    RECEIVE_DATE        TIMESTAMP,
    RESULT_             VARCHAR(4000),
    ADVICE_TYPE			VARCHAR(255),
    ADVICE_BS			VARCHAR(255),
    SUBJECT             VARCHAR(255),
    SUBJECT2            VARCHAR(255),
    MACHINE_PRICE       VARCHAR(255),
    TICKET              VARCHAR(255),
    CHARGE              VARCHAR(255),
    DRIVER_SEX          VARCHAR(10),
    SUGGEST_BS			VARCHAR(255),
    BUSLINES            VARCHAR(255),
    BUS_COLOR			VARCHAR(255),
    REPLY				VARCHAR(255),
    CONSTRAINT BSPK_SYNC_JIAOWEI_ADVICE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SYNC_JIAOWEI_ADVICE IS '交委WebService接口的投诉与建议信息';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.UNIT_NAME IS '分公司';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.MOTORCADE_NAME IS '所属车队';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.RECEIVE_CODE IS '电话受理号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVISOR_NAME IS '投诉人姓名';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.PATH_FROM IS '乘车路线(从)';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.PATH_TO IS '乘车路线(到)';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.RIDING_TIME_START IS '乘车起始时间';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.RIDING_TIME_END IS '乘车结束时间';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVISOR_SEX IS '投诉人性别';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVISOR_AGE IS '投诉人年龄';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVISOR_PHONE IS '投诉人电话';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVISOR_CERT IS '投诉人证件号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.OLD_UNIT_NAME IS '车属单位';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.CAR_PLATE IS '车牌号码';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.DRIVER_CERT IS '资格证号';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.DRIVER_CHAR IS '司机特征';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.CONTENT IS '投诉内容';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.RECEIVE_DATE IS '受理时间';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.RESULT_ IS '处理结果';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVICE_TYPE IS '投诉或建议';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.ADVICE_BS IS '投诉行业';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.SUBJECT IS '投诉项目大类';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.SUBJECT2 IS '投诉项目小类';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.MACHINE_PRICE IS '计费器显示价格';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.TICKET IS '车票号码';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.CHARGE IS '实际收费';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.DRIVER_SEX IS '司机性别';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.SUGGEST_BS IS '建议行业';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.BUSLINES IS '公交线路或站场';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.BUS_COLOR IS '颜色';
COMMENT ON COLUMN BS_SYNC_JIAOWEI_ADVICE.REPLY IS '是否回复';
ALTER TABLE BS_SYNC_JIAOWEI_ADVICE ADD CONSTRAINT BSFK_JIAOWEIADVICEBASE FOREIGN KEY (ID)
      REFERENCES BC_SYNC_BASE (ID);
CREATE INDEX BCIDX_JIAOWEIADVICE_DRIVER_CERT ON BS_SYNC_JIAOWEI_ADVICE (DRIVER_CERT);

-- 从金盾网抓取的交通违法信息
CREATE TABLE BS_SYNC_JINDUN_JTWF (
    ID INTEGER NOT NULL,
    UNIT_NAME VARCHAR(255),
    MOTORCADE_NAME VARCHAR(255),
    CAR_TYPE VARCHAR(10) NOT NULL,
    CAR_TYPE_DESC VARCHAR(100) NOT NULL,
    CAR_PLATE_TYPE VARCHAR(100) NOT NULL,
    CAR_PLATE_NO VARCHAR(100) NOT NULL,
    ENGINE_NO VARCHAR(255),
    HAPPEN_DATE TIMESTAMP NOT NULL,
    ADDRESS VARCHAR(1000),
    DRIVER_NAME VARCHAR(255),
    JEOM NUMERIC(10,1) NOT NULL,
    PENALTY NUMERIC(10,1) NOT NULL,
    OVERDUE_PAYMENT NUMERIC(10,1) NOT NULL,
    DECISION_NO VARCHAR(255),
    DECISION_TYPE VARCHAR(255),
    SOURCE VARCHAR(255),
    TRAFFIC VARCHAR(255),
    BREAK_TYPE VARCHAR(255),
    CONSTRAINT BSPK_SYNC_JINDUN_JTWF PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SYNC_JINDUN_JTWF IS '从金盾网抓取的交通违法信息';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.UNIT_NAME IS '分公司';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.MOTORCADE_NAME IS '所属车队';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.HAPPEN_DATE IS '违法时间';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.CAR_TYPE IS '号牌种类';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.CAR_TYPE_DESC IS '号牌种类的中文描述';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.CAR_PLATE_TYPE IS '车牌类型';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.CAR_PLATE_NO IS '车牌号';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.ENGINE_NO IS '发动机号';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.DRIVER_NAME IS '当事人';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.JEOM IS '违法记分数';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.ADDRESS IS '违法地点';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.DECISION_NO IS '决定书编号';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.DECISION_TYPE IS '决定书类别';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.SOURCE IS '违法来源';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.PENALTY IS '罚款金额';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.OVERDUE_PAYMENT IS '滞纳金';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.TRAFFIC IS '交通方式';
COMMENT ON COLUMN BS_SYNC_JINDUN_JTWF.BREAK_TYPE IS '违法行为';
ALTER TABLE BS_SYNC_JINDUN_JTWF ADD CONSTRAINT BSFK_JINDUNJTWF2BASE FOREIGN KEY (ID)
      REFERENCES BC_SYNC_BASE (ID);
CREATE INDEX BCIDX_JINDUNJTWF_CAR ON BS_SYNC_JINDUN_JTWF (CAR_PLATE_TYPE,CAR_PLATE_NO);

-- 证照遗失管理
CREATE TABLE BS_CERT_LOST(
   ID                   INTEGER           	NOT NULL,
   CAR_ID             	INTEGER,
   MOTORCADE_ID       	INTEGER,
   DRIVER_ID       		INTEGER,
   DRIVER				VARCHAR(255),
   SUBJECT              VARCHAR(255),
   LOST_DATE            TIMESTAMP,
   TRANSACTOR_ID        INTEGER,
   TRANSACTOR_NAME      VARCHAR(255),
   DESC_                VARCHAR(4000),
   FILE_DATE            TIMESTAMP     		NOT NULL,
   AUTHOR_ID            INTEGER           	NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   CONSTRAINT BSPK_CERT_LOST PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CERT_LOST IS '证照遗失管理';
COMMENT ON COLUMN BS_CERT_LOST.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CERT_LOST.MOTORCADE_ID IS '车队ID';
COMMENT ON COLUMN BS_CERT_LOST.DRIVER_ID IS '司机ID';
COMMENT ON COLUMN BS_CERT_LOST.DRIVER IS '司机';
COMMENT ON COLUMN BS_CERT_LOST.SUBJECT IS '标题';
COMMENT ON COLUMN BS_CERT_LOST.LOST_DATE IS '遗失日期';
COMMENT ON COLUMN BS_CERT_LOST.TRANSACTOR_ID IS '经办人ID';
COMMENT ON COLUMN BS_CERT_LOST.TRANSACTOR_NAME IS '经办人';
COMMENT ON COLUMN BS_CERT_LOST.DESC_ IS '备注';
COMMENT ON COLUMN BS_CERT_LOST.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CERT_LOST.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CERT_LOST.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CERT_LOST.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_CERT_LOST ADD CONSTRAINT BSFK_PAPERLOST_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CERT_LOST ADD CONSTRAINT BSFK_PAPERLOST_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CERT_LOST ADD CONSTRAINT BSFK_PAPERLOST_TRANSACTOR FOREIGN KEY (TRANSACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CERT_LOST ADD CONSTRAINT BSFK_PAPERLOST_CAR FOREIGN KEY (CAR_ID )
      REFERENCES BS_CAR (ID);
CREATE INDEX BSIDX_PAPER_LOST ON BS_CERT_LOST (CAR_ID);

-- 遗失的证照
CREATE TABLE BS_CERT_LOST_ITEM(
   ID                   INTEGER          NOT NULL,
   PID                  INTEGER          NOT NULL,
   CERT_NAME           	VARCHAR(255)       NOT NULL,
   IS_REPLACE           BOOLEAN            DEFAULT FALSE,
   REPLACE_DATE         TIMESTAMP,
   REASON          		VARCHAR(255)       NOT NULL,
   LOST_ADDRESS			VARCHAR(4000),
   CERT_NO		        VARCHAR(255),
   NEW_CERT_NO		    VARCHAR(255),
   IS_REMAINS           BOOLEAN            DEFAULT FALSE,
   ALARMUNIT 			VARCHAR(4000),
   DESC_                VARCHAR(4000),
   CONSTRAINT BSPK_PAPER_LOST_ITEM PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CERT_LOST_ITEM IS '遗失的证照';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.PID IS '所属证照遗失管理表ID';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.CERT_NAME IS '证照名称';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.IS_REPLACE IS '是否补办';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.REPLACE_DATE IS '补办日期';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.REASON IS '补办原因';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.LOST_ADDRESS IS '遗失地点';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.CERT_NO IS '证件号码';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.NEW_CERT_NO IS '新证件号码';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.IS_REMAINS IS '是否有残骸';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.ALARMUNIT IS '报警单位';
COMMENT ON COLUMN BS_CERT_LOST_ITEM.DESC_ IS '备注';
ALTER TABLE BS_CERT_LOST_ITEM ADD CONSTRAINT BSFK_LOSTITEM_BASE FOREIGN KEY (PID)
      REFERENCES BS_CERT_LOST (ID);							

-- LPG配置模块
CREATE TABLE BS_CAR_LPGMODEL(
	ID  INTEGER  NOT NULL,
	STATUS_ INTEGER NOT NULL,
	ORDER_ 	VARCHAR(100),
	NAME_	VARCHAR(255) NOT NULL,
	FULL_NAME VARCHAR(255),
	MODEL VARCHAR(255),
	GP_MODEL VARCHAR(255),
	JCF_MODEL VARCHAR(255),
	QHQ_MODEL VARCHAR(255),
	PSQ_MODEL VARCHAR(255),
	DESC_ VARCHAR(4000),
	FILE_DATE            TIMESTAMP	NOT NULL,
	AUTHOR_ID            INTEGER		NOT NULL,
	MODIFIER_ID          INTEGER,
	MODIFIED_DATE        TIMESTAMP,
	CONSTRAINT BSPK_CAR_LPGMODEL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_LPGMODEL IS 'LPG配置';
COMMENT ON COLUMN BS_CAR_LPGMODEL.STATUS_ IS '状态：0-在案,1-注销';
COMMENT ON COLUMN BS_CAR_LPGMODEL.NAME_ IS '名称，如：兰天达';
COMMENT ON COLUMN BS_CAR_LPGMODEL.FULL_NAME IS '专用装置供应商，如:北京兰天达';
COMMENT ON COLUMN BS_CAR_LPGMODEL.MODEL IS '专用装置品牌型号';
COMMENT ON COLUMN BS_CAR_LPGMODEL.GP_MODEL IS '钢瓶品牌型号';
COMMENT ON COLUMN BS_CAR_LPGMODEL.JCF_MODEL IS '集成阀品牌型号';
COMMENT ON COLUMN BS_CAR_LPGMODEL.QHQ_MODEL IS '汽化器品牌型号';
COMMENT ON COLUMN BS_CAR_LPGMODEL.PSQ_MODEL IS '混合/喷射器品牌型号';
COMMENT ON COLUMN BS_CAR_LPGMODEL.DESC_ IS '描述';
COMMENT ON COLUMN BS_CAR_LPGMODEL.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_LPGMODEL.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_LPGMODEL.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_CAR_LPGMODEL.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_CAR_LPGMODEL ADD CONSTRAINT BSFK_CAR_LPGMODEL_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_LPGMODEL ADD CONSTRAINT BSFK_CAR_LPGMODEL_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_CAR_LPGMODEL_STATUS ON BS_CAR_LPGMODEL (STATUS_);


-- 发票管理
-- 发票采购单
CREATE TABLE BS_INVOICE_BUY (
   ID                   INTEGER           	NOT NULL,
   STATUS_              NUMERIC(1)			NOT NULL,
   COMPANY              VARCHAR(255)		NOT NULL,
   CODE                 VARCHAR(255)		NOT NULL,
   TYPE_                NUMERIC(1)			NOT NULL,
   START_NO             VARCHAR(255)		NOT NULL,
   END_NO               VARCHAR(255)		NOT NULL,
   COUNT_               INTEGER           	NOT NULL,
   EACH_COUNT			INTEGER				NOT NULL,
   UNIT_                INTEGER            	NOT NULL,
   BUY_PRICE            NUMERIC(10,2)		NOT NULL,
   SELL_PRICE           NUMERIC(10,2)		NOT NULL,
   BUYER_ID             INTEGER,
   BUY_DATE             TIMESTAMP			NOT NULL,
   PATCH_NO             VARCHAR(255),
   PROJECT_NO           VARCHAR(255),
   FILE_DATE            TIMESTAMP			NOT NULL,
   AUTHOR_ID            INTEGER           	NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   DESC_                VARCHAR(4000),
   CONSTRAINT BSPK_INVOICE_BUY PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_INVOICE_BUY IS '发票采购单';
COMMENT ON COLUMN BS_INVOICE_BUY.STATUS_ IS '状态:0-正常,1-作废';
COMMENT ON COLUMN BS_INVOICE_BUY.COMPANY IS '公司';
COMMENT ON COLUMN BS_INVOICE_BUY.CODE IS '发票代码';
COMMENT ON COLUMN BS_INVOICE_BUY.TYPE_ IS '发票类型:1-打印票,2-手撕票';
COMMENT ON COLUMN BS_INVOICE_BUY.START_NO IS '开始号';
COMMENT ON COLUMN BS_INVOICE_BUY.END_NO IS '结束号';
COMMENT ON COLUMN BS_INVOICE_BUY.COUNT_ IS '采购数量';
COMMENT ON COLUMN BS_INVOICE_BUY.EACH_COUNT IS '每(卷/本)数量';
COMMENT ON COLUMN BS_INVOICE_BUY.UNIT_ IS '单位:1-卷,2-本;每卷100张';
COMMENT ON COLUMN BS_INVOICE_BUY.BUY_PRICE IS '采购单价';
COMMENT ON COLUMN BS_INVOICE_BUY.SELL_PRICE IS '销售单价';
COMMENT ON COLUMN BS_INVOICE_BUY.BUYER_ID IS '采购人ID';
COMMENT ON COLUMN BS_INVOICE_BUY.BUY_DATE IS '采购日期';
COMMENT ON COLUMN BS_INVOICE_BUY.PATCH_NO IS '批号';
COMMENT ON COLUMN BS_INVOICE_BUY.PROJECT_NO IS '工程单号';
COMMENT ON COLUMN BS_INVOICE_BUY.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_INVOICE_BUY.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_INVOICE_BUY.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_INVOICE_BUY.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_INVOICE_BUY.DESC_ IS '备注';
ALTER TABLE BS_INVOICE_BUY ADD CONSTRAINT BSFK_INVOICEBUY_BUYER FOREIGN KEY (BUYER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INVOICE_BUY ADD CONSTRAINT BSFK_INVOICEBUY_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INVOICE_BUY ADD CONSTRAINT BSFK_INVOICEBUY_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_INVOICEBUY_COMPANY ON BS_INVOICE_BUY (COMPANY);
CREATE INDEX BSIDX_INVOICEBUY_STARTNO ON BS_INVOICE_BUY (START_NO);
CREATE INDEX BSIDX_INVOICEBUY_ENDNO ON BS_INVOICE_BUY (END_NO);

-- 发票销售单
CREATE TABLE BS_INVOICE_SELL (
   ID                   INTEGER          	NOT NULL,
   STATUS_              NUMERIC(1)      	NOT NULL,
   TYPE_              	NUMERIC(1)      	NOT NULL,
   BUYER_ID             INTEGER,
   BUYER_NAME           VARCHAR(255),
   CAR_ID               INTEGER          	NOT NULL,
   CAR_PLATE            VARCHAR(255)		NOT NULL,
   MOTORCADE_ID        	INTEGER           	NOT NULL,
   COMPANY              VARCHAR(255)		NOT NULL,
   SELL_DATE            TIMESTAMP      		NOT NULL,
   CASHIER_ID           INTEGER           	NOT NULL,
   PAY_TYPE             NUMERIC(1)      	NOT NULL,
   BANK_CODE            VARCHAR(255),
   DESC_                VARCHAR(4000),
   FILE_DATE            TIMESTAMP      		NOT NULL,
   AUTHOR_ID           	INTEGER          	NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   CONSTRAINT BSPK_INVOICE_SELL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_INVOICE_SELL IS '发票销售单';
COMMENT ON COLUMN BS_INVOICE_SELL.STATUS_ IS '状态:0-正常,1-作废';
COMMENT ON COLUMN BS_INVOICE_SELL.TYPE_ IS '类型：1-已销，2-退票';
COMMENT ON COLUMN BS_INVOICE_SELL.BUYER_ID IS '购买人ID';
COMMENT ON COLUMN BS_INVOICE_SELL.BUYER_NAME IS '购买人姓名';
COMMENT ON COLUMN BS_INVOICE_SELL.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_INVOICE_SELL.CAR_PLATE IS '车牌';
COMMENT ON COLUMN BS_INVOICE_SELL.MOTORCADE_ID IS '车队ID';
COMMENT ON COLUMN BS_INVOICE_SELL.COMPANY IS '公司';
COMMENT ON COLUMN BS_INVOICE_SELL.SELL_DATE IS '销售日期';
COMMENT ON COLUMN BS_INVOICE_SELL.CASHIER_ID IS '收银员ID';
COMMENT ON COLUMN BS_INVOICE_SELL.PAY_TYPE IS '收款方式';
COMMENT ON COLUMN BS_INVOICE_SELL.BANK_CODE IS '银行流水号';
COMMENT ON COLUMN BS_INVOICE_SELL.DESC_ IS '备注';
COMMENT ON COLUMN BS_INVOICE_SELL.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_INVOICE_SELL.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_INVOICE_SELL.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_INVOICE_SELL.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_BUYER FOREIGN KEY (BUYER_ID)
      REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_MOTORCADE FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_CASHIER FOREIGN KEY (CASHIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_INVOICE_SELL ADD CONSTRAINT BSFK_INVOICESELL_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
CREATE INDEX BSIDX_INVOICESELL_COMPANY ON BS_INVOICE_SELL (COMPANY);
CREATE INDEX BSIDX_INVOICESELL_BUYER ON BS_INVOICE_SELL (BUYER_ID);
CREATE INDEX BSIDX_INVOICESELL_CAR ON BS_INVOICE_SELL (CAR_ID);
CREATE INDEX BSIDX_INVOICESELL_MOTORCADE ON BS_INVOICE_SELL (MOTORCADE_ID);

-- 发票销售明细
CREATE TABLE BS_INVOICE_SELL_DETAIL (
   ID                   INTEGER          	NOT NULL,
   STATUS_ 				numeric(1,0) DEFAULT 0 NOT NULL,
   TYPE_              	NUMERIC(1)      	NOT NULL,
   SELL_ID              INTEGER          	NOT NULL,
   BUY_ID               INTEGER          	NOT NULL,
   COUNT_               INTEGER          	NOT NULL,
   PRICE                NUMERIC(10,2)    	NOT NULL,
   START_NO             VARCHAR(255) 		NOT NULL,
   END_NO               VARCHAR(255)  		NOT NULL,
   CONSTRAINT BSPK_INVOICE_SELL_DETAIL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_INVOICE_SELL_DETAIL IS '发票销售明细';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.STATUS_ IS '状态:0-正常,1-作废;要保证与所属销售单的状态相等';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.TYPE_ IS '类型：1-已销，2-退票';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.SELL_ID IS '所属销售单ID';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.BUY_ID IS '对应采购单ID';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.COUNT_ IS '销售数量';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.PRICE IS '销售单价';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.START_NO IS '开始号';
COMMENT ON COLUMN BS_INVOICE_SELL_DETAIL.END_NO IS '结束号';
ALTER TABLE BS_INVOICE_SELL_DETAIL ADD CONSTRAINT BSFK_INVOICESELLDETAIL_BUY FOREIGN KEY (BUY_ID)
      REFERENCES BS_INVOICE_BUY (ID);
ALTER TABLE BS_INVOICE_SELL_DETAIL ADD CONSTRAINT BSFK_INVOICESELLDETAIL_SELL FOREIGN KEY (SELL_ID)
      REFERENCES BS_INVOICE_SELL (ID); 
CREATE INDEX BSIDX_INVOICESELLDETAIL_STARTNO ON BS_INVOICE_SELL_DETAIL (START_NO);
CREATE INDEX BSIDX_INVOICESELLDETAIL_ENDNO ON BS_INVOICE_SELL_DETAIL (END_NO);
CREATE INDEX BSIDX_INVOICESELLDETAIL_BUYID ON BS_INVOICE_SELL_DETAIL (BUY_ID);

-- 经营权管理
CREATE TABLE BS_CAR_OWNERSHIP(
   ID                   INTEGER           	NOT NULL, 
   CAR_ID               INTEGER           	NOT NULL,
   NATURE       	VARCHAR(255),
   SITUATION       	VARCHAR(255),
   OWNER_		VARCHAR(255),
   DESC_                VARCHAR(4000),
   FILE_DATE            TIMESTAMP     		NOT NULL,
   AUTHOR_ID            INTEGER           	NOT NULL,
   MODIFIED_DATE        TIMESTAMP,
   MODIFIER_ID          INTEGER,
   CONSTRAINT BSPK_CAR_OWNERSHIP PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CAR_OWNERSHIP IS '经营权管理';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.NATURE IS '经营权性质';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.SITUATION IS '经营权情况';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.OWNER_ IS '车辆产权';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.DESC_ IS '备注';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_CAR_OWNERSHIP.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_CAR_OWNERSHIP ADD CONSTRAINT BSFK_OWNERSHIP_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_OWNERSHIP ADD CONSTRAINT BSFK_OWNERSHIP_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_CAR_OWNERSHIP ADD CONSTRAINT BSFK_OWNERSHIP_CAR FOREIGN KEY (CAR_ID )
      REFERENCES BS_CAR (ID);
CREATE INDEX BSIDX_CAR_OWNERSHIP ON BS_CAR_OWNERSHIP (ID);

-- 报失
CREATE TABLE BS_CASE_LOST (
   ID                   INTEGER           NOT NULL,
   RECEIVE_DATE         TIMESTAMP,
   OWNER_NAME           VARCHAR(255), 
   OWNER_SEX            NUMERIC(1),
   OWNER_TEL		VARCHAR(255),
   OWNER_UNIT		VARCHAR(255),
   PATH                 VARCHAR(255),
   PASSENGER_COUNT      NUMERIC(1),
   DRIVER_SEX           NUMERIC(1),
   DRIVER_FEATURE       VARCHAR(255),
   TICKET               VARCHAR(255),
   MACHINE_PRICE        NUMERIC(10),
   CHARGE               NUMERIC(10),
   DESC2		VARCHAR(4000),
   MONEY		NUMERIC(10,2),
   ITEMS		VARCHAR(255),
   SITE_POSTION		INTEGER,
   LEVEL		INTEGER,
   IS_TOOK              BOOLEAN            DEFAULT FALSE,
   TOOK_DATE		TIMESTAMP,
   TAKER_NAME		VARCHAR(255),
   TAKER_AGE    INTEGER,
   TAKER_UNIT		VARCHAR(255),
   TAKER_TEL		VARCHAR(255),
   TAKER_SEX            NUMERIC(1),
   TAKER_IDENTITY       VARCHAR(255),
   RESULT_		INTEGER,
   RETRUN_DATE		TIMESTAMP,
   REPLY_DATE		TIMESTAMP,
   HANDLE_RESULT      	INTEGER,
   TRANSACTOR_ID        INTEGER,
   TRANSACTOR_NAME      VARCHAR(255),
   CONSTRAINT BSPK_CASE_LOST PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CASE_LOST IS '报失';
COMMENT ON COLUMN BS_CASE_LOST.RECEIVE_DATE IS '接报失时间';
COMMENT ON COLUMN BS_CASE_LOST.OWNER_NAME IS '报失人';
COMMENT ON COLUMN BS_CASE_LOST.OWNER_SEX IS '报失人性别:0-未设,1-男,2-女';
COMMENT ON COLUMN BS_CASE_LOST.OWNER_TEL IS '报失人号码';
COMMENT ON COLUMN BS_CASE_LOST.OWNER_UNIT IS '报失人单位';
COMMENT ON COLUMN BS_CASE_LOST.PATH IS '乘车路线';
COMMENT ON COLUMN BS_CASE_LOST.PASSENGER_COUNT IS '乘车人数';
COMMENT ON COLUMN BS_CASE_LOST.DRIVER_SEX IS '司机性别:0-未设,1-男,2-女';
COMMENT ON COLUMN BS_CASE_LOST.DRIVER_FEATURE IS '司机特征';
COMMENT ON COLUMN BS_CASE_LOST.TICKET IS '车票号码';
COMMENT ON COLUMN BS_CASE_LOST.MACHINE_PRICE IS '计费器显示价格';
COMMENT ON COLUMN BS_CASE_LOST.CHARGE IS '实际收费';
COMMENT ON COLUMN BS_CASE_LOST.DESC2 IS '领取备注';
COMMENT ON COLUMN BS_CASE_LOST.MONEY IS '估算价值';
COMMENT ON COLUMN BS_CASE_LOST.ITEMS IS '报失物品';
COMMENT ON COLUMN BS_CASE_LOST.SITE_POSTION IS '遗失位置';
COMMENT ON COLUMN BS_CASE_LOST.LEVEL IS '级别';
COMMENT ON COLUMN BS_CASE_LOST.IS_TOOK IS '是否领取 true:为已领,false:未领';
COMMENT ON COLUMN BS_CASE_LOST.TOOK_DATE IS '领取时间';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_NAME IS '领取人';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_AGE IS '领取人年龄';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_UNIT IS '领取人单位';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_TEL IS '领取人电话';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_SEX IS '领取人性别';
COMMENT ON COLUMN BS_CASE_LOST.TAKER_IDENTITY IS '领取人身份证';
COMMENT ON COLUMN BS_CASE_LOST.RESULT_ IS '失物去向 -1 : 空 0:交回公司 1:交给乘客 2:找不到失物 3:待查';
COMMENT ON COLUMN BS_CASE_LOST.RETRUN_DATE IS '交还时间';
COMMENT ON COLUMN BS_CASE_LOST.REPLY_DATE IS '回复时间';
COMMENT ON COLUMN BS_CASE_LOST.HANDLE_RESULT IS '处理结果 1:司机主动交回 2:公司致电司机确认有 3:公司致电司机确认无但交车队或报警处理有 4:确认无';
COMMENT ON COLUMN BS_CASE_LOST.TRANSACTOR_ID IS '经办人ID';
COMMENT ON COLUMN BS_CASE_LOST.TRANSACTOR_NAME IS '经办人姓名';
ALTER TABLE BS_CASE_LOST ADD CONSTRAINT BSFK_LOST_CASEBASE FOREIGN KEY (ID)
      REFERENCES BS_CASE_BASE (ID);
ALTER TABLE BS_CASE_LOST ADD CONSTRAINT BSFK_LOST_TRANSACTOR FOREIGN KEY (TRANSACTOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);

--费用模板表
CREATE TABLE BS_FEE_TEMPLATE(
	ID	INTEGER	NOT NULL,
	STATUS_	INT	NOT NULL,
	MODULE_ VARCHAR(255),
	TYPE_	INT,
	PID INTEGER,
	ORDER_ VARCHAR(255),
	CODE VARCHAR(255) NOT NULL,
	NAME VARCHAR(255) NOT NULL,
	PRICE NUMERIC(10,2),
	COUNT_ INTEGER,
	PAY_TYPE	INTEGER,
	DESC_ VARCHAR(255),
	SPEC VARCHAR(255),
	FILE_DATE	TIMESTAMP	NOT NULL,
	AUTHOR_ID	INTEGER	NOT NULL,
	MODIFIED_DATE	TIMESTAMP,
	MODIFIER_ID	INTEGER,
	CONSTRAINT BSPK_FEE_TEMPLATE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_FEE_TEMPLATE IS '费用模板';
COMMENT ON COLUMN BS_FEE_TEMPLATE.STATUS_ IS '状态：0-正常，1-禁用';
COMMENT ON COLUMN BS_FEE_TEMPLATE.MODULE_ IS '所属模块';
COMMENT ON COLUMN BS_FEE_TEMPLATE.TYPE_ IS '类型：1-费用，0-模板';
COMMENT ON COLUMN BS_FEE_TEMPLATE.PID IS '所属模板';
COMMENT ON COLUMN BS_FEE_TEMPLATE.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_FEE_TEMPLATE.CODE IS '编码：全局唯一';
COMMENT ON COLUMN BS_FEE_TEMPLATE.NAME IS '名称';
COMMENT ON COLUMN BS_FEE_TEMPLATE.PRICE IS '金额';
COMMENT ON COLUMN BS_FEE_TEMPLATE.COUNT_ IS '数量';
COMMENT ON COLUMN BS_FEE_TEMPLATE.PAY_TYPE IS '收费方式: 1-每月，2-每季，3-每年，4-一次性';
COMMENT ON COLUMN BS_FEE_TEMPLATE.DESC_ IS '备注';
COMMENT ON COLUMN BS_FEE_TEMPLATE.SPEC IS '特殊配置:isByDriver:是否按司机填写数量;isDeadline:是否加入合同期限;isSplit:
是否拆分[按新承包合同的每月基准承包款的拆分规则拆分];lackPrice:不足一个月应交的承包款;cutPrice:每月承包款递减的金额';
COMMENT ON COLUMN BS_FEE_TEMPLATE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_FEE_TEMPLATE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_FEE_TEMPLATE.MODIFIED_DATE IS '最后修改时间';
COMMENT ON COLUMN BS_FEE_TEMPLATE.MODIFIER_ID IS '最后修改人ID';
ALTER TABLE BS_FEE_TEMPLATE ADD CONSTRAINT BSFK_FEE_TEMPLATE_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_FEE_TEMPLATE ADD CONSTRAINT BSFK_FEE_TEMPLATE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_FEE_TEMPLATE ADD CONSTRAINT BSFK_FEE_TEMPLATE_PID FOREIGN KEY (PID)
      REFERENCES BS_FEE_TEMPLATE (ID);
ALTER TABLE BS_FEE_TEMPLATE ADD CONSTRAINT BSUK_FEE_TEMPLATE_CODE UNIQUE (CODE);

-- 承包费
CREATE TABLE BS_FEE (
   ID					INTEGER 		NOT NULL,
   UID_					VARCHAR(36)		NOT NULL,
   STATUS_				INTEGER			NOT NULL,
   FEE_YEAR				INTEGER			NOT NULL,
   FEE_MONTH			INTEGER			NOT NULL,
   FEE_DATE				TIMESTAMP,
   COLLECTION_WAY		VARCHAR(255),
   S_SUBTOTAL			NUMERIC(10,2)	DEFAULT 0,
   S_UPKEEP				NUMERIC(10,2)	DEFAULT 0,
   S_TOTAL				NUMERIC(10,2)	DEFAULT 0,
   A_SUBTOTAL			NUMERIC(10,2)	DEFAULT 0,
   A_UPKEEP				NUMERIC(10,2)	DEFAULT 0,
   A_TOTAL				NUMERIC(10,2)	DEFAULT 0,
   R_SUBTOTAL			NUMERIC(10,2)	DEFAULT 0,
   R_UPKEEP				NUMERIC(10,2)	DEFAULT 0,
   R_TOTAL				NUMERIC(10,2)	DEFAULT 0,
   O_SUBTOTAL			NUMERIC(10,2)	DEFAULT 0,
   O_UPKEEP				NUMERIC(10,2)	DEFAULT 0,
   O_TOTAL				NUMERIC(10,2)	DEFAULT 0,
   SA_TOTAL1			NUMERIC(10,2)	DEFAULT 0,
   SA_TOTAL2			NUMERIC(10,2)	DEFAULT 0,
   COMPANY				VARCHAR(255),
   MOTORCADE_ID			INTEGER,
   MOTORCADE_NAME		VARCHAR(255),
   CAR_ID				INTEGER,
   CAR_PLATE			VARCHAR(255),
   PAYER_ID				INTEGER,
   PAYER_NAME			VARCHAR(255),
   DESC_				VARCHAR(4000),
   FILE_DATE			TIMESTAMP		NOT NULL,
   AUTHOR_ID			INTEGER			NOT NULL,
   MODIFIER_ID			INTEGER,
   MODIFIED_DATE		TIMESTAMP,
   CONSTRAINT BSPK_FEE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_FEE IS '承包费';
COMMENT ON COLUMN BS_FEE.STATUS_ IS '状态：0-在案,1-注销';
COMMENT ON COLUMN BS_FEE.FEE_YEAR IS '收费年';
COMMENT ON COLUMN BS_FEE.FEE_MONTH IS '收费月';
COMMENT ON COLUMN BS_FEE.FEE_DATE IS '收费日';
COMMENT ON COLUMN BS_FEE.COLLECTION_WAY IS '收款方式';
COMMENT ON COLUMN BS_FEE.S_SUBTOTAL IS '应收小计';
COMMENT ON COLUMN BS_FEE.S_UPKEEP IS '应收维修费';
COMMENT ON COLUMN BS_FEE.S_TOTAL IS '应收合计';
COMMENT ON COLUMN BS_FEE.A_SUBTOTAL IS '调整小计';
COMMENT ON COLUMN BS_FEE.A_UPKEEP IS '调整维修费';
COMMENT ON COLUMN BS_FEE.A_TOTAL IS '调整合计';
COMMENT ON COLUMN BS_FEE.R_SUBTOTAL IS '实收小计';
COMMENT ON COLUMN BS_FEE.R_UPKEEP IS '实收维修费';
COMMENT ON COLUMN BS_FEE.R_TOTAL IS '实收合计';
COMMENT ON COLUMN BS_FEE.O_SUBTOTAL IS '欠费小计';
COMMENT ON COLUMN BS_FEE.O_UPKEEP IS '欠费维修费';
COMMENT ON COLUMN BS_FEE.O_TOTAL IS '欠费合计';
COMMENT ON COLUMN BS_FEE.SA_TOTAL1 IS '本期应收款合计';
COMMENT ON COLUMN BS_FEE.SA_TOTAL2 IS '前期加本期应收合计';
COMMENT ON COLUMN BS_FEE.COMPANY IS '所属公司:如宝城、广发';
COMMENT ON COLUMN BS_FEE.MOTORCADE_ID IS '车队ID';
COMMENT ON COLUMN BS_FEE.MOTORCADE_NAME IS '车队名称';
COMMENT ON COLUMN BS_FEE.CAR_ID IS '车辆ID';
COMMENT ON COLUMN BS_FEE.CAR_PLATE IS '车辆号码';
COMMENT ON COLUMN BS_FEE.PAYER_ID IS '缴费人ID';
COMMENT ON COLUMN BS_FEE.PAYER_NAME IS '缴费人姓名';
COMMENT ON COLUMN BS_FEE.DESC_ IS '备注';
COMMENT ON COLUMN BS_FEE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_FEE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_FEE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_FEE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_FEE ADD CONSTRAINT BSFK_FEE_AUTHOR FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_FEE ADD CONSTRAINT BSFK_FEE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_FEE ADD CONSTRAINT BSFK_FEE_MOTORCADE FOREIGN KEY (MOTORCADE_ID)
      REFERENCES BS_MOTORCADE (ID);
ALTER TABLE BS_FEE ADD CONSTRAINT BSFK_FEE_CAR FOREIGN KEY (CAR_ID)
      REFERENCES BS_CAR (ID);
ALTER TABLE BS_FEE ADD CONSTRAINT BSFK_FEE_PAYER FOREIGN KEY (PAYER_ID)
      REFERENCES BS_CARMAN (ID);
ALTER TABLE BS_FEE ADD CONSTRAINT BSUQ_FEE UNIQUE (FEE_YEAR, FEE_MONTH, CAR_ID);
CREATE INDEX BSIDX_FEE_CAR ON BS_FEE (CAR_ID);

-- 承包费明细
CREATE TABLE BS_FEE_DETAIL(
   ID			INTEGER				NOT NULL,
   FID			INTEGER				NOT NULL,
   FEE_TYPE		INTEGER				NOT NULL,
   FEE_NAME		VARCHAR(255)		NOT NULL,
   CHARGE		NUMERIC(10,2)		DEFAULT 0,
   FEE_DESC		VARCHAR(4000),
   CONSTRAINT BSPK_FEE_DETAIL PRIMARY KEY (ID)
);
COMMENT ON COLUMN BS_FEE_DETAIL.FID IS '所属承包费ID';
COMMENT ON COLUMN BS_FEE_DETAIL.FEE_TYPE IS '明细类型';
COMMENT ON COLUMN BS_FEE_DETAIL.FEE_NAME IS '费用名称';
COMMENT ON COLUMN BS_FEE_DETAIL.CHARGE IS '金额';
COMMENT ON COLUMN BS_FEE_DETAIL.FEE_DESC IS '备注';
ALTER TABLE BS_FEE_DETAIL ADD CONSTRAINT BSFK_FEE_BASE FOREIGN KEY (FID)
      REFERENCES BS_FEE (ID);	

-- 社保规则
CREATE TABLE BS_SOCIALSECURITYRULE(
	ID INTEGER NOT NULL,
	AREA_ID INTEGER NOT NULL,
	AREA_NAME VARCHAR(255) NOT NULL,
	START_YEAR INT NOT NULL,
	START_MONTH INT NOT NULL,
	HOUSE_TYPE VARCHAR(255) NOT NULL,
	FILE_DATE TIMESTAMP NOT NULL,
	AUTHOR_ID INTEGER NOT NULL,
	MODIFIER_ID INTEGER ,
	MODIFIED_DATE TIMESTAMP,
	CONSTRAINT BSPK_SOCIALSECURITYRULE PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SOCIALSECURITYRULE IS '社保规则';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.AREA_ID IS '使用区域ID';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.AREA_NAME IS '使用区域名称';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.START_YEAR IS '起始年';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.START_MONTH IS '起始月';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.HOUSE_TYPE IS '户口类型：本地城镇、本地农村、外地城镇、外地农村';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.FILE_DATE IS '创建时间';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.AUTHOR_ID IS '创建人ID';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.MODIFIER_ID IS '最后修改人ID';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE.MODIFIED_DATE IS '最后修改时间';
ALTER TABLE BS_SOCIALSECURITYRULE ADD CONSTRAINT BSFK_SOCIALSECURITYRULE_AUTHORID FOREIGN KEY (AUTHOR_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_SOCIALSECURITYRULE ADD CONSTRAINT BSFK_SOCIALSECURITYRULE_MODIFIER FOREIGN KEY (MODIFIER_ID)
      REFERENCES BC_IDENTITY_ACTOR_HISTORY (ID);
ALTER TABLE BS_SOCIALSECURITYRULE ADD CONSTRAINT BSFK_SOCIALSECURITYRULE_AREA_ID FOREIGN KEY (AREA_ID) 
	REFERENCES BC_PLACEORIGIN (ID);
	
-- 社保规则保险明细表
CREATE TABLE BS_SOCIALSECURITYRULE_DETAIL(
	ID INTEGER NOT NULL,
	PID INTEGER NOT NULL,
	NAME VARCHAR(255) NOT NULL,
	UNIT_RATE NUMERIC(10,2),
	PERSONAL_RATE NUMERIC(10,2),
	BASE_NUMBER NUMERIC(10,2),
	DESC_ VARCHAR(4000),
	CONSTRAINT BSPK_SOCIALSECURITYRULE_DETAIL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_SOCIALSECURITYRULE_DETAIL  IS '社保规则保险明细表';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.PID IS '所属社保规则ID';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.NAME IS '名称';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.UNIT_RATE IS '单位缴率';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.PERSONAL_RATE IS '个人缴率';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.BASE_NUMBER IS '基数';
COMMENT ON COLUMN BS_SOCIALSECURITYRULE_DETAIL.DESC_ IS '备注';
ALTER TABLE BS_SOCIALSECURITYRULE_DETAIL ADD CONSTRAINT BSFK_SOCIALSECURITYRULE_DETAIL_PID FOREIGN KEY (PID)
      REFERENCES BS_SOCIALSECURITYRULE(ID);

-- 收费明细
CREATE TABLE BS_CONTRACT_FEE_DETAIL (
   ID			INTEGER          NOT NULL,
   PID			INTEGER          NOT NULL,
   ORDER_		INTEGER,
   CODE			VARCHAR(255),
   NAME         VARCHAR(255)     NOT NULL,
   PRICE 		NUMERIC(10,2),
   COUNT_ 		INTEGER,
   PAY_TYPE		INTEGER,
   START_DATE	TIMESTAMP,
   END_DATE		TIMESTAMP,
   SPEC 		VARCHAR(255),
   DESC_		VARCHAR(4000),
   CONSTRAINT BSPK_CONTRACT_FEE_DETAIL PRIMARY KEY (ID)
);
COMMENT ON TABLE BS_CONTRACT_FEE_DETAIL IS '收费明细';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.PID IS '所属经济合同ID';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.ORDER_ IS '排序号';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.CODE IS '编码';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.NAME IS '项目';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.PRICE IS '金额';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.COUNT_ IS '数量';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.PAY_TYPE IS '收费方式';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.START_DATE IS '收费开始日期';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.PAY_TYPE IS '收费结束日期';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.SPEC IS '特殊配置:isByDriver:是否按司机填写数量;isDeadline:是否加入合同期限;isSplit:
是否拆分[按新承包合同的每月基准承包款的拆分规则拆分];lackPrice:不足一个月应交的承包款;cutPrice:每月承包款递减的金额';
COMMENT ON COLUMN BS_CONTRACT_FEE_DETAIL.DESC_ IS '备注';
ALTER TABLE BS_CONTRACT_FEE_DETAIL ADD CONSTRAINT BSFK_FEEDETAIL_CONTRACT4CHARGER FOREIGN KEY (PID)
      REFERENCES BS_CONTRACT (ID);

-- ##营运子系统的 postgresql 自定义函数和存储过程##

-- 获取指定车辆实时的营运司机信息,只适用于对当前在案车辆的处理
-- 返回值的格式为：张三,正班,id1;李四,副班,id2;小明,顶班,id3;小军,主挂,id4
-- 返回值是先按营运班次正序排序再按司机的入职时间正序排序进行合并的
-- 参数：cid - 车辆的id
CREATE OR REPLACE FUNCTION getDriverInfoByCarId(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	driverInfo varchar(4000);
BEGIN
	select string_agg(concat(name,',',(case when classes=1 then '正班' when classes=2 then '副班' when classes=3 then '主挂' when classes=4 then '顶班' else '无' end),',',id),';')
		into driverInfo
		from (select m.id as id,m.name as name,cm.classes as classes 
			from BS_CAR_DRIVER cm
			inner join BS_CARMAN m on m.id=cm.driver_id
			where cm.status_=0 and cm.car_id=cid
			order by cm.classes asc,m.work_date asc) as t;
	return driverInfo;
END;
$$ LANGUAGE plpgsql;

-- 获取指定车辆实时的经济合同责任人信息,只适用于对当前在案车辆的处理
-- 返回值的格式为：张三,李四
-- 返回值是按责任人的入职时间正序排序的
-- 参数：cid - 车辆的id
CREATE OR REPLACE FUNCTION getChargerInfoByCarId(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	chargerInfo varchar(4000);
BEGIN
	select string_agg(concat(name,',',id),';') into chargerInfo
		from (SELECT m.name as name,m.id as id
			FROM bs_car_contract cc
			inner join bs_contract c on c.id=cc.contract_id
			inner join bs_contract_charger c1 on c1.id=c.id
			inner join bs_carman_contract cm on cm.contract_id=c.id
			inner join bs_carman m on m.id=cm.man_id
			where cc.car_id=cid and c.status_=0
			order by m.work_date asc) as t;
	return chargerInfo;
END;
$$ LANGUAGE plpgsql;

-- 获取指定司机所营运车辆的经济合同责任人信息,只适用于对当前在案司机的处理
-- 返回值的格式为：张三,李四
-- 返回值是按责任人的创建时间正序排序的
-- 参数：did - 司机的id
CREATE OR REPLACE FUNCTION getChargerInfoByDriverId(did IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	chargerInfo varchar(4000);
BEGIN
	select string_agg(concat(name,',',id),';') into chargerInfo
		from (SELECT distinct p.name as name,p.id as id,p.file_date
			FROM bs_car_driver cd
			inner join bs_car_contract cc on cc.car_id=cd.car_id
			inner join bs_contract c on c.id=cc.contract_id
			inner join bs_carman_contract pm on pm.contract_id=cc.contract_id
			inner join bs_carman p on p.id=pm.man_id
			-- 正常的营运班次信息+当前经济合同 条件
			where cd.status_=0 and c.status_=0 and c.main=0 and c.type_=2 and cd.driver_id=did
			order by p.file_date asc) as t;
	return chargerInfo;
END;
$$ LANGUAGE plpgsql;

-- 获取指定经济合同的车辆信息
-- 返回值的格式为：粤A.xxxx1,id1;粤A.xxxx2,id2
-- 返回值是按合同的创建时间正序排序的
-- 参数：cid - 经济合同的id
CREATE OR REPLACE FUNCTION getCarInfoByChargerContractId(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	carInfo varchar(4000);
BEGIN
	select string_agg(concat(plateType,'.',plateNo,',',id),';') into carInfo
		from (SELECT car.plate_type as plateType,car.plate_no as plateNo,car.id as id
			FROM bs_car_contract cc
			inner join bs_contract c on c.id=cc.contract_id
			inner join bs_contract_charger c1 on c1.id=c.id
			inner join bs_car car on car.id=cc.car_id
			where cc.contract_id=cid
			order by c.file_date desc) as t;

	return carInfo;
END;
$$ LANGUAGE plpgsql;


-- 获取指定经济合同的责任人信息
-- 返回值的格式为：姓名1,id1;姓名2,id2
-- 返回值是按合同的创建时间正序排序的
-- 参数：cid - 经济合同的id
CREATE OR REPLACE FUNCTION getChargerInfoByChargerContractId(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	chargerInfo varchar(4000);
BEGIN
	select string_agg(concat(name,',',id),';') into chargerInfo
		from (SELECT p.name as name,p.id as id
			FROM bs_carman_contract cc
			inner join bs_contract c on c.id=cc.contract_id
			inner join bs_contract_charger c1 on c1.id=c.id
			inner join bs_carman p on p.id=cc.man_id
			where cc.contract_id=cid
			order by p.work_date asc) as t;

	return chargerInfo;
END;
$$ LANGUAGE plpgsql;

-- 获取指定劳动合同的车辆信息
-- 返回值的格式为：粤A.xxxx1,id1;粤A.xxxx2,id2
-- 返回值是按合同的创建时间正序排序的
-- 参数：cid - 劳动合同的id
CREATE OR REPLACE FUNCTION getCarInfoByLabourContractId(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	carInfo varchar(4000);
BEGIN
	select string_agg(concat(plateType,'.',plateNo,',',id),';') into carInfo
		from (SELECT car.plate_type as plateType,car.plate_no as plateNo,car.id as id
			FROM bs_car_contract cc
			inner join bs_contract c on c.id=cc.contract_id
			inner join bs_contract_labour c1 on c1.id=c.id
			inner join bs_car car on car.id=cc.car_id
			where cc.contract_id=cid
			order by c.file_date desc) as t;

	return carInfo;
END;
$$ LANGUAGE plpgsql;


--##查找司机营运车辆的自定义函数和存储过程##
CREATE OR REPLACE FUNCTION getCarInfoByDriverId(did IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	caridInfo varchar(4000);
BEGIN
	select string_agg(concat(name,',',(case when classes=1 then '正班' when classes=2 then '副班' when classes=3 then '主挂' when classes=4 then '顶班' else '无' end),',',id),';')
		into caridInfo
		from (select c.id as id,concat(c.plate_type,'.',c.plate_no) as name,cm.classes as classes 
			from BS_CAR_DRIVER cm
			inner join bs_car c on c.id=cm.car_id
			where cm.status_=0 and cm.driver_id=did
			order by cm.classes asc,c.file_date asc) as t;
	return caridInfo;
END;
$$ LANGUAGE plpgsql;


--##将现有的迁移记录的最新的迁移记录标识为当前的迁移记录##
CREATE OR REPLACE FUNCTION updateCarByDriverHistory4Min(did IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	main integer;
BEGIN
	
	update BS_CAR_DRIVER_HISTORY set main=0 where id in (
		select  id from BS_CAR_DRIVER_HISTORY where driver_id=did order by move_date desc limit 1 );

	return main;
END;
$$ LANGUAGE plpgsql;


--##获取司机最新的迁移类型##
CREATE OR REPLACE FUNCTION getDriverMoveTypeByDriverId(did IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	moveType integer;
BEGIN
	select  h.move_type
		into moveType
		from BS_CAR_DRIVER_HISTORY h where h.driver_id=did order by h.move_date desc limit 1;
	return moveType;
END;
$$ LANGUAGE plpgsql;

--##获取司机最新的迁移日期##
CREATE OR REPLACE FUNCTION getDriverMoveDateByDriverId(did IN integer) RETURNS timestamp AS $$
DECLARE
	--定义变量
	moveDate timestamp;
BEGIN
	select  h.move_date
		into moveDate
		from BS_CAR_DRIVER_HISTORY h where h.driver_id=did order by h.move_date desc limit 1;
	return moveDate;
END;
$$ LANGUAGE plpgsql;

--##获取司机最新的驾驶状态--
CREATE OR REPLACE FUNCTION getDriverClassesByDriverId(did IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	classes integer;
BEGIN
	select  c.classes
		into classes
		from BS_CAR_DRIVER c where driver_id=did order by c.file_date desc limit 1;
	return classes;
END;
$$ LANGUAGE plpgsql;


--##获取司机最新的营运的主车辆ID--
CREATE OR REPLACE FUNCTION getDriverMainCarIdByDriverId(did IN integer) RETURNS integer AS $$
DECLARE
	--定义变量
	mainCarId integer;
BEGIN
	select  c.car_id
		into mainCarId
		from BS_CAR_DRIVER c where c.status_=0 and (c.classes=1 or c.classes=2 or c.classes=3) and driver_id=did;
	return mainCarId;
END;
$$ LANGUAGE plpgsql;

-- 字符串转数字函数
CREATE OR REPLACE FUNCTION convert_stringtonumber(string_ character varying)
	RETURNS integer  AS
$BODY$
DECLARE
		-- 定义变量
		number_ integer;
		text_expression character varying;
		length_ integer;
		i integer;
BEGIN
	-- 检测字符串的长度
	length_ := char_length(trim(string_));
	text_expression := '';
	FOR i IN 1..length_
	LOOP
	-- 生成匹配的表达式
	text_expression := text_expression||'9';
	END LOOP;
	number_ := to_number(string_,text_expression);
	return number_;
END;
$BODY$
 LANGUAGE plpgsql;

-- 数字转字符串函数
CREATE OR REPLACE FUNCTION convert_numbertostring(int_ integer,text_ character varying)
	RETURNS character varying  AS
$BODY$
DECLARE
		-- 定义变量
		string_ character varying;
		text_expression character varying;
		length_ integer;
		i integer;
BEGIN
	-- 检测字符串的长度
	length_ := char_length(trim(text_));
	text_expression := '';
	FOR i IN 1..length_
	LOOP 
	-- 生成匹配的表达式
	text_expression := text_expression||'0';
	END LOOP;
	string_ := trim(to_char(int_,text_expression));
	RETURN string_;
END;
$BODY$
LANGUAGE plpgsql;
	
-- 统计采购单剩余数量函数
CREATE OR REPLACE FUNCTION get_balancecount_invoice_buyid(bid integer)
	RETURNS integer AS
$BODY$
DECLARE
	-- 定义变量
	-- 采购数量
	buy_count INTEGER;
	-- 销售数量
	sell_count INTEGER;
	-- 退票数量
	refund_count INTEGER;
BEGIN
  --采购数量
	select count_ into buy_count from bs_invoice_buy where id=bid;
	--销售数量
	select sum(count_) into sell_count
	from bs_invoice_sell_detail where buy_id=bid and status_=0 and type_=1;
	--退票数量
	select sum(count_) into refund_count
	from bs_invoice_sell_detail where buy_id=bid and status_=0 and type_=2;

		-- 若为空时
	IF sell_count is null THEN
		sell_count := 0;
	END IF;
	IF refund_count is null THEN
		refund_count := 0;
	END IF;

	RETURN buy_count-sell_count+refund_count;
END
$BODY$
LANGUAGE plpgsql;


 -- 判断发票销售开始号、结束号、数量异常函数
CREATE OR REPLACE FUNCTION checkI4SellDetailCount(sell_count INTEGER,start_no CHARACTER VARYING,end_no CHARACTER VARYING)
	RETURNS INTEGER  AS
$BODY$
DECLARE
		-- 定义变量
		count_ INTEGER;
		-- 数字类型临时变量
		start_temp INTEGER;
		-- 数字类型临时变量
		end_temp INTEGER;
BEGIN
	start_temp := convert_stringtonumber(start_no);
	end_temp :=	convert_stringtonumber(end_no);
	count_ := (end_temp-start_temp+1)/100;
		IF sell_count = count_ THEN
			RETURN 0;
		ELSE
			RETURN 1;
		END IF;
END;
$BODY$
 LANGUAGE plpgsql
 IMMUTABLE;

-- 发票销售开始号、结束号、数量异常函数索引
CREATE INDEX BSIDX_INVOICESELLDETAIL_CHECKI ON bs_invoice_sell_detail(checkI4SellDetailCount(count_,start_no,end_no));
 
--获取金盾网的违章地址与金盾的相关信息的Id
CREATE OR REPLACE FUNCTION findJinDunByJiaoWei(syncCode IN varchar,plateNo IN varchar,happenDate IN timestamp) RETURNS varchar AS $$
DECLARE
	--定义变量
	jinDunInfo varchar(4000);
BEGIN
	select concat(jd.address,';',jd.id) into jinDunInfo
			from BS_SYNC_JINDUN_JTWF jd
			inner join BC_SYNC_BASE sb on sb.id=jd.id
			where sb.sync_code=syncCode or (jd.car_plate_no=plateNo and to_char(jd.happen_date,'YYYY-MM-DD HH:MI')=to_char(happenDate,'YYYY-MM-DD HH:MI'));
	return jinDunInfo;
END;
$$ LANGUAGE plpgsql;

-- 获取指定车辆最新的经济合同残值归属
-- 参数：cid - 车辆的id
CREATE OR REPLACE FUNCTION getContract4ChargerScrapTo(cid IN integer) RETURNS varchar AS $$
DECLARE
	--定义变量
	scrapToInfo varchar(4000);
BEGIN
	select ch.scrapto into scrapToInfo
		from bs_contract_charger ch 
			inner join bs_contract bc on bc.id=ch.id
			inner join bs_car_contract carc on ch.id = carc.contract_id
			where carc.car_id=cid  order by bc.file_date desc limit 1 ;
	return scrapToInfo;
END;
$$ LANGUAGE plpgsql;


-- 视图显示本期费用明细函数
-- 输入参数：费用id,费用类型1:本期实收明细type_,2:本期欠费明细
CREATE OR REPLACE FUNCTION getfeedetailbyfeeid(fee_id INTEGER,type_ INTEGER)
	RETURNS CHARACTER VARYING  AS
$BODY$
DECLARE
		-- 记录费用明细字符串
		feedetailStr CHARACTER VARYING;
		-- 记录费用名称字符串
		feenameStr CHARACTER VARYING;
		-- 记录费用
		feechargeStr CHARACTER VARYING;

		-- 变量一行结果的记录	
		rowinfo RECORD;
BEGIN
		-- 初始化费用明细字符串
		feedetailStr := '';

		-- 根据采购单ID查出对应的销售明细结果
		FOR rowinfo IN SELECT f.fee_name,f.charge
										FROM  bs_fee_detail f
										WHERE f.fid=fee_id and f.fee_type= type_
	  -- 循环开始
		LOOP
				feenameStr := rowinfo.fee_name;
				feechargeStr := trim(to_char(rowinfo.charge, '99999999D99'));

				feedetailStr := feedetailStr||'[费用名称: '||feenameStr||',费用金额: '||feechargeStr||'] ';

		END LOOP;
		-- 费用明细字符串
		RETURN feedetailStr;
END;
$BODY$
LANGUAGE plpgsql;


-- 视图显示前期欠费明细函数
-- 输入参数：车辆id,收费年份t_fee_year,收费月份t_fee_month
CREATE OR REPLACE FUNCTION getb4feedetailbyfeeid(t_car_id INTEGER,t_fee_year INTEGER,t_fee_month INTEGER)
	RETURNS CHARACTER VARYING  AS
$BODY$
DECLARE
		-- 记录费用明细字符串
		feedetailStr CHARACTER VARYING;
		-- 记录费用名称字符串
		feenameStr CHARACTER VARYING;
		-- 记录费用
		feechargeStr CHARACTER VARYING;
		-- 前期收费年
		b4_year INTEGER;
		-- 前期收费月
		b4_month INTEGER;
		-- 前期费用id
		b4_id INTEGER;

		-- 变量一行结果的记录	
		rowinfo RECORD;
BEGIN
		IF t_fee_month = 1 THEN
			b4_year = t_fee_year - 1;
			b4_month = 12;
		ELSE
			b4_year = t_fee_year;
			b4_month = t_fee_month - 1;
		END IF;

		select f.id
			into b4_id
			from bs_fee f 
			where f.car_id = t_car_id and f.fee_year = b4_year and f.fee_month = b4_month;

		-- 初始化费用明细字符串
		feedetailStr := '';

		IF b4_id is not null THEN

			-- 根据采购单ID查出对应的销售明细结果
			FOR rowinfo IN SELECT f.fee_name,f.charge
											FROM  bs_fee_detail f
											WHERE f.fid=b4_id and f.fee_type= 2
			-- 循环开始
			LOOP
					feenameStr := rowinfo.fee_name;
					feechargeStr := trim(to_char(rowinfo.charge, '99999999D99'));

					feedetailStr := feedetailStr||'[费用名称: '||feenameStr||',费用金额: '||feechargeStr||'] ';
			END LOOP;

		END IF;

		-- 费用明细字符串
		RETURN feedetailStr;
END;
$BODY$
LANGUAGE plpgsql;

	  
-- 社保收费规则视图明细列函数
CREATE OR REPLACE FUNCTION getsocialsecurityruledetail(pid INTEGER)
	RETURNS CHARACTER VARYING  AS
$BODY$
DECLARE
		-- 保存明细字符串
		details CHARACTER VARYING;
		-- 单位缴率
		ur CHARACTER VARYING;
		-- 个人缴率
		pr CHARACTER VARYING;
		--	基数
		bn CHARACTER VARYING;
		-- id临时变量用于保存函数输入的值。
		nid INTEGER;
		-- 一行结果的记录	
		rowinfo RECORD;
BEGIN
		-- 初始化变量
		details:='';
		nid:=pid;
		FOR rowinfo IN SELECT d.name,d.unit_rate,d.personal_rate,d.base_number
										FROM bs_socialsecurityrule_detail d
										WHERE d.pid=nid
		-- 循环开始
		LOOP
			ur:=rowinfo.unit_rate;
			pr:=rowinfo.personal_rate;
			bn:=rowinfo.base_number;
			details:=details||'('||rowinfo.name||',';
			details:=details||replace(ur,'.00','')||',';
			details:=details||replace(pr,'.00','')||',';
			details:=details||replace(bn,'.00','')||')';
		END LOOP;	
		RETURN details;
END;
$BODY$
LANGUAGE plpgsql;

